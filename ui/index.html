<!DOCTYPE html>
<html lang="en" class="dark"> <!-- Default to dark mode, script will manage preference -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS - Video to SRT - VC</title>

    <!--
      Local and third-party assets.
      - styles.css: Pre-compiled stylesheet containing all Tailwind and custom component styles.
      - wavesurfer.min.js: The WaveSurfer.js library for audio visualization, served locally.
    -->
    <link rel="stylesheet" href="styles.css">
    <script src="vendor/wavesurfer.min.js"></script>
</head>

<body class="body-base">
    <div class="min-h-full">
        <!-- Navigation Bar -->
        <nav class="nav-base">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <a href="/" id="app-title-link" class="title-link">TTS - Video to SRT - VC</a>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 sm:space-x-4">
                        <a href="/docs" target="_blank" class="nav-link">API Docs</a>
                        <button id="theme-toggle-btn" type="button" class="theme-switch-button"
                            title="Toggle light/dark mode">
                            <span class="sr-only">Toggle theme</span>
                            <span class="theme-switch-thumb">
                                <svg class="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />
                                </svg>
                                <svg class="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"
                                        clip-rule="evenodd" />
                                </svg>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main>
            <div class="mx-auto max-w-7xl px-4 py-1 sm:px-6 lg:px-8">

                <div id="notification-area" class="mb-6 space-y-3"></div>

                



<!-- Alpine.js Required -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<div x-data="{ open: false }" class="w-full">

    <!-- Accordion Header -->
    <button 
        @click="open = !open"
        class="w-full text-left px-3 py-2 bg-yellow-800 text-yellow-200 font-semibold rounded-md">
        NZG 73 LOGO
        <span class="float-right" x-text="open ? 'ğŸ”¼ğŸ¥°ğŸ˜â–²' : 'ğŸ”½ğŸ¥ºğŸ‘‰ğŸ»â–¼'"></span>
    </button>

    <!-- Accordion Content -->
    <div x-show="open" x-collapse class="mt-2">

        <ul class="text-xs text-yellow-700 dark:text-yellow-300 space-y-1 p-2 bg-yellow-50 dark:bg-yellow-900 rounded-md">

            
<!-- NZG 73 Logo Footer -->
<div style="text-align: center; margin: 20px 0;">
    <pre style="background:#000; color:#0f0; padding:20px; font-family:monospace; display:inline-block; border-radius:10px;">
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                      â•‘
â•‘  â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â•‘
â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘ â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•”â•â•â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘ â•šâ•â•â•â•â–ˆâ–ˆâ•—    â•‘
â•‘  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â•‘
â•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•  â•šâ•â•â•â•â–ˆâ–ˆâ•—    â•‘
â•‘  â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â•‘
â•‘  â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•     â•šâ•â•   â•šâ•â•â•â•â•â•     â•‘
â•‘                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    </pre>
</div>


        </ul>

    </div>
</div>





<!-- END Alpine.js Required -->

<div class="card-base">
                    <form id="tts-form" action="#" method="post" class="flex flex-col" onsubmit="return false;">
                        <div class="p-6 sm:p-8">
                           
              
<!-- Alpine.js Required -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<div x-data="{ open: false }" class="w-full">

    <!-- Accordion Header -->
    <button 
        @click="open = !open"
        class="w-full text-left px-3 py-2 bg-yellow-800 text-yellow-200 font-semibold rounded-md">
        TTS Multilanguage
        <span class="float-right" x-text="open ? 'â–²' : 'ğŸ‘‰ğŸ»â–¼'"></span>
    </button>

    <!-- Accordion Content -->
    <div x-show="open" x-collapse class="mt-2">

        <ul class="text-xs text-yellow-700 dark:text-yellow-300 space-y-1 p-2 bg-yellow-50 dark:bg-yellow-900 rounded-md">

            <label for="text" class="label-base">Generate high-quality speech in 24+ languages with voice cloning capabilities.

ğŸŒ 24+ Languages:- Arabic, Chinese, Danish, Dutch, English, Finnish, French, German, Greek, Hebrew, Hindi, Italian, Japanese, Korean, Malay, Norwegian, Polish, Portuguese, Russian, Spanish, Swedish, Swahili, Turkish</label>

        </ul>

    </div>
</div>


 <!-- END Alpine.js Required -->             

<div class="mb-2">
    <a href="https://nzg73.blogspot.com" 
       target="_blank" 
       rel="noopener noreferrer"
       class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 underline text-sm">
        <span class="font-medium">ğŸ‘‰NZG73</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg>
    </a>
</div>
                           
<label for="text" class="label-base">Contact Email: nzgnzg73@gmail.com</label>
                             <label for="text" class="label-base">YouTube ğŸ‘‡ğŸ‘‡</label>

<div class="mb-2">
    <a href="https://youtube.com/@NZG73" 
       target="_blank" 
       rel="noopener noreferrer"
       class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 underline text-sm">
        <span class="font-medium">ğŸ‘‰@NZG73</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg>
    </a>
</div>


                                    <!-- ğŸŒŸ Added ButtonsÂ -->

<!--.............................................................................................-->


                               <!-- âœ³ Chat Box Section -->
<div class="relative mb-6">
    <textarea name="text" id="text" rows="8" class="textarea-base"
        placeholder="Enter text here..." required></textarea>
    <div class="absolute bottom-2.5 right-3 text-xs text-slate-500 dark:text-slate-400">
        <span id="char-count">0</span> Characters
    </div>
</div>

<!-- âœ³ Button Row -->
<div class="flex flex-wrap items-center gap-x-4 gap-y-3 mb-6 justify-start">
    <button type="button" id="generate-btn" class="btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
            stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1.5 inline-block">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
        </svg>
        Generate Speech
    </button>

    <!-- ğŸŸ¢ ØªÛŒÙ† Ù†Ø¦Û’ Ø¨Ù¹Ù† ØªÚ¾ÙˆÚ‘Û’ ÙØ§ØµÙ„Û’ Ú©Û’ Ø³Ø§ØªÚ¾ -->
    <button type="button" id="copy-btn" class="btn-secondary px-4 py-2 rounded-md">ğŸ“‹ Copy</button>
    <button type="button" id="paste-btn" class="btn-secondary px-4 py-2 rounded-md ml-2">ğŸ“¥ Paste</button>
    <button type="button" id="clear-btn" class="btn-danger px-4 py-2 rounded-md ml-2">ğŸ—‘ Clear</button>
</div>

<!-- ğŸ”” Popup container -->
<div id="popup-msg"
    class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-sm px-4 py-2 rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-500 z-50">
</div>

<!-- âœ³ Script -->
<script>
    const textarea = document.getElementById("text");
    const copyBtn = document.getElementById("copy-btn");
    const pasteBtn = document.getElementById("paste-btn");
    const clearBtn = document.getElementById("clear-btn");
    const popup = document.getElementById("popup-msg");

    // ğŸ“¢ Popup message
    function showPopup(message) {
        popup.innerText = message;
        popup.classList.remove("opacity-0", "pointer-events-none");
        setTimeout(() => {
            popup.classList.add("opacity-0", "pointer-events-none");
        }, 2000);
    }

    // âœ… Copy Button
    copyBtn.addEventListener("click", async () => {
        try {
            await navigator.clipboard.writeText(textarea.value);
            showPopup("âœ… Text copied!");
        } catch (err) {
            showPopup("âš  Clipboard blocked â€” copy manually.");
        }
    });

    // âœ… Paste Button (fixed for mobile)
    pasteBtn.addEventListener("click", async () => {
        try {
            const text = await navigator.clipboard.readText();
            textarea.value += (textarea.value ? "\n" : "") + text;
            showPopup("ğŸ“¥ Text pasted!");
        } catch (err) {
            // ğŸŸ¡ fallback popup (mobile-friendly, no layout shift)
            const input = document.createElement("textarea");
            input.setAttribute("placeholder", "Paste text here...");
            input.className =
                "fixed bottom-10 left-1/2 -translate-x-1/2 w-[90%] h-[100px] border border-slate-400 rounded-xl p-2 bg-white shadow-xl z-[9999]";
            document.body.appendChild(input);

            input.focus({ preventScroll: true });
            showPopup("ğŸ“± Mobile paste box opened");

            input.addEventListener("blur", () => {
                textarea.value += (textarea.value ? "\n" : "") + input.value;
                document.body.removeChild(input);
                showPopup("ğŸ“¥ Text added manually!");
            });
        }
    });

    // âœ… Clear Button
    clearBtn.addEventListener("click", () => {
        textarea.value = "";
        document.getElementById("char-count").innerText = "0";
        showPopup("ğŸ—‘ Cleared!");
    });

    // âœ… Character Counter
    textarea.addEventListener("input", () => {
        document.getElementById("char-count").innerText = textarea.value.length;
    });
</script>

                                <!--.............................................................................................-->




<!--.................................. ğŸ”„ Voice-to-Voice (OFF) ğŸ”„ ........... ğŸ”„ Transcriber (OFF) ...........ğŸ”„ TTS Feature: ON âš ï¸ Restart Server ...........................................................-->


<div class="flex flex-wrap items-center gap-3 mb-6 relative">

    <button id="toggle-vc-btn" class="btn-primary relative overflow-hidden flex items-center justify-center px-4 py-2 text-white font-semibold text-sm rounded-lg shadow-md transition hover:scale-105">
        ğŸ”„ Voice-to-Voice (Loading...)
        <span class="absolute top-0 left-0 w-full h-full pointer-events-none">
            <span class="led-light" style="--i:0;"></span><span class="led-light" style="--i:1;"></span>
            <span class="led-light" style="--i:2;"></span><span class="led-light" style="--i:3;"></span>
            <span class="led-light" style="--i:4;"></span><span class="led-light" style="--i:5;"></span>
            <span class="led-light" style="--i:6;"></span><span class="led-light" style="--i:7;"></span>
        </span>
    </button>

    <button id="toggle-transcriber-btn" class="btn-primary relative overflow-hidden flex items-center justify-center px-4 py-2 text-white font-semibold text-sm rounded-lg shadow-md transition hover:scale-105">
        ğŸ”„ Transcriber (Loading...)
        <span class="absolute top-0 left-0 w-full h-full pointer-events-none">
            <span class="led-light" style="--i:0;"></span><span class="led-light" style="--i:1;"></span>
            <span class="led-light" style="--i:2;"></span><span class="led-light" style="--i:3;"></span>
            <span class="led-light" style="--i:4;"></span><span class="led-light" style="--i:5;"></span>
            <span class="led-light" style="--i:6;"></span><span class="led-light" style="--i:7;"></span>
        </span>
    </button>

    <button id="toggle-tts-btn" class="btn-primary relative overflow-hidden flex items-center justify-center px-4 py-2 text-white font-semibold text-sm rounded-lg shadow-md transition hover:scale-105" style="background-color: #28a745;">
        <span id="tts-status-text">TTS Feature: ON</span>
        <span class="absolute top-0 left-0 w-full h-full pointer-events-none">
            <span class="led-light" style="--i:0;"></span><span class="led-light" style="--i:1;"></span>
            <span class="led-light" style="--i:2;"></span><span class="led-light" style="--i:3;"></span>
            <span class="led-light" style="--i:4;"></span><span class="led-light" style="--i:5;"></span>
            <span class="led-light" style="--i:6;"></span><span class="led-light" style="--i:7;"></span>
        </span>
    </button>

    <button id="restart-btn" class="btn-primary relative overflow-hidden flex items-center justify-center px-4 py-2 text-white font-semibold text-sm rounded-lg shadow-md transition hover:scale-105" style="background-color: #dc3545;">
        âš ï¸ Restart Server
        <span class="absolute top-0 left-0 w-full h-full pointer-events-none">
            <span class="led-light" style="--i:0;"></span><span class="led-light" style="--i:1;"></span>
            <span class="led-light" style="--i:2;"></span><span class="led-light" style="--i:3;"></span>
            <span class="led-light" style="--i:4;"></span><span class="led-light" style="--i:5;"></span>
            <span class="led-light" style="--i:6;"></span><span class="led-light" style="--i:7;"></span>
        </span>
    </button>

</div>

<script>
// ============================================
// Helper Function: Ø¨Ù¹Ù† Ú©ÛŒ Ø­Ø§Ù„Øª Ú©Ùˆ Ù„ÙˆÚ©Ù„ Ø§Ø³Ù¹ÙˆØ±ÛŒØ¬ Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’
// ============================================

// 1. Voice-to-Voice Logic with Memory
const vcBtn = document.getElementById("toggle-vc-btn");
// Ú†ÛŒÚ© Ú©Ø±ÛŒÚº Ú©Û Ù¾ÛÙ„Û’ Ø³Û’ Ú©ÛŒØ§ Ø³ÛŒÙ¹Ù†Ú¯ Ù…Ø­ÙÙˆØ¸ ÛÛ’ØŒ Ø§Ú¯Ø± Ù†ÛÛŒÚº ØªÙˆ false (OFF) Ø±Ú©Ú¾ÛŒÚº
let savedVcState = localStorage.getItem("vcEnabled");
let vcEnabled = savedVcState === "true"; // Convert string to boolean

// Ù¾ÛŒØ¬ Ù„ÙˆÚˆ ÛÙˆØªÛ’ ÛÛŒ Ø¨Ù¹Ù† Ú©Ø§ Ù¹ÛŒÚ©Ø³Ù¹ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
vcBtn.innerText = `ğŸ”„ Voice-to-Voice (${vcEnabled ? 'ON' : 'OFF'}) ğŸ”„`;

vcBtn.addEventListener("click", async () => {
    // ÛÙ… Ø¨Ù¹Ù† Ø¯Ø¨Ø§ØªÛ’ ÛÛŒ Ø³Ù¹ÛŒÙ¹ Ø¨Ø¯Ù„ Ø±ÛÛ’ ÛÛŒÚº ØªØ§Ú©Û ÛŒÙˆØ²Ø± Ú©Ùˆ ÙˆÛŒÙ¹ Ù†Û Ú©Ø±Ù†Ø§ Ù¾Ú‘Û’ØŒ Ø§Ú¯Ø± Ø§ÛŒØ±Ø± Ø¢ÛŒØ§ ØªÙˆ ÙˆØ§Ù¾Ø³ Ú©Ø± Ø¯ÛŒÚº Ú¯Û’
    let newState = !vcEnabled;
    
    try {
        const response = await fetch("/api/toggle_vc", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `enabled=${newState}`
        });
        const data = await response.json();
        alert(data.message);
        
        // Ø§Ú¯Ø± Ú©Ø§Ù…ÛŒØ§Ø¨ ÛÙˆØ§ ØªÙˆ ÙˆÛŒØ±ÛŒ Ø§ÛŒØ¨Ù„ Ø§ÙˆØ± Ù…ÛŒÙ…ÙˆØ±ÛŒ Ø§Ù¾ ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº
        vcEnabled = newState;
        localStorage.setItem("vcEnabled", vcEnabled); // Save to browser memory
        vcBtn.innerText = `ğŸ”„ Voice-to-Voice (${vcEnabled ? 'ON' : 'OFF'}) ğŸ”„`;
        
    } catch (err) {
        alert("Failed to toggle Voice-to-Voice: " + err);
    }
});


// 2. Audio Transcriber Logic with Memory
const transBtn = document.getElementById("toggle-transcriber-btn");
let savedTransState = localStorage.getItem("transcriberEnabled");
let transcriberEnabled = savedTransState === "true";

transBtn.innerText = `ğŸ”„ Transcriber (${transcriberEnabled ? 'ON' : 'OFF'}) ğŸ”„`;

transBtn.addEventListener("click", async () => {
    let newState = !transcriberEnabled;
    try {
        const response = await fetch("/api/toggle_transcriber", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `enabled=${newState}`
        });
        const data = await response.json();
        alert(data.message);
        
        transcriberEnabled = newState;
        localStorage.setItem("transcriberEnabled", transcriberEnabled); // Save memory
        transBtn.innerText = `ğŸ”„ Transcriber (${transcriberEnabled ? 'ON' : 'OFF'}) ğŸ”„`;
        
    } catch (err) {
        alert("Failed to toggle Audio Transcriber: " + err);
    }
});


// 3. TTS Feature Logic with Memory
const ttsBtn = document.getElementById("toggle-tts-btn");
const ttsText = document.getElementById("tts-status-text");

// TTS Ú©Û’ Ù„ÛŒÛ’ ÚˆÛŒÙØ§Ù„Ù¹ true ÛÛ’ØŒ Ø§Ú¯Ø± Ù…ÛŒÙ…ÙˆØ±ÛŒ Ù…ÛŒÚº Ú©Ú†Ú¾ Ù†ÛÛŒÚº ØªÙˆ true Ù…Ø§Ù†ÛŒÚº Ú¯Û’
let savedTTSState = localStorage.getItem("ttsEnabled");
// Ø§Ú¯Ø± Ù†Ù„ ÛÛ’ (Ù¾ÛÙ„ÛŒ Ø¨Ø§Ø±) ØªÙˆ trueØŒ ÙˆØ±Ù†Û Ø¬Ùˆ Ù…Ø­ÙÙˆØ¸ ÛÛ’ ÙˆÛ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº
let ttsEnabled = savedTTSState === null ? true : (savedTTSState === "true");

// Ø¨Ù¹Ù† Ú©Ø§ Ø±Ù†Ú¯ Ø§ÙˆØ± Ù¹ÛŒÚ©Ø³Ù¹ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº
function updateTTSUI() {
    ttsText.innerText = ttsEnabled ? "TTS Feature: ON" : "TTS Feature: OFF";
    ttsBtn.style.backgroundColor = ttsEnabled ? "#28a745" : "#dc3545";
}
updateTTSUI(); // Run immediately on load

ttsBtn.addEventListener("click", async () => {
    let newState = !ttsEnabled;
    try {
        const response = await fetch("/api/toggle_tts", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `enabled=${newState}`
        });
        const data = await response.json();
        alert(data.message);

        ttsEnabled = newState;
        localStorage.setItem("ttsEnabled", ttsEnabled); // Save memory
        updateTTSUI();

    } catch (err) {
        alert("TTS Ø¢Ù†/Ø¢Ù Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û Ø¢ÛŒØ§: " + err);
    }
});


// 4. Restart Button Logic (Same as before)
document.getElementById("restart-btn").addEventListener("click", async () => {
    if (!confirm("Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ù¾ÙˆØ±Ø§ Ø³Ø±ÙˆØ± Ø±ÛŒ Ø§Ø³Ù¹Ø§Ø±Ù¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ CMD Ø¯ÙˆØ¨Ø§Ø±Û Ú†Ù„Û’ Ú¯Ø§Û”")) return;
    
    try {
        const response = await fetch("/api/restart", { method: "POST" });
        const data = await response.json();
        alert(data.message + "\n\nThe server will restart in 30s seconds....");
        setTimeout(() => {
            window.location.reload();
        }, 4000);
    } catch (err) {
        alert("Restart failed" + err);
    }
});
</script>

<style>
/* LED lights style */
.led-light {
    position: absolute;
    width: 6px; /* Ø³Ø§Ø¦Ø² ØªÚ¾ÙˆÚ‘Ø§ Ú†Ú¾ÙˆÙ¹Ø§ Ú©ÛŒØ§ ÛÛ’ Ø¨Ù¹Ù† Ú©Û’ Ø­Ø³Ø§Ø¨ Ø³Û’ */
    height: 6px;
    border-radius: 50%;
    background: red;
    animation: spin-led 3s linear infinite;
    animation-delay: calc(var(--i) * 0.25s);
}

/* place lights at corners and edges */
.led-light:nth-child(1) { top: -3px; left: -3px; background: red; }
.led-light:nth-child(2) { top: -3px; left: 50%; transform: translateX(-50%); background: orange; }
.led-light:nth-child(3) { top: -3px; right: -3px; background: yellow; }
.led-light:nth-child(4) { top: 50%; right: -3px; transform: translateY(-50%); background: green; }
.led-light:nth-child(5) { bottom: -3px; right: -3px; background: blue; }
.led-light:nth-child(6) { bottom: -3px; left: 50%; transform: translateX(-50%); background: purple; }
.led-light:nth-child(7) { bottom: -3px; left: -3px; background: pink; }
.led-light:nth-child(8) { top: 50%; left: -3px; transform: translateY(-50%); background: cyan; }

@keyframes spin-led {
    0% { transform: rotate(0deg) translate(40px) rotate(0deg); }
    100% { transform: rotate(360deg) translate(40px) rotate(-360deg); }
}
</style>

<!--.................................. ğŸ”„ Voice-to-Voice (OFF) ğŸ”„ ........... ğŸ”„ Transcriber (OFF) ...........ğŸ”„ TTS Feature: ON âš ï¸ Restart Server ...........................................................-->




                                          
                                             <!-- ğŸŒŸend Added ButtonsÂ -->


<!--.............................................................................................-->

<!-- ============ START: Main Settings Arrow  ============ -->



<!-- ============ start: main collapsible section ============ -->

<!-- Main Settings Collapse Button -->
<button type="button" id="main-settings-toggle" class="w-full text-left mb-6 focus:outline-none group">
    <div class="flex items-center justify-between p-4 bg-slate-100 dark:bg-slate-800 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors border border-slate-300 dark:border-slate-600">
        <span class="text-sm font-bold label-base uppercase tracking-wider">Main Settings</span>
        <span class="text-slate-500 dark:text-slate-400 transition-transform duration-300 ease-in-out group-hover:text-indigo-500">
            <svg id="main-settings-arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 transition-transform duration-300">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
            </svg>
        </span>
    </div>
</button>

<!-- Main Settings Content - ØªÙ…Ø§Ù… Ø³ÛŒÙ¹Ù†Ú¯Ø² Ø§Ø³ ÚˆÛŒÙˆ Ú©Û’ Ø§Ù†Ø¯Ø± ÛÛŒÚº -->
<div id="main-settings-content">

<div class="mb-6">
    <label for="split-text-toggle"
        class="flex items-center cursor-pointer text-sm label-base select-none">
        <input type="checkbox" id="split-text-toggle" name="split_text"
            class="mr-2 h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 dark:border-slate-600 dark:bg-slate-700 dark:focus:ring-offset-slate-800 dark:checked:bg-indigo-500 dark:checked:border-indigo-500">
        Split text into chunks
    </label>
    
    <details class="group">
        <summary class="list-none flex cursor-pointer items-center group mt-2">
            <span class="text-xs font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
                Chunking Details
            </span>
            <span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
                <svg class="group-open:rotate-180 h-4 w-4 transition-transform duration-200 ease-in-out"
                    viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </span>
        </summary>

        <div id="chunk-size-controls" class="flex items-center space-x-2 mt-2">
            <label for="chunk-size-slider" class="text-sm label-base whitespace-nowrap">Chunk
                Size:</label>
            <input type="range" id="chunk-size-slider" name="chunk_size" min="50" max="1000"
                step="10" value="120" class="slider-base w-32">
            <span id="chunk-size-value"
                class="text-sm font-medium text-slate-700 dark:text-slate-300 w-10 text-right tabular-nums">120</span>
        </div>
        <p id="chunk-explanation" class="text-xs text-slate-500 dark:text-slate-400 mt-2">
            Splitting is essential for longer texts like articles or audiobook chapters.
            Recommended chunk size: ~150-400 characters.
        </p>
    </details>
    </div>
<div class="mb-6">
    <details class="group" open>
        <summary class="list-none flex cursor-pointer items-center group">
            <label class="label-base mb-2 m-0 cursor-pointer">Voice Mode:</label>
            <span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
                <svg class="group-open:rotate-180 h-4 w-4 transition-transform duration-200 ease-in-out"
                    viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </span>
        </summary>
        
        <div class="mt-2">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <label class="voice-mode-option" data-mode="predefined">
                    <input type="radio" name="voice_mode" value="predefined" class="hidden peer"
                        checked>
                    <span>Predefined Voices</span>
                </label>
                <label class="voice-mode-option" data-mode="clone">
                    <input type="radio" name="voice_mode" value="clone" class="hidden peer">
                    <span>Voice Cloning (Reference)</span>
                </label>
            </div>

            <div id="predefined-voice-options" class="mb-6 mt-4">
                <details class="group" open>
                    <summary class="list-none flex cursor-pointer items-center group">
                        <span class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
                            Select Predefined Voice:
                        </span>
                        <span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
                            <svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
                                viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </summary>
                    
                    <div class="mt-2 flex items-center gap-2">
                        <select id="predefined-voice-select" name="predefined_voice_select"
                            class="select-base flex-grow">
                            <option value="none">-- Select Voice --</option>
                        </select>
                        <input type="file" id="predefined-voice-file-input" class="hidden" multiple
                            accept=".wav,.mp3" aria-label="Upload predefined voice file">
                        <button type="button" id="predefined-voice-import-button" class="btn-import"
                            title="Import new predefined voice files">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9.25 13.25a.75.75 0 0 0 1.5 0V4.636l2.955 3.129a.75.75 0 0 0 1.09-1.03l-4.25-4.5a.75.75 0 0 0-1.09 0l-4.25 4.5a.75.75 0 1 0 1.09 1.03L9.25 4.636v8.614Z" />
                                <path d="M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z" />
                            </svg>
                            Import
                        </button>
                        <button type="button" id="predefined-voice-refresh-button" class="btn-refresh"
                            title="Refresh predefined voice list">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201-4.42 5.5 5.5 0 0 1 10.89 2.01a.75.75 0 0 1-1.49.174a4 4 0 0 0-7.486-2.641a4 4 0 0 0 6.688 2.947a.75.75 0 0 1 .999.057l-.004-.005ZM4.688 8.576a5.5 5.5 0 0 1 9.201 4.42a5.5 5.5 0 0 1-10.89-2.01a.75.75 0 0 1 1.49-.174a4 4 0 0 0 7.486 2.641a4 4 0 0 0-6.688-2.947a.75.75 0 0 1-.999-.057l.004.005Z"
                                    clip-rule="evenodd" />
                            </svg>
                            Refresh
                        </button>
                    </div>
                </details>
            </div>

            <div id="clone-options" class="mb-6">
                <details class="group">
                    <summary class="list-none flex cursor-pointer items-center group">
                        <span class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
                            Reference Audio File:
                        </span>
                        <span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
                            <svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
                                viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </summary>

                    <div class="mt-2">
                        <p class="text-xs text-slate-500 dark:text-slate-400 mb-2">
                            Select an uploaded <code class="code-inline">.wav</code> or <code
                                class="code-inline">.mp3</code> file.
                            For best results, use clean audio recordings.
                        </p>
                        <div class="flex items-center gap-2">
                            <select id="clone-reference-select" name="clone_reference_select"
                                class="select-base flex-grow">
                                <option value="none">-- Select Reference File --</option>
                            </select>
                            <input type="file" id="clone-file-input" class="hidden" multiple accept=".wav,.mp3"
                                aria-label="Upload reference audio file">
                            <button type="button" id="clone-import-button" class="btn-import"
                                title="Import new reference files">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M9.25 13.25a.75.75 0 0 0 1.5 0V4.636l2.955 3.129a.75.75 0 0 0 1.09-1.03l-4.25-4.5a.75.75 0 0 0-1.09 0l-4.25 4.5a.75.75 0 1 0 1.09 1.03L9.25 4.636v8.614Z" />
                                    <path d="M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z" />
                                </svg>
                                Import
                            </button>
                            <button type="button" id="clone-refresh-button" class="btn-refresh"
                                title="Refresh reference file list">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201-4.42 5.5 5.5 0 0 1 10.89 2.01a.75.75 0 0 1-1.49.174a4 4 0 0 0-7.486-2.641a4 4 0 0 0 6.688 2.947a.75.75 0 0 1 .999.057l-.004-.005ZM4.688 8.576a5.5 5.5 0 0 1 9.201 4.42a5.5 5.5 0 0 1-10.89-2.01a.75.75 0 0 1 1.49-.174a4 4 0 0 0 7.486 2.641a4 4 0 0 0-6.688-2.947a.75.75 0 0 1-.999-.057l.004.005Z"
                                        clip-rule="evenodd" />
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                </details>
            </div>
            </div>
    </details>
    </div>


<!--.............................................................................................-->

                                <!-- ğŸŒŸ Accordion Start Added ButtonsÂ -->


                           <div class="mb-6">
    <details class="group">
        
        <summary class="list-none flex cursor-pointer items-center group">
            <span class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
                Load Example Preset:
            </span>
            <span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
                <svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
                    viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                </svg>
            </span>
        </summary>
        
        <div id="presets-container" class="mt-2 flex flex-wrap gap-2">
            <p id="presets-placeholder" class="text-sm text-slate-500 dark:text-slate-400">
                Loading presets...</p>
        </div>
    </details>
</div>


<div class="mb-6">
    <details class="group" open>
        <summary class="list-none flex cursor-pointer items-center group">
            <span
                class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">Generation
                Parameters</span>
            <span
                class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
                <svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
                    viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                </svg>
            </span>
        </summary>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
            <div>
                

                                    <!-- ğŸŒŸ Accordion end Added ButtonsÂ -->
<!--.............................................................................................-->



                                            <label for="temperature" class="label-base">Temperature (<span
                                                    id="temperature-value"
                                                    class="font-semibold tabular-nums">0.8</span>)</label>
                                            <input type="range" id="temperature" name="temperature" min="0.0" max="1.5"
                                                step="0.01" value="0.8" class="slider-base">
                                        </div>
                                        <div>
                                            <label for="exaggeration" class="label-base">Exaggeration (<span
                                                    id="exaggeration-value"
                                                    class="font-semibold tabular-nums">0.5</span>)</label>
                                            <input type="range" id="exaggeration" name="exaggeration" min="0.0"
                                                max="2.0" step="0.01" value="0.5" class="slider-base">
                                        </div>
                                        <div>
                                            <label for="cfg-weight" class="label-base">CFG Weight (<span
                                                    id="cfg-weight-value"
                                                    class="font-semibold tabular-nums">0.5</span>)</label>
                                            <input type="range" id="cfg-weight" name="cfg_weight" min="0.0" max="2.0"
                                                step="0.01" value="0.5" class="slider-base">
                                        </div>
                                        <div>
                                            <label for="speed-factor" class="label-base">
                                                Speed Factor (<span id="speed-factor-value"
                                                    class="font-semibold tabular-nums">1.0</span>)
                                                <span id="speed-factor-warning"
                                                    class="text-xs text-yellow-600 dark:text-yellow-400 ml-2 hidden"></span>
                                            </label>
                                            <input type="range" id="speed-factor" name="speed_factor" min="0.25"
                                                max="4.0" step="0.05" value="1.0" class="slider-base">
                                        </div>
                                        <div>
                                            <label for="seed" class="label-base">Generation Seed</label>
                                            <div class="w-36">
                                                <input type="number" id="seed" name="seed" value="0"
                                                    placeholder="0 (or -1 for random)" class="input-base"
                                                    title="Enter an integer seed for reproducible results, or -1 for random. 0 may also be random depending on engine.">
                                            </div>
                                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">
                                                Integer for reproducible results. Some engines use 0 or -1 for random.
                                            </p>
                                        </div>

                                        <div id="language-select-container">
                                            <label for="language" class="label-base">Language</label>
                                            <div class="flex items-center gap-2">
                                                <select id="language" name="language" class="select-base flex-grow">
                                                    <option value="en">English (en)</option>
                                                </select>


                                                <button type="button" id="multilingual-toggle-btn" class="btn-import"
                                                    title="Enable multilingual support (downloads additional models)">
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                        fill="currentColor">
                                                        <path fill-rule="evenodd"
                                                            d="M7 2a1 1 0 011 1v1h3a1 1 0 110 2H9.578a18.87 18.87 0 01-1.724 4.78c.29.354.596.696.914 1.026a1 1 0 11-1.44 1.389c-.188-.196-.373-.396-.554-.6a19.098 19.098 0 01-3.107 3.567 1 1 0 01-1.334-1.49 17.087 17.087 0 003.13-3.733 18.992 18.992 0 01-1.487-2.494 1 1 0 111.79-.89c.234.47.489.928.764 1.372.417-.934.752-1.913.997-2.927H3a1 1 0 110-2h3V3a1 1 0 011-1zm6 6a1 1 0 01.894.553l2.991 5.982a.869.869 0 01.02.037l.99 1.98a1 1 0 11-1.79.895L15.383 16h-4.764l-.723 1.447a1 1 0 11-1.79-.894l.99-1.98a.869.869 0 01.02-.037l2.991-5.982A1 1 0 0113 8zm-1.382 6h2.764L13 11.236 11.618 14z"
                                                            clip-rule="evenodd" />
                                                    </svg>
                                                    Enable Multilingual
                                                </button>
                                            </div>
                                            <p id="multilingual-info"
                                                class="text-xs text-slate-500 dark:text-slate-400 mt-1.5 hidden">
                                                Multilingual support requires downloading additional models (~2-3GB).
                                                This happens once when first enabled.
                                            </p>
                                        </div>
                                        <div>


                                            <label for="output-format" class="label-base">Output Format</label>
                                            <select id="output-format" name="output_format" class="select-base w-36">
                                                <option value="wav">WAV</option>
                                                <option value="mp3" selected>MP3</option>
                                                <option value="opus">Opus</option>
                                            </select>
                                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">
                                                MP3 is recommended for smaller file sizes (e.g., audiobooks).
                                            </p>
                                        </div>
                                        <div class="col-span-1 md:col-span-2 mt-4 flex items-center gap-4">
                                            <button id="save-gen-defaults-btn" type="button" class="btn-settings">Save
                                                Generation Parameters</button>
                                            <span id="gen-defaults-status" class="text-xs hidden"></span>
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <div class="mb-6">
                                <details class="group" open> <!-- Server Config expanded by default -->
                                    <summary class="list-none flex cursor-pointer items-center group">
                                        <span
                                            class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">Server
                                            Configuration</span>
                                        <span
                                            class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
                                            <svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
                                                viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </span>
                                    </summary>
                                    <div id="server-config-form"
                                        class="mt-4 border-t border-slate-200 dark:border-slate-700 pt-5">
                                        <p class="text-xs text-slate-500 dark:text-slate-400 mb-4">
                                            These settings are loaded from <code class="code-inline">config.yaml</code>
                                            via an API call.
                                            <strong class="font-medium">Restart the server</strong> to apply changes to
                                            Host, Port, Model, or Path settings if modified here or directly in the
                                            file.
                                        </p>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                            <div><label for="config-server-host" class="label-base text-xs">Server
                                                    Host</label><input type="text" id="config-server-host"
                                                    name="server.host" class="input-base text-sm"></div>
                                            <div><label for="config-server-port" class="label-base text-xs">Server
                                                    Port</label><input type="number" id="config-server-port"
                                                    name="server.port" class="input-base text-sm"></div>
                                            <div><label for="config-tts-engine-device" class="label-base text-xs">TTS
                                                    Device</label><input type="text" id="config-tts-engine-device"
                                                    name="tts_engine.device" class="input-base text-sm"></div>
                                            <div><label for="config-tts-engine-default_voice_id"
                                                    class="label-base text-xs">Default Voice ID</label><input
                                                    type="text" id="config-tts-engine-default_voice_id"
                                                    name="tts_engine.default_voice_id" class="input-base text-sm"></div>
                                            <div><label for="config-paths-model_cache" class="label-base text-xs">Model
                                                    Cache Path</label><input type="text" id="config-paths-model_cache"
                                                    name="paths.model_cache" class="input-base text-sm"></div>
                                            <div><label for="config-tts-engine-predefined_voices_path"
                                                    class="label-base text-xs">Predefined Voices Path</label><input
                                                    type="text" id="config-tts-engine-predefined_voices_path"
                                                    name="tts_engine.predefined_voices_path" class="input-base text-sm">
                                            </div>
                                            <div><label for="config-tts-engine-reference_audio_path"
                                                    class="label-base text-xs">Reference Audio Path</label><input
                                                    type="text" id="config-tts-engine-reference_audio_path"
                                                    name="tts_engine.reference_audio_path" class="input-base text-sm">
                                            </div>
                                            <div><label for="config-paths-output" class="label-base text-xs">Output
                                                    Path</label><input type="text" id="config-paths-output"
                                                    name="paths.output" class="input-base text-sm"></div>
                                            <div><label for="config-audio_output-format"
                                                    class="label-base text-xs">Audio Output Format</label><input
                                                    type="text" id="config-audio_output-format"
                                                    name="audio_output.format" class="input-base text-sm"></div>
                                            <div><label for="config-audio_output-sample_rate"
                                                    class="label-base text-xs">Audio Sample Rate</label><input
                                                    type="number" id="config-audio_output-sample_rate"
                                                    name="audio_output.sample_rate" class="input-base text-sm"></div>

                                            <div
                                                class="col-span-1 md:col-span-2 mt-4 flex flex-col md:flex-row gap-4 items-center">
                                                <button id="save-config-btn" type="button" class="btn-settings">Save
                                                    Server Configuration</button>
                                                <button id="restart-server-btn" type="button"
                                                    class="btn-danger w-full md:w-auto hidden">
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                                        viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                                                        class="w-5 h-5 mr-1.5 inline-block">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
                                                    </svg>
                                                    Restart Server
                                                </button>
                                                <span id="config-status" class="text-xs ml-2 hidden"></span>
                                            </div>
                                        </div>
                                    </div>
                                </details>
                            </div>

                        </div>

<!--.............................................................................................-->

                                <!-- ğŸŒŸ Accordion Start Added ButtonsÂ -->




                        </form>
                </div>


                <div class="card-base mt-4">
                    <details class="group">
                        <summary class="list-none flex cursor-pointer items-center group p-6 sm:p-8">
                            <span class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
                                App Settings
                            </span>
                            <span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
                                <svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
                                    viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                        clip-rule="evenodd" />
                                </svg>
                            </span>
                        </summary>
                        
                        <div class="p-6 sm:p-8 border-t border-slate-200 dark:border-slate-700">
                            <div class="flex items-center">
                                <button id="reset-settings-btn" type="button" class="btn-settings">Reset All Settings</button>
                                <div class="text-xs text-slate-500 dark:text-slate-400 ml-2">
                                    Resets settings to their defaults.
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
                <div id="audio-player-container" class="mt-8"></div>

</div> <!-- End of main-settings-content -->

<!-- ============ END: Main Collapsible Section ============ -->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleBtn = document.getElementById('main-settings-toggle');
        const contentDiv = document.getElementById('main-settings-content');
        const arrowIcon = document.getElementById('main-settings-arrow');

        // 1. Ù¾ÛŒØ¬ Ù„ÙˆÚˆ ÛÙˆÙ†Û’ Ù¾Ø± Ú†ÛŒÚ© Ú©Ø±ÛŒÚº Ú©Û Ù¾Ø±Ø§Ù†ÛŒ Ø³ÛŒÙ¹Ù†Ú¯ Ú©ÛŒØ§ ØªÚ¾ÛŒ (Saved State)
        const isHidden = localStorage.getItem('mainSettingsHidden') === 'true';
        
        // ÙÙ†Ú©Ø´Ù† Ø¬Ùˆ Ø­Ø§Ù„Øª (State) Ú©Ùˆ Ø³ÛŒÙ¹ Ú©Ø±Û’ Ú¯Ø§
        function applyState(hidden) {
            if (hidden) {
                contentDiv.classList.add('hidden'); // Ú†Ú¾Ù¾Ø§ Ø¯ÛŒÚº
                arrowIcon.style.transform = 'rotate(-90deg)'; // ØªÛŒØ± Ú©Ø§ Ø±Ø® Ù…ÙˆÚ‘ Ø¯ÛŒÚº
            } else {
                contentDiv.classList.remove('hidden'); // Ø¯Ú©Ú¾Ø§ Ø¯ÛŒÚº
                arrowIcon.style.transform = 'rotate(0deg)'; // ØªÛŒØ± Ø³ÛŒØ¯Ú¾Ø§ Ø±Ú©Ú¾ÛŒÚº
            }
        }

        // Ø´Ø±ÙˆØ¹ Ù…ÛŒÚº Ø­Ø§Ù„Øª Ù„Ø§Ú¯Ùˆ Ú©Ø±ÛŒÚº
        applyState(isHidden);

        // 2. Ø¬Ø¨ Ø¨Ù¹Ù† Ù¾Ø± Ú©Ù„Ú© ÛÙˆ
        toggleBtn.addEventListener('click', function(e) {
            e.preventDefault(); // ÙØ§Ø±Ù… Ø³Ø¨Ù…Ù¹ ÛÙˆÙ†Û’ Ø³Û’ Ø±ÙˆÚ©ÛŒÚº
            
            // Ú†ÛŒÚ© Ú©Ø±ÛŒÚº Ú©Û Ø§Ø¨Ú¾ÛŒ Ú†Ú¾Ù¾Ø§ ÛÙˆØ§ ÛÛ’ ÛŒØ§ Ù†ÛÛŒÚº
            const currentlyHidden = contentDiv.classList.contains('hidden');
            const newState = !currentlyHidden; // Ø§Ù„Ù¹ Ú©Ø± Ø¯ÛŒÚº
            
            // Ù†Ø¦ÛŒ Ø­Ø§Ù„Øª Ù„Ø§Ú¯Ùˆ Ú©Ø±ÛŒÚº
            applyState(newState);
            
            // Ø¨Ø±Ø§Ø¤Ø²Ø± Ú©ÛŒ Ù…ÛŒÙ…ÙˆØ±ÛŒ Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº
            localStorage.setItem('mainSettingsHidden', newState);
        });
    });
</script>



<!-- ============ END: Main Settings Collapsible Section ============ -->

                                       <!-- ğŸŒŸ Audio File Name ButtonsÂ -->


<!--.............................................................................................-->

                               
                <!-- ğŸŒŸ Audio Name Section - FORM KE BAHAR RAKHA HAI -->
                <div class="card-base mt-6">
                    <div class="p-6 sm:p-8">
                        <h3 class="card-header mb-4">Audio File Name</h3>
                        <div class="mb-4">
                            <label for="audio-name" class="label-base">Custom Audio Name</label>
                            <div class="flex items-center gap-2">
                                <input type="text" id="audio-name" name="audio_name" class="input-base flex-grow" 
                                       placeholder="Enter custom name for audio file (without extension)">
                                <button type="button" id="set-audio-name-btn" class="btn-primary">
                                    Set Audio Name
                                </button>
                            </div>
                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">
                                Set a custom name for the generated audio file. If empty, default name will be used.
                                <strong>Current name:</strong> <span id="current-audio-name" class="font-semibold">Default</span>
                            </p>
                        </div>
                    </div>
                </div>

                <div id="audio-player-container" class="mt-8"></div>

                <div class="mt-10">
                    

        <footer class="bg-slate-100 dark:bg-slate-800 py-8 mt-16 border-t border-slate-200 dark:border-slate-700/80">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex justify-center">
                    
                            <path
                                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" />
                        </svg>
                       
                    </a>
                </div>
            </div>
        </footer>
    </div>

                                 <!-- ğŸŒŸ loading Added ButtonsÂ -->

<!--.............................................................................................-->

    <div id="loading-overlay" class="loading-overlay-base hidden opacity-0" data-state="closed" style="display: none;">
        <div class="loading-box-base">
            
            <div class="relative flex items-center justify-center mb-4" style="width: 50px; height: 50px;">
                <div class="colorful-spinner-small absolute w-full h-full rounded-full"></div>
                
                <p id="counter" class="text-xl font-bold text-indigo-500 dark:text-indigo-400 tabular-nums relative z-10">0</p>
            </div>
            <p id="loading-message" class="loading-text">Generating audio...</p>
            <p id="loading-status" class="loading-status">Please wait.</p>
            <button id="loading-cancel-btn" type="button" class="btn-secondary mt-1"
                title="Cancel UI request. Backend may continue briefly.">Cancel</button>
        </div>
    </div>
    
    <style>
    /* Ensure this CSS block is present in your HTML file for styling and animation */
    .colorful-spinner-small {
        width: 50px;
        height: 50px;
        
        /* Smaller, colorful gradient border */
        background: conic-gradient(
            #ff0000, 
            #ff8c00, 
            #ffd700, 
            #32cd32, 
            #00bfff, 
            #9932cc, 
            #ff0000  
        );
        
        /* Animation for spinning */
        animation: spin 1.5s linear infinite; 
        
        /* Creates the small ring effect */
        -webkit-mask: radial-gradient(circle at center, transparent 15px, black 18px);
        mask: radial-gradient(circle at center, transparent 15px, black 18px);
    }

    /* Define the spinning animation */
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    </style>




    <script>
        // Global variables for counter logic
        let counterInterval = null;
        let counterValue = 0;

        // Function to start the counter: 1, 2, 3...
        function startCounter() {
            const counterElement = document.getElementById('counter');
            if (!counterElement) return;

            counterValue = 0;
            counterElement.textContent = counterValue;
            
            // Starts counting every 1 second (1000ms)
            counterInterval = setInterval(() => {
                counterValue++;
                counterElement.textContent = counterValue;
            }, 1000); 
        }

        // Function to stop and reset the counter
        function stopCounter() {
            if (counterInterval !== null) {
                clearInterval(counterInterval);
                counterInterval = null;
            }
            const counterElement = document.getElementById('counter');
            if(counterElement) {
                 counterElement.textContent = '0';
            }
        }
        
        // --- Integration Logic ---
        // This watches the loading popup to start/stop the counter automatically.
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingCancelBtn = document.getElementById('loading-cancel-btn');

        if (loadingOverlay) {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'data-state') {
                        const newState = loadingOverlay.getAttribute('data-state');
                        if (newState === 'open') {
                            startCounter(); // Start counting when the popup shows
                        } else if (newState === 'closed') {
                            stopCounter();  // Stop counting when the popup hides
                        }
                    }
                });
            });

            // Start observing the loading overlay for changes
            observer.observe(loadingOverlay, { attributes: true });
        }

        // Stops the counter if the user clicks Cancel
        if (loadingCancelBtn) {
            loadingCancelBtn.addEventListener('click', stopCounter);
        }

    </script>
 
<!--.............................................................................................-->


    <!-- Other modals -->
    <div id="chunk-warning-modal" class="modal-overlay hidden opacity-0" data-state="closed" style="display: none;">
        <!-- ... existing modal content ... -->
    </div>

    <div id="generation-warning-modal" class="modal-overlay hidden opacity-0" data-state="closed"
        style="display: none;">
        <!-- ... existing modal content ... -->
    </div>

    <script src="script.js" defer></script>

      <script src="script.js" defer></script>

        <script src="script.js" defer></script>









<!-- ğŸŒŸ Fixed Custom Audio Name Download Script - COMPLETE REPLACEMENT --> 
   
<!-- ğŸŒŸ Fixed Custom Audio Name Download Script - UPDATED -->
<!-- ğŸŒŸ Fixed Custom Audio Name Download Script - COMPLETE REPLACEMENT -->
<script>
    // Audio name functionality - COMPLETE SOLUTION
    document.addEventListener('DOMContentLoaded', function() {
        const audioNameInput = document.getElementById('audio-name');
        const setAudioNameBtn = document.getElementById('set-audio-name-btn');
        const currentAudioNameSpan = document.getElementById('current-audio-name');
        const generateBtn = document.getElementById('generate-btn');
        let customAudioName = '';
        let isGenerating = false;

        // Set custom audio name
        setAudioNameBtn.addEventListener('click', function() {
            customAudioName = audioNameInput.value.trim();
            if (customAudioName) {
                currentAudioNameSpan.textContent = customAudioName;
                currentAudioNameSpan.className = 'font-semibold text-green-600 dark:text-green-400';
                showNotification(`Audio name set to: ${customAudioName}`, 'success');
            } else {
                currentAudioNameSpan.textContent = 'Default';
                currentAudioNameSpan.className = 'font-semibold';
                showNotification('Audio name cleared', 'info');
            }
        });

        // Replace the original generate button functionality
        if (generateBtn) {
            // Remove any existing event listeners
            const newGenerateBtn = generateBtn.cloneNode(true);
            generateBtn.parentNode.replaceChild(newGenerateBtn, generateBtn);

            newGenerateBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopImmediatePropagation();

                if (isGenerating) {
                    showNotification('Please wait, audio is already generating...', 'info');
                    return;
                }

                generateTTSAudioWithCustomName();
            });
        }

        async function generateTTSAudioWithCustomName() {
            if (isGenerating) return;
            isGenerating = true;

            // Show loading state
            const generateBtn = document.getElementById('generate-btn');
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1.5 inline-block animate-spin"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" /></svg> Generating...';
            generateBtn.disabled = true;

            try {
                // Get all form data
                const requestData = {
                    text: document.getElementById('text').value.trim(),
                    voice_mode: document.querySelector('input[name="voice_mode"]:checked').value,
                    temperature: parseFloat(document.getElementById('temperature').value),
                    exaggeration: parseFloat(document.getElementById('exaggeration').value),
                    cfg_weight: parseFloat(document.getElementById('cfg-weight').value),
                    seed: parseInt(document.getElementById('seed').value),
                    speed_factor: parseFloat(document.getElementById('speed-factor').value),
                    language: document.getElementById('language').value,
                    output_format: document.getElementById('output-format').value,
                    split_text: document.getElementById('split-text-toggle').checked,
                    chunk_size: parseInt(document.getElementById('chunk-size-slider').value) || 120,
                    audio_name: customAudioName || ''
                };

                // Add voice-specific data
                if (requestData.voice_mode === 'predefined') {
                    const voiceSelect = document.getElementById('predefined-voice-select');
                    requestData.predefined_voice_id = voiceSelect.value;
                    if (!requestData.predefined_voice_id || requestData.predefined_voice_id === 'none') {
                        throw new Error('Please select a predefined voice');
                    }
                } else if (requestData.voice_mode === 'clone') {
                    const cloneSelect = document.getElementById('clone-reference-select');
                    requestData.reference_audio_filename = cloneSelect.value;
                    if (!requestData.reference_audio_filename || requestData.reference_audio_filename === 'none') {
                        throw new Error('Please select a reference audio file');
                    }
                }

                // Validate text
                if (!requestData.text) {
                    throw new Error('Please enter text to synthesize');
                }

                showNotification('Generating audio... You can minimize the screen now. Audio will download automatically.', 'info');

                // ğŸ”§ Ù…ÙˆØ¨Ø§Ø¦Ù„ Ø¨ÛŒÚ© Ú¯Ø±Ø§Ø¤Ù†Úˆ Ø³Ù¾ÙˆØ±Ù¹ Ú©Û’ Ù„ÛŒÛ’ Ø§ÛÙ… ØªØ¨Ø¯ÛŒÙ„ÛŒ
                setTimeout(() => {
                    document.body.style.cursor = 'wait';
                }, 100);

                const response = await fetch('/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Server error: ${response.status} - ${errorText}`);
                }

                const blob = await response.blob();

                if (blob.size === 0) {
                    throw new Error('Generated audio is empty');
                }

                // ğŸ”§ Ù…ÙˆØ¨Ø§Ø¦Ù„ ÚˆØ§Ø¤Ù†Ù„ÙˆÚˆ Ú©Û’ Ù„ÛŒÛ’ Ø³Ø§Ø¯Û Ø§ÙˆØ± Ù…Ø³ØªØ­Ú©Ù… Ø·Ø±ÛŒÙ‚Û (NO IFRAME, NO FORM)
                const url = window.URL.createObjectURL(blob);

                let finalFilename;
                if (customAudioName) {
                    finalFilename = `${customAudioName}.${requestData.output_format}`;
                } else {
                    const contentDisposition = response.headers.get('Content-Disposition');
                    if (contentDisposition && contentDisposition.includes('filename=')) {
                        const match = contentDisposition.match(/filename="([^"]+)"/);
                        finalFilename = match ? match[1] : `tts_output.${requestData.output_format}`;
                    } else {
                        finalFilename = `tts_output.${requestData.output_format}`;
                    }
                }

                // Anchor-based download â€“ mobile friendly
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = finalFilename;
                document.body.appendChild(a);
                a.click();

                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 5000);

                showNotification(`Audio "${finalFilename}" download started. Check your downloads folder.`, 'success');

            } catch (error) {
                console.error('Error generating TTS audio:', error);
                showNotification('Error: ' + error.message, 'error');
            } finally {
                // Restore button state
                isGenerating = false;
                document.body.style.cursor = 'default';
                const generateBtn = document.getElementById('generate-btn');
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }

        // Helper function to show notifications (for TTS only)
        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notification-area');
            if (notificationArea) {
                const notification = document.createElement('div');
                notification.className = `p-3 rounded-md mb-2 ${
                    type === 'success' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :
                    type === 'error' ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' :
                    'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'
                }`;
                notification.textContent = message;
                notificationArea.appendChild(notification);

                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }
        }

        // ğŸ”§ Ù…ÙˆØ¨Ø§Ø¦Ù„ Ú©Ø§Ù¾ÛŒ/Ù¾ÛŒØ³Ù¹ Ú©Û’ Ù…Ø³Ø§Ø¦Ù„ Ú©Ø§ Ø­Ù„ â€“ Ø¨ØºÛŒØ± Ú©Ø³ÛŒ popup Ú©Û’
        const textarea = document.getElementById("text");
        const copyBtn = document.getElementById("copy-btn");
        const pasteBtn = document.getElementById("paste-btn");
        const clearBtn = document.getElementById("clear-btn");
        const popup = document.getElementById("popup-msg"); // Ù…ÙˆØ¬ÙˆØ¯ Ø±ÛÛ’ØŒ Ù…Ú¯Ø± Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ù†ÛÛŒÚº Ú©Ø±ÛŒÚº Ú¯Û’

        function showPopup(message) {
            // INTENTIONALLY LEFT BLANK for copy/paste (no visual popup)
            // TUM NE CLEAR KIA THA: "copy/paste pe koi popup na aaye"
        }

        // COPY â€“ no popup, no overlay
        if (copyBtn && textarea) {
            copyBtn.addEventListener("click", async () => {
                try {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        await navigator.clipboard.writeText(textarea.value || "");
                    } else {
                        textarea.focus();
                        textarea.select();
                        textarea.setSelectionRange(0, textarea.value.length);
                        document.execCommand('copy');
                        textarea.setSelectionRange(textarea.value.length, textarea.value.length);
                    }
                } catch (err) {
                    textarea.focus();
                    textarea.select();
                }
            });
        }

        // PASTE â€“ Ø¨Ø³ text add ÛÙˆØŒ Ú©ÙˆØ¦ÛŒ box/popup Ù†ÛÛŒÚº
        if (pasteBtn && textarea) {
            pasteBtn.addEventListener("click", async () => {
                try {
                    if (navigator.clipboard && navigator.clipboard.readText) {
                        const text = await navigator.clipboard.readText();
                        if (text) {
                            textarea.value += (textarea.value ? "\n" : "") + text;
                            const charCountEl = document.getElementById("char-count");
                            if (charCountEl) {
                                charCountEl.innerText = textarea.value.length;
                            }
                        }
                    } else {
                        // Ø§Ú¯Ø± API Ù†Û ÛÙˆ ØªÙˆ ØµØ±Ù focus Ú©Ø±ÙˆØŒ user Ø®ÙˆØ¯ long-press Ú©Ø±Ú©Û’ paste Ú©Ø±Û’
                        textarea.focus();
                    }
                } catch (err) {
                    textarea.focus();
                }
            });
        }

        // CLEAR â€“ ØµØ±Ù ØµØ§Ù Ú©Ø±Û’ Ø§ÙˆØ± count resetØŒ Ú©ÙˆØ¦ÛŒ popup Ù†ÛÛŒÚº
        if (clearBtn && textarea) {
            clearBtn.addEventListener("click", () => {
                textarea.value = "";
                const charCountEl = document.getElementById("char-count");
                if (charCountEl) {
                    charCountEl.innerText = "0";
                }
            });
        }

        if (textarea) {
            textarea.addEventListener("input", () => {
                const charCountEl = document.getElementById("char-count");
                if (charCountEl) {
                    charCountEl.innerText = textarea.value.length;
                }
            });
        }

        console.log('Custom TTS interface loaded successfully - Mobile optimized version (download + copy/paste fixed)');
    });
</script>




<!-- Mobile optimization notice -->

<div class="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
<div class="mb-2">
    <a href="https://nzg73.blogspot.com" 
       target="_blank" 
       rel="noopener noreferrer"
       class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 underline text-sm">
        <span class="font-medium">WebsiteğŸ‘‰NZG73</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg>
    </a>
</div>

<div class="mb-2">
    <a href="https://www.youtube.com/@NZG73" 
       target="_blank" 
       rel="noopener noreferrer"
       class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 underline text-sm">
        <span class="font-medium">YouTubeğŸ‘‰NZG73</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg>
    </a>
</div>



 <!-- Alpine.js Required -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<div x-data="{ open: false }" class="w-full">

    <!-- Alpine.js Required -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<div x-data="{ open: false }" class="w-full">

    <!-- Accordion Header -->
    <button 
        @click="open = !open"
        class="w-full text-left px-3 py-2 bg-yellow-800 text-yellow-200 font-semibold rounded-md">
        NZG 73
        <span class="float-right" x-text="open ? 'ğŸ”¼ğŸ¥°ğŸ˜â–²' : 'ğŸ”½ğŸ¥ºğŸ‘‰ğŸ»â–¼'"></span>
    </button>

    <!-- Accordion Content -->
    <div x-show="open" x-collapse class="mt-2">

        <ul class="text-xs text-yellow-700 dark:text-yellow-300 space-y-1 p-2 bg-yellow-50 dark:bg-yellow-900 rounded-md">

            <h3 class="text-sm font-semibold text-yellow-800 dark:text-yellow-200 mb-2">ğŸ“± Ù…ÙˆØ¨Ø§Ø¦Ù„ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Û’ Ù„ÛŒÛ’ ÛØ¯Ø§ÛŒØ§Øª:</h3>
    <ul class="text-xs text-yellow-700 dark:text-yellow-300 space-y-1">
        <li>â€¢ Ø¢ÚˆÛŒÙˆ Ø¬Ù†Ø±ÛŒØ´Ù† Ú©Û’ Ø¯ÙˆØ±Ø§Ù† Ø¢Ù¾ Ø§Ø³Ú©Ø±ÛŒÙ† ØªØ¨Ø¯ÛŒÙ„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº</li>
        <li>â€¢ Ø¢ÚˆÛŒÙˆ Ø®ÙˆØ¯ Ø¨Ø®ÙˆØ¯ Ø¢Ù¾ Ú©Û’ ÚˆØ§Ø¤Ù†Ù„ÙˆÚˆØ² ÙÙˆÙ„ÚˆØ± Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯ÛŒ</li>
        <li>â€¢ Ú©Ø§Ù¾ÛŒ/Ù¾ÛŒØ³Ù¹ Ú©Û’ Ù„ÛŒÛ’ Ø¨Ù¹Ù† Ù¾Ø± Ù„Ù…Ø¨Ø§ Ù¾Ø±ÛŒØ³ Ú©Ø±ÛŒÚº</li>
        <li>â€¢ Ø§Ú¯Ø± ÚˆØ§Ø¤Ù†Ù„ÙˆÚˆ Ù†Û ÛÙˆ ØªÙˆ Ø§ÛŒÚ© Ø¨Ø§Ø± Ø¯ÙˆØ¨Ø§Ø±Û Ø¬Ù†Ø±ÛŒÙ¹ Ú©Ø±ÛŒÚº</li>
<h3 class="text-sm font-semibold text-yellow-800 dark:text-yellow-200 mb-2">ğŸ“± Instructions for Mobile Usage</h3>
<li>â€¢ You can change screen during audio generation</li>
        <li>â€¢ The audio will automatically be saved in your Downloads folder</li>
        <li>â€¢ Long press the button to copy/paste</li>
        <li>â€¢ Regenerate once if not downloaded</li>

        </ul>

    </div>
</div>
<!-- END Alpine.js Required -->
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<style>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUDIO & VIDEO EDITOR STYLES - OFFLINE TOOL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.editor-main-container {
    background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
    min-height: 100vh;
    padding: 20px;
}

.tool-section {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    margin-bottom: 20px;
    overflow: hidden;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.tool-section:hover {
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
}

.section-header {
    background: linear-gradient(90deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2));
    padding: 20px 25px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
}

.section-header:hover {
    background: linear-gradient(90deg, rgba(99, 102, 241, 0.3), rgba(168, 85, 247, 0.3));
}

.section-header h2 {
    margin: 0;
    font-size: 1.4rem;
    font-weight: 700;
    background: linear-gradient(90deg, #818cf8, #c084fc);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.collapse-arrow {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 1.2rem;
}

.collapse-arrow.collapsed {
    transform: rotate(-90deg);
}

.section-content {
    padding: 25px;
    max-height: 2000px;
    overflow: hidden;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.section-content.hidden {
    max-height: 0;
    padding: 0 25px;
    opacity: 0;
}

/* Language Toggle Button */
.lang-toggle-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    background: linear-gradient(135deg, #6366f1, #a855f7);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
    transition: all 0.3s ease;
    font-family: 'Segoe UI', 'Noto Nastaliq Urdu', sans-serif;
}

.lang-toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 30px rgba(99, 102, 241, 0.6);
}

/* Upload Zones */
.upload-zone {
    border: 3px dashed rgba(99, 102, 241, 0.4);
    border-radius: 20px;
    padding: 50px 30px;
    text-align: center;
    transition: all 0.3s ease;
    background: rgba(99, 102, 241, 0.05);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.upload-zone:hover, .upload-zone.drag-over {
    border-color: #6366f1;
    background: rgba(99, 102, 241, 0.15);
    transform: scale(1.01);
}

.upload-zone input[type="file"] {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    opacity: 0;
    cursor: pointer;
}

.upload-icon {
    font-size: 4rem;
    margin-bottom: 15px;
    display: block;
}

.upload-text {
    color: #a5b4fc;
    font-size: 1.1rem;
}

.upload-hint {
    color: rgba(165, 180, 252, 0.6);
    font-size: 0.9rem;
    margin-top: 10px;
}

/* Waveform Containers */
.waveform-container {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
    position: relative;
}

.waveform-label {
    position: absolute;
    top: 10px;
    left: 15px;
    font-size: 0.85rem;
    font-weight: 600;
    padding: 5px 12px;
    border-radius: 20px;
    z-index: 10;
}

.waveform-label.input-label {
    background: rgba(239, 68, 68, 0.2);
    color: #fca5a5;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.waveform-label.output-label {
    background: rgba(34, 197, 94, 0.2);
    color: #86efac;
    border: 1px solid rgba(34, 197, 94, 0.3);
}

.waveform-canvas {
    width: 100%;
    height: 120px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.2);
}

.waveform-timer {
    position: absolute;
    bottom: 10px;
    right: 15px;
    font-family: 'Courier New', monospace;
    font-size: 1.1rem;
    color: #e2e8f0;
    background: rgba(0, 0, 0, 0.5);
    padding: 5px 12px;
    border-radius: 8px;
}

/* Control Sliders */
.control-group {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
}

.control-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    color: #e2e8f0;
    font-weight: 500;
}

.control-value {
    background: linear-gradient(135deg, #6366f1, #a855f7);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
}

.control-slider {
    width: 100%;
    height: 8px;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.1);
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    cursor: pointer;
}

.control-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6366f1, #a855f7);
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.5);
    transition: all 0.2s ease;
}

.control-slider::-webkit-slider-thumb:hover {
    transform: scale(1.2);
}

.control-slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6366f1, #a855f7);
    cursor: pointer;
    border: none;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.5);
}

/* Process Buttons */
.process-btn {
    background: linear-gradient(135deg, #6366f1, #8b5cf6, #a855f7);
    color: white;
    border: none;
    padding: 16px 40px;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
    display: inline-flex;
    align-items: center;
    gap: 10px;
}

.process-btn:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(99, 102, 241, 0.6);
}

.process-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.process-btn.processing {
    background: linear-gradient(135deg, #f59e0b, #f97316);
}

.download-btn {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    padding: 14px 35px;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
    display: inline-flex;
    align-items: center;
    gap: 10px;
}

.download-btn:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(16, 185, 129, 0.6);
}

.download-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Video Preview */
.video-preview-container {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 20px;
    padding: 20px;
    margin: 20px 0;
}

.video-preview {
    width: 100%;
    max-height: 400px;
    border-radius: 15px;
    background: #000;
    object-fit: contain;
}

/* Progress Bar */
.progress-container {
    width: 100%;
    height: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    margin: 20px 0;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #6366f1, #a855f7, #ec4899);
    border-radius: 10px;
    width: 0%;
    transition: width 0.3s ease;
    background-size: 200% 100%;
    animation: progressShine 2s linear infinite;
}

@keyframes progressShine {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

.progress-text {
    text-align: center;
    color: #a5b4fc;
    font-weight: 600;
    margin-top: 10px;
}

/* Audio Player */
.audio-player-wrapper {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
}

.audio-player-wrapper audio {
    width: 100%;
    border-radius: 10px;
}

/* Buttons Container */
.buttons-row {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    margin-top: 25px;
}

/* File Info */
.file-info {
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: 12px;
    padding: 15px 20px;
    margin: 15px 0;
    display: flex;
    align-items: center;
    gap: 15px;
}

.file-info-icon {
    font-size: 2rem;
}

.file-info-details {
    flex: 1;
}

.file-info-name {
    font-weight: 600;
    color: #e2e8f0;
    word-break: break-all;
}

.file-info-size {
    color: #a5b4fc;
    font-size: 0.9rem;
}

.file-remove-btn {
    background: rgba(239, 68, 68, 0.2);
    border: none;
    color: #fca5a5;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.2rem;
}

.file-remove-btn:hover {
    background: rgba(239, 68, 68, 0.4);
}

/* RTL Support for Urdu */
[dir="rtl"] .section-header {
    flex-direction: row-reverse;
}

[dir="rtl"] .control-label {
    flex-direction: row-reverse;
}

[dir="rtl"] .file-info {
    flex-direction: row-reverse;
}

[dir="rtl"] .waveform-label {
    left: auto;
    right: 15px;
}

[dir="rtl"] .waveform-timer {
    right: auto;
    left: 15px;
}

[dir="rtl"] .lang-toggle-btn {
    right: auto;
    left: 20px;
}

/* Responsive */
@media (max-width: 768px) {
    .editor-main-container {
        padding: 10px;
    }
    
    .section-header h2 {
        font-size: 1.1rem;
    }
    
    .upload-zone {
        padding: 30px 20px;
    }
    
    .upload-icon {
        font-size: 3rem;
    }
    
    .control-group {
        padding: 15px;
    }
    
    .process-btn, .download-btn {
        width: 100%;
        justify-content: center;
    }
    
    .buttons-row {
        flex-direction: column;
    }
}

/* Preset Buttons */
.preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 15px 0;
}

.preset-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e2e8f0;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.preset-btn:hover {
    background: rgba(99, 102, 241, 0.3);
    border-color: #6366f1;
}

.preset-btn.active {
    background: linear-gradient(135deg, #6366f1, #a855f7);
    border-color: transparent;
}

/* Checkbox Toggle */
.toggle-container {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 10px 0;
}

.toggle-switch {
    position: relative;
    width: 50px;
    height: 26px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.2);
    transition: 0.4s;
    border-radius: 26px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background: white;
    transition: 0.4s;
    border-radius: 50%;
}

.toggle-switch input:checked + .toggle-slider {
    background: linear-gradient(135deg, #6366f1, #a855f7);
}

.toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(24px);
}

.toggle-label {
    color: #e2e8f0;
    font-weight: 500;
}

/* Status Messages */
.status-message {
    padding: 15px 20px;
    border-radius: 12px;
    margin: 15px 0;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 500;
}

.status-message.info {
    background: rgba(59, 130, 246, 0.2);
    border: 1px solid rgba(59, 130, 246, 0.3);
    color: #93c5fd;
}

.status-message.success {
    background: rgba(34, 197, 94, 0.2);
    border: 1px solid rgba(34, 197, 94, 0.3);
    color: #86efac;
}

.status-message.error {
    background: rgba(239, 68, 68, 0.2);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #fca5a5;
}

.status-icon {
    font-size: 1.3rem;
}

 </style>
</head>
<body>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Audio Cleaner Pro - COMPLETE OFFLINE TOOL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->


<div class="tool-section" id="audioCleanerProSection" style="margin-top: 20px;">
        <div class="section-header" onclick="toggleSection('audioCleanerProContent', 'audioCleanerProArrow')">
            <h2 id="acpMainTitle">ğŸ›ï¸ Audio Cleaner Pro (Offline)</h2>
            <div class="collapse-arrow" id="audioCleanerProArrow">â–¼</div>
        </div>
        
        <div class="section-content hidden" id="audioCleanerProContent">
            
            <style>
                #proCleanerWrapper {
                    font-family: 'Arial', sans-serif;
                    background-color: #f0f2f5;
                    padding: 15px;
                    border-radius: 10px;
                    color: #333;
                    text-align: center;
                }
                #proCleanerWrapper h2 { color: #075e54; font-size: 20px; margin-bottom: 10px; }
                
                /* Lang Button */
                .acp-lang-btn {
                    background-color: #128c7e; color: white; border: none;
                    padding: 5px 15px; border-radius: 20px; cursor: pointer;
                    font-weight: bold; font-size: 13px; margin-bottom: 15px;
                }

                /* Upload Box */
                .acp-upload-box {
                    border: 2px dashed #128c7e; padding: 20px;
                    border-radius: 10px; margin-bottom: 20px;
                    background-color: #e9ebee; cursor: pointer; position: relative;
                }
                .acp-upload-box input {
                    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                    opacity: 0; cursor: pointer;
                }

                /* Controls */
                .acp-controls-box {
                    background: #fff; padding: 15px; border-radius: 10px;
                    margin-bottom: 15px; text-align: left; border: 1px solid #ddd;
                }
                .acp-control-group { margin-bottom: 15px; }
                .acp-control-group label { display: block; font-weight: bold; font-size: 14px; color: #075e54; }
                .acp-control-group small { color: #666; font-size: 12px; display: block; margin-bottom: 5px; }
                .acp-slider { width: 100%; cursor: pointer; }

                /* Action Buttons */
                .acp-action-btn {
                    width: 100%; padding: 12px; font-size: 16px; border: none;
                    border-radius: 8px; color: white; font-weight: bold; cursor: pointer;
                    margin-top: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                }
                #acpProcessBtn { background-color: #25d366; }
                #acpDownloadBtn { background-color: #34b7f1; display: none; }

                /* Canvas */
                .acp-canvas { width: 100%; height: 80px; background-color: #333; border-radius: 5px; margin-top:5px; }
                
                /* About */
                .acp-about { margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc; font-size: 13px; }
                .acp-link { display: inline-block; margin: 5px; padding: 6px 12px; color: white; border-radius: 4px; text-decoration: none; font-weight: bold; }
                .acp-yt { background: #FF0000; }
                .acp-em { background: #EA4335; }

                /* Urdu Mode Class */
                .acp-urdu-mode { direction: rtl; }
                .acp-urdu-mode .acp-controls-box { text-align: right; }
            </style>

            <div id="proCleanerWrapper">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2 id="acp_txt_title">Audio Cleaner Pro</h2>
                    <button class="acp-lang-btn" onclick="acp_toggleLanguage()" id="acp_btn_lang">Ø§Ø±Ø¯Ùˆ</button>
                </div>

                <div class="acp-upload-box">
                    <p id="acp_txt_upload" style="margin:0; font-size:16px;">ğŸ“‚ Upload Audio (Click Here)</p>
                    <input type="file" id="acpAudioInput" accept="audio/*" onchange="acp_handleFile(this)">
                </div>

                <div id="acpSecOrig" style="display:none; margin-bottom:15px; background:white; padding:10px; border-radius:8px;">
                    <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:bold;">
                        <span style="color:#d32f2f;" id="acp_lbl_orig">Original:</span>
                        <span id="acpTimeOrig">00:00</span>
                    </div>
                    <canvas id="acpCvsOrig" class="acp-canvas"></canvas>
                    <audio id="acpAudOrig" controls style="width:100%; margin-top:5px; height:30px;"></audio>
                </div>

                <div class="acp-controls-box" id="acpCtrlBox" style="display:none;">
                    
                    <div class="acp-control-group">
                        <label id="acp_lbl_gate">1. Silence Remover (Gate): <span id="acpValGate">0.02</span></label>
                        <small id="acp_desc_gate">Removes parts where no one is speaking.</small>
                        <input type="range" class="acp-slider" id="acpRngGate" min="0.001" max="0.1" step="0.001" value="0.02" oninput="acp_updVals()">
                    </div>

                    <div class="acp-control-group">
                        <label id="acp_lbl_hiss">2. Hiss Removal (High Freq): <span id="acpValHiss">3000 Hz</span></label>
                        <small id="acp_desc_hiss">Removes shhh/hiss sounds. (Lower = More cleaning)</small>
                        <input type="range" class="acp-slider" id="acpRngHiss" min="1000" max="8000" step="100" value="5000" oninput="acp_updVals()">
                    </div>

                    <div class="acp-control-group">
                        <label id="acp_lbl_rumble">3. Rumble Removal (Low Freq): <span id="acpValRumble">85 Hz</span></label>
                        <small id="acp_desc_rumble">Removes heavy wind/mic bumps.</small>
                        <input type="range" class="acp-slider" id="acpRngRumble" min="0" max="300" step="10" value="85" oninput="acp_updVals()">
                    </div>

                    <button id="acpProcessBtn" class="acp-action-btn" onclick="acp_processAudio()">âœ¨ Clean & Process Audio</button>
                    <p id="acpStatus" style="font-weight:bold; margin-top:10px; color:#555; text-align:center;"></p>
                </div>

                <div id="acpSecProc" style="display:none; margin-bottom:15px; background:white; padding:10px; border-radius:8px;">
                    <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:bold;">
                        <span style="color:#2e7d32;" id="acp_lbl_proc">Result (Cleaned):</span>
                        <span id="acpTimeProc">00:00</span>
                    </div>
                    <canvas id="acpCvsProc" class="acp-canvas"></canvas>
                    <audio id="acpAudProc" controls style="width:100%; margin-top:5px; height:30px;"></audio>
                </div>

                <button id="acpDownloadBtn" class="acp-action-btn" onclick="acp_downloadFile()">â¬‡ï¸ Download Clean Audio</button>

                <div class="acp-about">
                    <h3 id="acp_abt_title">About</h3>
                    <p id="acp_abt_desc">ğŸ“ Want to contact me? Click below! ğŸ‘‡</p>


                    <a href="https://nzg73.blogspot.com/" target="_blank" class="acp-link acp-yt">ğŸŒ WEB: @nzg73</a>

                    <a href="https://youtube.com/@nzg73" target="_blank" class="acp-link acp-yt">ğŸ¥ YouTube: @nzg73</a>
                    <a href="mailto:nzgnzg73@gmail.com" class="acp-link acp-em">ğŸ“§ Email: nzgnzg73@gmail.com</a>
                </div>
            </div>

            <script>
                // Namespace prefixed with acp_ to prevent conflict with upper tool
                let acp_lang = 'en';
                const acp_txt = {
                    en: {
                        title: "Audio Cleaner Pro", btn_lang: "Ø§Ø±Ø¯Ùˆ",
                        upload: "ğŸ“‚ Upload Audio (Click Here)",
                        orig: "Original (Noisy):", proc: "Result (Cleaned):",
                        gate: "1. Silence Threshold (Gate):", desc_gate: "Removes silence between words.",
                        hiss: "2. Hiss Filter (Treble):", desc_hiss: "Reduces 'shhh' sounds. (Lower value = Muffled)",
                        rumble: "3. Rumble Filter (Bass):", desc_rumble: "Removes heavy wind/bumps.",
                        btn_proc: "âœ¨ Clean & Process Audio", btn_down: "â¬‡ï¸ Download Clean Audio",
                        stat_wait: "Processing... Please wait...", stat_done: "Done! Audio Cleaned.",
                        abt_title: "About", abt_desc: "ğŸ“ Want to talk to me, ask something? Click below! ğŸ‘‡"
                    },
                    ur: {
                        title: "Ø¢ÚˆÛŒÙˆ Ú©Ù„ÛŒÙ†Ø± Ù¾Ø±Ùˆ (Ø´ÙˆØ± ÛÙ¹Ø§Ø¦ÛŒÚº)", btn_lang: "English",
                        upload: "ğŸ“‚ Ø¢ÚˆÛŒÙˆ Ø§Ù¾Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº (ÛŒÛØ§Úº Ú©Ù„Ú© Ú©Ø±ÛŒÚº)",
                        orig: "Ù¾ÛÙ„Û’ (Ø§ØµÙ„):", proc: "Ø¨Ø¹Ø¯ Ù…ÛŒÚº (ØµØ§Ù Ø´Ø¯Û):",
                        gate: "1. Ø®Ø§Ù…ÙˆØ´ÛŒ ÛÙ¹Ø§Ø¦ÛŒÚº (Silence):", desc_gate: "Ø§Ù„ÙØ§Ø¸ Ú©Û’ Ø¯Ø±Ù…ÛŒØ§Ù† Ú©ÛŒ Ø®Ø§Ù…ÙˆØ´ÛŒ Ú©Ø§Ù¹ØªØ§ ÛÛ’Û”",
                        hiss: "2. Ø¨Ø§Ø±ÛŒÚ© Ø´ÙˆØ± (Hiss):", desc_hiss: "Ø´ÙˆÚº Ø´ÙˆÚº Ú©ÛŒ Ø¢ÙˆØ§Ø² Ú©Ù… Ú©Ø±ÛŒÚº (Ø¬ØªÙ†Ø§ Ú©Ù… Ú©Ø±ÛŒÚº Ú¯Û’ Ø¢ÙˆØ§Ø² Ù…ÙˆÙ¹ÛŒ ÛÙˆÚ¯ÛŒ)Û”",
                        rumble: "3. Ø¨Ú¾Ø§Ø±ÛŒ Ø´ÙˆØ± (Rumble):", desc_rumble: "ÛÙˆØ§ Ø§ÙˆØ± Ù¾Ú¾ÙˆÙ†Ú©ÙˆÚº Ú©Ø§ Ø´ÙˆØ± ÛÙ¹Ø§Ø¦ÛŒÚºÛ”",
                        btn_proc: "âœ¨ ØµÙØ§Ø¦ÛŒ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº (Process)", btn_down: "â¬‡ï¸ ØµØ§Ù Ø¢ÚˆÛŒÙˆ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº",
                        stat_wait: "Ú©Ø§Ù… Ø¬Ø§Ø±ÛŒ ÛÛ’... Ø§Ù†ØªØ¸Ø§Ø± Ú©Ø±ÛŒÚº...", stat_done: "Ù…Ú©Ù…Ù„! Ø¢ÚˆÛŒÙˆ ØµØ§Ù ÛÙˆ Ú¯Ø¦ÛŒ ÛÛ’Û”",
                        abt_title: "ÛÙ…Ø§Ø±Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº", abt_desc: "ğŸ“ Ø±Ø§Ø¨Ø·Û Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ù†ÛŒÚ†Û’ Ú©Ù„Ú© Ú©Ø±ÛŒÚº ğŸ‘‡"
                    }
                };

                function acp_toggleLanguage() {
                    acp_lang = acp_lang === 'en' ? 'ur' : 'en';
                    const t = acp_txt[acp_lang];
                    
                    document.getElementById('acp_txt_title').innerText = t.title;
                    document.getElementById('acp_btn_lang').innerText = t.btn_lang;
                    document.getElementById('acp_txt_upload').innerText = t.upload;
                    document.getElementById('acp_lbl_orig').innerText = t.orig;
                    document.getElementById('acp_lbl_proc').innerText = t.proc;
                    document.getElementById('acpProcessBtn').innerText = t.btn_proc;
                    document.getElementById('acpDownloadBtn').innerText = t.btn_down;
                    document.getElementById('acp_abt_title').innerText = t.abt_title;
                    document.getElementById('acp_abt_desc').innerText = t.abt_desc;
                    
                    acp_updVals();

                    const wrapper = document.getElementById('proCleanerWrapper');
                    if(acp_lang === 'ur') {
                        wrapper.classList.add('acp-urdu-mode');
                        document.getElementById('acp_txt_title').style.textAlign = 'right';
                    } else {
                        wrapper.classList.remove('acp-urdu-mode');
                        document.getElementById('acp_txt_title').style.textAlign = 'left';
                    }
                }

                function acp_updVals() {
                    const t = acp_txt[acp_lang];
                    document.getElementById('acpValGate').innerText = document.getElementById('acpRngGate').value;
                    document.getElementById('acpValHiss').innerText = document.getElementById('acpRngHiss').value + " Hz";
                    document.getElementById('acpValRumble').innerText = document.getElementById('acpRngRumble').value + " Hz";

                    document.getElementById('acp_lbl_gate').innerHTML = `${t.gate} <span>${document.getElementById('acpRngGate').value}</span>`;
                    document.getElementById('acp_desc_gate').innerText = t.desc_gate;
                    
                    document.getElementById('acp_lbl_hiss').innerHTML = `${t.hiss} <span>${document.getElementById('acpRngHiss').value} Hz</span>`;
                    document.getElementById('acp_desc_hiss').innerText = t.desc_hiss;

                    document.getElementById('acp_lbl_rumble').innerHTML = `${t.rumble} <span>${document.getElementById('acpRngRumble').value} Hz</span>`;
                    document.getElementById('acp_desc_rumble').innerText = t.desc_rumble;
                }

                // Audio Logic for PRO section
                let acp_audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                let acp_origBlob = null;
                let acp_finalBlob = null;

                async function acp_handleFile(input) {
                    if (input.files[0]) {
                        acp_origBlob = input.files[0];
                        document.getElementById('acpSecOrig').style.display = 'block';
                        document.getElementById('acpCtrlBox').style.display = 'block';
                        document.getElementById('acpSecProc').style.display = 'none';
                        document.getElementById('acpDownloadBtn').style.display = 'none';

                        document.getElementById('acpAudOrig').src = URL.createObjectURL(acp_origBlob);
                        
                        let arrBuf = await acp_origBlob.arrayBuffer();
                        let audBuf = await acp_audioCtx.decodeAudioData(arrBuf);
                        acp_drawWave(audBuf, 'acpCvsOrig', '#d32f2f');
                        document.getElementById('acpTimeOrig').innerText = acp_fmtTime(audBuf.duration);
                    }
                }

                async function acp_processAudio() {
                    if(!acp_origBlob) return;
                    document.getElementById('acpStatus').innerText = acp_txt[acp_lang].stat_wait;

                    let fileReader = new FileReader();
                    fileReader.readAsArrayBuffer(acp_origBlob);
                    fileReader.onload = async function() {
                        let audBuf = await acp_audioCtx.decodeAudioData(fileReader.result);
                        
                        let offlineCtx = new OfflineAudioContext(1, audBuf.length, audBuf.sampleRate);
                        let source = offlineCtx.createBufferSource();
                        source.buffer = audBuf;

                        let highPass = offlineCtx.createBiquadFilter();
                        highPass.type = "highpass";
                        highPass.frequency.value = document.getElementById('acpRngRumble').value;

                        let lowPass = offlineCtx.createBiquadFilter();
                        lowPass.type = "lowpass";
                        lowPass.frequency.value = document.getElementById('acpRngHiss').value;

                        source.connect(highPass);
                        highPass.connect(lowPass);
                        lowPass.connect(offlineCtx.destination);
                        source.start();

                        let filteredBuf = await offlineCtx.startRendering();
                        let filteredData = filteredBuf.getChannelData(0);

                        let threshold = parseFloat(document.getElementById('acpRngGate').value);
                        let newBuffer = [];
                        let chunkSize = Math.floor(audBuf.sampleRate * 0.05);

                        for (let i = 0; i < filteredData.length; i += chunkSize) {
                            let chunk = filteredData.slice(i, i + chunkSize);
                            let sum = 0;
                            for(let v of chunk) sum += Math.abs(v);
                            let avg = sum / chunk.length;
                            if(avg > threshold) {
                                for(let v of chunk) newBuffer.push(v);
                            }
                        }

                        if(newBuffer.length === 0) {
                            alert("Threshold too high!"); return;
                        }

                        acp_finalBlob = acp_encodeWAV(newBuffer, audBuf.sampleRate);
                        
                        document.getElementById('acpSecProc').style.display = 'block';
                        document.getElementById('acpDownloadBtn').style.display = 'block';
                        document.getElementById('acpAudProc').src = URL.createObjectURL(acp_finalBlob);
                        document.getElementById('acpStatus').innerText = acp_txt[acp_lang].stat_done;
                        document.getElementById('acpStatus').style.color = 'green';

                        let drawCtx = new OfflineAudioContext(1, newBuffer.length, audBuf.sampleRate);
                        let drawBuf = drawCtx.createBuffer(1, newBuffer.length, audBuf.sampleRate);
                        drawBuf.copyToChannel(new Float32Array(newBuffer), 0);
                        acp_drawWave(drawBuf, 'acpCvsProc', '#25d366');
                        document.getElementById('acpTimeProc').innerText = acp_fmtTime(newBuffer.length / audBuf.sampleRate);
                    };
                }

                function acp_downloadFile() {
                    if(!acp_finalBlob) return;
                    let name = prompt(acp_lang === 'ur' ? "ÙØ§Ø¦Ù„ Ú©Ø§ Ù†Ø§Ù… Ù„Ú©Ú¾ÛŒÚº:" : "Enter Filename:", "cleaned_audio_pro");
                    if(name) {
                        let a = document.createElement('a');
                        a.href = URL.createObjectURL(acp_finalBlob);
                        a.download = name + ".wav";
                        a.click();
                    }
                }

                function acp_fmtTime(s) {
                    let m = Math.floor(s/60);
                    let sec = Math.floor(s%60);
                    return (m<10?"0"+m:m) + ":" + (sec<10?"0"+sec:sec);
                }

                function acp_drawWave(buf, id, color) {
                    let cvs = document.getElementById(id);
                    let ctx = cvs.getContext('2d');
                    let w = cvs.width = cvs.offsetWidth;
                    let h = cvs.height = cvs.offsetHeight;
                    let data = buf.getChannelData(0);
                    let step = Math.ceil(data.length / w);
                    let amp = h/2;
                    ctx.clearRect(0,0,w,h);
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    for(let i=0; i<w; i++) {
                        let min=1.0, max=-1.0;
                        for(let j=0; j<step; j++) {
                            let v = data[(i*step)+j];
                            if(v<min) min=v; if(v>max) max=v;
                        }
                        ctx.fillRect(i, (1+min)*amp, 1, Math.max(1,(max-min)*amp));
                    }
                }

                function acp_encodeWAV(samples, sr) {
                    let buf = new ArrayBuffer(44 + samples.length * 2);
                    let view = new DataView(buf);
                    const wS = (o, s) => { for(let i=0; i<s.length; i++) view.setUint8(o+i, s.charCodeAt(i)); };
                    wS(0, 'RIFF'); view.setUint32(4, 36+samples.length*2, true); wS(8, 'WAVEfmt ');
                    view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
                    view.setUint32(24, sr, true); view.setUint32(28, sr*2, true);
                    view.setUint16(32, 2, true); view.setUint16(34, 16, true); wS(36, 'data');
                    view.setUint32(40, samples.length*2, true);
                    for(let i=0; i<samples.length; i++) {
                        let s = Math.max(-1, Math.min(1, samples[i]));
                        view.setInt16(44+i*2, s<0 ? s*0x8000 : s*0x7FFF, true);
                    }
                    return new Blob([view], {type:'audio/wav'});
                }
            </script>
        </div>
    </div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Audio to SRT Transcribe
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="tool-section" id="audioTranscriberSection" style="margin-top: 20px;">
    <div class="section-header" onclick="toggleSection('audioTranscriberContent', 'audioTranscriberArrow')">
        <h2 id="astMainTitle">ğŸ”¤ Audio Video to SRT Transcriber & File Viewer</h2>
        <div class="collapse-arrow" id="audioTranscriberArrow">â–¼</div>
    </div>
    
    <div class="section-content hidden" id="audioTranscriberContent">
        
        <style>
            /* Scoped CSS */
            #astWrapper {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background-color: #f4f4f9;
                padding: 20px; border-radius: 10px; color: #333;
                text-align: center; border: 1px solid #ddd;
            }
            #astWrapper h1, #astWrapper h2 { text-align: center; color: #4a90e2; margin-bottom: 0.5rem; }
            #astWrapper .subtitle { text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 1.5rem; font-weight: 500; }
            
            /* Upload Area */
            .ast-upload-area { 
                border: 2px dashed #ccc; padding: 2rem; text-align: center; 
                border-radius: 8px; cursor: pointer; transition: 0.3s; 
                background-color: #fff; position: relative; margin-bottom: 15px;
                display: flex; flex-direction: column; align-items: center; justify-content: center;
            }
            .ast-upload-area:hover { border-color: #4a90e2; background-color: #f0f7ff; }
            .ast-upload-input { 
                position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
                opacity: 0; cursor: pointer; z-index: 10;
            }

            /* Mic Button */
            #ast_micBtn {
                position: relative; z-index: 20; margin-top: 15px;
                background-color: #ff4757; color: white; border: none;
                border-radius: 50px; padding: 8px 15px; font-size: 14px; cursor: pointer;
                display: flex; align-items: center; gap: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                transition: 0.3s;
            }
            #ast_micBtn:hover { background-color: #e84118; transform: scale(1.05); }
            #ast_micBtn.recording { animation: pulse 1.5s infinite; background-color: #ff0000; }
            @keyframes pulse {
                0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
                70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
                100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
            }

            /* Preview */
            #ast_previewContainer { margin-top: 15px; display: none; }
            video, audio { width: 100%; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

            /* Device Selector */
            .ast-device-selector { 
                margin-top: 1rem; text-align: center; background: #fff; 
                padding: 10px; border-radius: 8px; border: 1px solid #e0e0e0; 
            }
            .ast-device-selector label { display: inline-block; margin: 0 15px; cursor: pointer; }

            /* Settings Grid */
            .ast-settings-area { display: flex; gap: 10px; margin-top: 1rem; flex-wrap: wrap; }
            .ast-settings-group { flex: 1; min-width: 200px; text-align: left; }
            .ast-settings-group label { font-weight: bold; display: block; margin-bottom: 5px; }
            .ast-select, .ast-text-input { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; background: white; box-sizing: border-box; }
            
            /* Hidden Class */
            .hidden-option { display: none; }

            /* Buttons */
            .ast-btn { 
                display: block; width: 100%; padding: 12px; background-color: #4a90e2; 
                color: white; border: none; border-radius: 6px; font-size: 16px; 
                cursor: pointer; margin-top: 1rem; transition: 0.3s; font-weight: bold;
            }
            .ast-btn:hover { background-color: #357abd; }
            .ast-btn:disabled { background-color: #ccc; cursor: not-allowed; }
            .ast-copy-btn { background-color: #28a745; margin-top: 5px; width: auto; display: inline-block; padding: 8px 20px; }
            
            /* Output & Viewer */
            .ast-status { margin-top: 1rem; text-align: center; font-weight: bold; min-height: 24px; }
            .ast-output-section { margin-top: 2rem; display: none; text-align: left; border-top: 2px solid #ddd; padding-top: 20px; }
            .ast-textarea { 
                width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; 
                border-radius: 6px; resize: vertical; font-family: monospace; 
                margin-bottom: 10px; box-sizing: border-box; background: #fff;
            }
            .ast-download-link { display: inline-block; text-decoration: none; color: #4a90e2; margin-top: 5px; font-size: 14px; font-weight: bold; margin-right: 15px; }
            .ast-viewer-section { margin-top: 40px; border-top: 3px solid #eee; padding-top: 30px; }
        </style>

        <div id="astWrapper">
            <h1>Audio Video to SRT Transcriber</h1>
            <p class="subtitle">âœ¨ Supports 100+ Languages (Urdu, English, Hindi, etc.)</p>
            
            <div class="ast-upload-area">
                <p id="ast_fileName" style="margin:0; font-size:16px;">ğŸ“‚ Click to Select Audio/Video File</p>
                <input type="file" id="ast_audioFile" class="ast-upload-input" accept="audio/*,video/*" onchange="ast_updateFileName()">
                <button id="ast_micBtn" type="button" onclick="ast_toggleRecording()">ğŸ¤ Record Voice</button>
            </div>

            <div id="ast_previewContainer">
                <p style="font-size: 12px; color: #666; margin-bottom: 5px;">File Preview:</p>
                <div id="ast_mediaPlayerWrapper"></div>
            </div>

            <div class="ast-device-selector">
                <label><input type="radio" name="ast_deviceType" value="cuda"> ğŸš€ <b>Run on GPU</b> (Fast)</label>
                <label><input type="radio" name="ast_deviceType" value="cpu" checked > ğŸ¢ <b>Run on CPU</b> (Safe)</label>
            </div>

            <div class="ast-settings-area">
                
                <div class="ast-settings-group">
                    <label>Audio Language:</label>
                    <select id="ast_languageSelect" class="ast-select">
                        <option value="ur" selected>Urdu (Ø§Ø±Ø¯Ùˆ)</option>
                        <option value="en">English</option>
                        <option value="auto">Auto Detect</option>
                        <option value="hi">Hindi (à¤¹à¤¿à¤‚à¤¦à¥€)</option>
                        <option value="ar">Arabic (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</option>
                        <option value="zh">Chinese (ä¸­æ–‡)</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="ru">Russian</option>
                        <option value="pt">Portuguese</option>
                        <option value="tr">Turkish</option>
                        <option value="fa">Persian (ÙØ§Ø±Ø³ÛŒ)</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="it">Italian</option>
                        <option value="nl">Dutch</option>
                        <option value="pl">Polish</option>
                        <option value="uk">Ukrainian</option>
                        <option value="vi">Vietnamese</option>
                        <option value="th">Thai</option>
                        <option value="id">Indonesian</option>
                        <option value="ms">Malay</option>
                        <option value="bn">Bengali</option>
                        <option value="pa">Punjabi</option>
                        <option value="ta">Tamil</option>
                        <option value="te">Telugu</option>
                        <option value="mr">Marathi</option>
                        </select>
                </div>

                <div class="ast-settings-group">
                    <label>Select Model:</label>
                    <select id="ast_modelSelect" class="ast-select">
                        <optgroup label="Standard Models (Recommended)">
                            <option value="tiny">Tiny (Fastest/Lowest Quality)</option>
                            <option value="base">Base</option>
                            <option value="small" selected>Small (Balanced)</option>
                            <option value="medium">Medium (Better Quality)</option>
                            <option value="large-v3">Large-V3 (Best Quality)</option>
                        </optgroup>
                        <optgroup label="English Only Models">
                            <option value="tiny.en">Tiny.en</option>
                            <option value="base.en">Base.en</option>
                            <option value="small.en">Small.en</option>
                            <option value="medium.en">Medium.en</option>
                        </optgroup>
                        <optgroup label="Advanced / Other Versions">
                            <option value="large-v1">Large-V1</option>
                            <option value="large-v2">Large-V2</option>
                            <option value="large-v3-turbo">Large-V3 Turbo</option>
                            <option value="distil-large-v2">Distil-Large-V2</option>
                            <option value="distil-medium.en">Distil-Medium.en</option>
                        </optgroup>
                    </select>
                </div>

                <div class="ast-settings-group">
                    <label>Task:</label>
                    <select id="ast_taskSelect" class="ast-select" onchange="ast_toggleTargetLang()">
                        <option value="transcribe" selected>ğŸ“ Transcribe (Same Language)</option>
                        <option value="translate">ğŸŒ Translate (Change Language)</option>
                    </select>
                </div>
                
                <div class="ast-settings-group hidden-option" id="ast_targetLangGroup">
                    <label>Target Language:</label>
                    <select id="ast_targetLanguageSelect" class="ast-select">
                         <option value="en" selected>English</option>
                         <option value="ur">Urdu (Ø§Ø±Ø¯Ùˆ)</option>
                         <option value="hi">Hindi (à¤¹à¤¿à¤‚à¤¦à¥€)</option>
                         <option value="ar">Arabic (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</option>
                         <option value="zh">Chinese (ä¸­æ–‡)</option>
                         <option value="es">Spanish</option>
                         <option value="fr">French</option>
                         <option value="de">German</option>
                         <option value="ru">Russian</option>
                         <option value="pt">Portuguese</option>
                         <option value="tr">Turkish</option>
                         <option value="fa">Persian (ÙØ§Ø±Ø³ÛŒ)</option>
                         <option value="ja">Japanese</option>
                         <option value="ko">Korean</option>
                         <option value="it">Italian</option>
                         <option value="nl">Dutch</option>
                         <option value="pl">Polish</option>
                         <option value="uk">Ukrainian</option>
                         <option value="vi">Vietnamese</option>
                         <option value="th">Thai</option>
                         <option value="id">Indonesian</option>
                         <option value="ms">Malay</option>
                         <option value="bn">Bengali</option>
                         <option value="pa">Punjabi</option>
                         <option value="ta">Tamil</option>
                         <option value="te">Telugu</option>
                         <option value="mr">Marathi</option>
                    </select>
                </div>

                <div class="ast-settings-group">
                    <label>YouTube URL (Optional):</label>
                    <input type="text" id="ast_ytUrl" class="ast-text-input" placeholder="Paste YouTube Link...">
                </div>

            </div>

            <button id="ast_processBtn" class="ast-btn" onclick="ast_uploadAndTranscribe()">Start Processing</button>
            <div id="ast_status" class="ast-status"></div>

            <div id="ast_outputSection" class="ast-output-section">
                <label>Generated SRT:</label>
                <textarea id="ast_srtOutput" class="ast-textarea" readonly></textarea>
                <button class="ast-btn ast-copy-btn" onclick="ast_copyToClipboard('ast_srtOutput')">ğŸ“‹ Copy SRT</button>
                <a id="ast_downloadSrt" class="ast-download-link" href="#" download="subtitles.srt">Download SRT</a>

                <div style="margin-top: 15px;">
                    <label>Plain Text:</label>
                    <textarea id="ast_textOutput" class="ast-textarea" readonly></textarea>
                    <button class="ast-btn ast-copy-btn" onclick="ast_copyToClipboard('ast_textOutput')">ğŸ“‹ Copy Text</button>
                    <a id="ast_downloadTxt" class="ast-download-link" href="#" download="transcription.txt">Download Text</a>
                </div>
            </div>

            <div class="ast-viewer-section">
                <h2>ğŸ“‚ Universal File Viewer (SRT, HTML, BAT, Code)</h2>
                <div class="ast-upload-area" style="border-color: #28a745;">
                    <p id="ast_viewFileName" style="margin:0; font-size:16px;">ğŸ“„ Click to Select File (SRT, HTML, TXT, etc.)</p>
                    <input type="file" id="ast_viewFile" class="ast-upload-input" onchange="ast_updateViewFileName()">
                </div>
                <button class="ast-btn" style="background-color: #17a2b8;" onclick="ast_readContentFile()">ğŸ‘ï¸ View Content / Generate Text</button>
                <div id="ast_viewerOutputSection" style="display:none; margin-top: 20px; text-align: left;">
                    <label>File Content:</label>
                    <textarea id="ast_fileViewerOutput" class="ast-textarea" placeholder="File content will appear here..."></textarea>
                    <button class="ast-btn ast-copy-btn" onclick="ast_copyToClipboard('ast_fileViewerOutput')">ğŸ“‹ Copy All Text</button>
                </div>
            </div>
        </div>

        <script>
            // --- Global Variables for Mic ---
            let mediaRecorder;
            let audioChunks = [];
            let isRecording = false;
            let recordedBlob = null;

            // --- Toggle Target Language Dropdown ---
            function ast_toggleTargetLang() {
                const task = document.getElementById('ast_taskSelect').value;
                const targetGroup = document.getElementById('ast_targetLangGroup');
                if (task === 'translate') {
                    targetGroup.style.display = 'block';
                } else {
                    targetGroup.style.display = 'none';
                }
            }

            // --- Mic Logic (With Error Handling) ---
            async function ast_toggleRecording() {
                const micBtn = document.getElementById('ast_micBtn');
                const fileNameDisplay = document.getElementById('ast_fileName');

                // Check API support
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    alert("âŒ Mic Error: Browser API not found. Please use HTTPS or localhost.");
                    return;
                }

                if (!isRecording) {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        mediaRecorder = new MediaRecorder(stream);
                        audioChunks = [];

                        mediaRecorder.ondataavailable = event => {
                            audioChunks.push(event.data);
                        };

                        mediaRecorder.onstop = () => {
                            recordedBlob = new Blob(audioChunks, { type: 'audio/wav' });
                            const audioUrl = URL.createObjectURL(recordedBlob);
                            ast_showPreview(audioUrl, 'audio/wav');
                            fileNameDisplay.innerText = "ğŸ¤ Voice Recorded Ready!";
                            fileNameDisplay.style.color = "#ff4757";
                            document.getElementById('ast_audioFile').value = ""; // Clear file
                            document.getElementById('ast_ytUrl').value = ""; // Clear URL
                        };

                        mediaRecorder.start();
                        isRecording = true;
                        micBtn.innerText = "â¹ Stop Recording";
                        micBtn.classList.add('recording');
                    } catch (err) {
                        alert("Microphone Error: " + err.message);
                        console.error(err);
                    }
                } else {
                    mediaRecorder.stop();
                    isRecording = false;
                    micBtn.innerText = "ğŸ¤ Record Voice";
                    micBtn.classList.remove('recording');
                }
            }

            function ast_updateFileName() {
                const fileInput = document.getElementById('ast_audioFile');
                const fileNameDisplay = document.getElementById('ast_fileName');
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    fileNameDisplay.innerText = "âœ… Selected: " + file.name;
                    fileNameDisplay.style.color = "#28a745";
                    recordedBlob = null; // Clear recording
                    document.getElementById('ast_ytUrl').value = ""; // Clear URL
                    const fileURL = URL.createObjectURL(file);
                    ast_showPreview(fileURL, file.type);
                }
            }

            function ast_showPreview(url, type) {
                const previewContainer = document.getElementById('ast_previewContainer');
                const playerWrapper = document.getElementById('ast_mediaPlayerWrapper');
                playerWrapper.innerHTML = "";
                previewContainer.style.display = "block";

                if (type.startsWith('audio/') || type === 'audio/wav') {
                    const audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = url;
                    playerWrapper.appendChild(audio);
                } else if (type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.controls = true;
                    video.style.maxHeight = "300px";
                    video.src = url;
                    playerWrapper.appendChild(video);
                }
            }

async function ast_uploadAndTranscribe() {
    const fileInput = document.getElementById('ast_audioFile');
    const ytUrlInput = document.getElementById('ast_ytUrl');
    const statusDiv = document.getElementById('ast_status');
    const btn = document.getElementById('ast_processBtn');
    const outputSection = document.getElementById('ast_outputSection');

    const deviceChoice = document.querySelector('input[name="ast_deviceType"]:checked').value;
    const modelChoice = document.getElementById('ast_modelSelect').value;
    const langChoice = document.getElementById('ast_languageSelect').value;
    const taskChoice = document.getElementById('ast_taskSelect').value;
    const targetLangChoice = document.getElementById('ast_targetLanguageSelect').value;

    let formData = new FormData();
    let hasSource = false;

    if (recordedBlob) {
        formData.append('file', recordedBlob, 'recording.wav');
        hasSource = true;
    } else if (fileInput.files.length > 0) {
        formData.append('file', fileInput.files[0]);
        hasSource = true;
    } else if (ytUrlInput.value.trim() !== "") {
        formData.append('youtube_url', ytUrlInput.value.trim());
        hasSource = true;
    }

    if (!hasSource) {
        statusDiv.innerText = "Select File, Record Voice, or Paste YouTube URL!";
        statusDiv.style.color = "red";
        return;
    }

    formData.append('device', deviceChoice);
    formData.append('model', modelChoice);
    formData.append('language', langChoice);
    formData.append('task', taskChoice);
    if (taskChoice === 'translate') {
        formData.append('target_language', targetLangChoice);
    }

    btn.disabled = true;
    btn.innerText = "Processing...";
    statusDiv.innerText = "Processing... Please Wait";
    statusDiv.style.color = "#333";
    outputSection.style.display = "none";

    try {
        const response = await fetch('/transcribe', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        if (data.error) {
            statusDiv.innerText = "Error: " + data.error;
            statusDiv.style.color = "red";
        } else {
            statusDiv.innerText = "Done!";
            statusDiv.style.color = "green";
            document.getElementById('ast_srtOutput').value = data.srt_content;
            document.getElementById('ast_textOutput').value = data.text_content;
            ast_createDownloadLink('ast_downloadSrt', data.srt_content, 'subtitles.srt');
            ast_createDownloadLink('ast_downloadTxt', data.text_content, 'transcription.txt');
            outputSection.style.display = "block";
        }
    } catch (error) {
        statusDiv.innerText = "Error: " + error;
        statusDiv.style.color = "red";
    } finally {
        btn.disabled = false;
        btn.innerText = "Start Processing";
    }
}
            function ast_createDownloadLink(elementId, content, filename) {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.getElementById(elementId);
                a.href = url;
                a.download = filename;
            }

            // Universal Viewer Functions (Preserved)
            function ast_updateViewFileName() {
                const fileInput = document.getElementById('ast_viewFile');
                const fileNameDisplay = document.getElementById('ast_viewFileName');
                if (fileInput.files.length > 0) {
                    fileNameDisplay.innerText = "âœ… Ready: " + fileInput.files[0].name;
                    fileNameDisplay.style.color = "#28a745";
                }
            }
            function ast_readContentFile() {
                const fileInput = document.getElementById('ast_viewFile');
                const outputBox = document.getElementById('ast_fileViewerOutput');
                const section = document.getElementById('ast_viewerOutputSection');
                if (fileInput.files.length === 0) { alert("Select file first."); return; }
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) { outputBox.value = e.target.result; section.style.display = "block"; };
                reader.readAsText(file);
            }
            function ast_copyToClipboard(elementId) {
                const copyText = document.getElementById(elementId);
                copyText.select();
                navigator.clipboard.writeText(copyText.value);
                alert("âœ… Copied!");
            }
        </script>
    </div>
</div>
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    END Audio to SRT Transcribe
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->



<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Voice-to-Voice Converter
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->



<div class="tool-section" id="voiceConverterSection" style="margin-top: 20px;">
    <div class="section-header" onclick="toggleSection('voiceConverterContent', 'voiceConverterArrow')">
        <h2 id="vc_main_title">ğŸ¤ Voice-to-Voice Converter Pro</h2>
        <div class="collapse-arrow" id="voiceConverterArrow">â–¼</div>
    </div>
    
    <div class="section-content hidden" id="voiceConverterContent">
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

        <style>
            /* --- Scoped Styles for Voice Converter (vc_) --- */
            #vc_wrapper {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 20px;
                border-radius: 10px;
                color: #333;
            }

            #vc_main_container {
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                /* overflow: hidden hataya taake scroll ho sakay */
                width: 100%;
                position: relative;
            }

            .vc-header {
                background: linear-gradient(90deg, #4f46e5, #7c3aed);
                color: white;
                padding: 30px;
                text-align: center;
                border-top-left-radius: 20px;
                border-top-right-radius: 20px;
            }
            .vc-header h1 { font-size: 2rem; margin-bottom: 10px; margin-top:0; }
            .vc-header p { font-size: 1rem; opacity: 0.9; margin:0; }

            /* --- LAYOUT SETTINGS --- */
            .vc-content {
                display: grid;
                grid-template-columns: 1fr 1fr; /* Hamesha 2 Columns (PC jaisa) */
                gap: 30px;
                padding: 30px;
            }

            /* --- MOBILE SWIPE FIX (Horizontal Scroll) --- */
            @media (max-width: 900px) { 
                #vc_main_container {
                    overflow-x: auto; /* Ijazat di gayi ke dayein/bayein scroll ho */
                    -webkit-overflow-scrolling: touch; /* Smooth swipe for mobile */
                }
                .vc-content { 
                    /* Mobile par zabardasti chora (wide) rakhna taake PC jaisa dikhay */
                    min-width: 900px; 
                    padding: 20px;
                }
            }

            .vc-card {
                background: #f8fafc;
                border-radius: 15px;
                padding: 25px;
                border: 1px solid #e2e8f0;
                margin-bottom: 20px;
            }
            .vc-card h2 {
                color: #4f46e5;
                margin-bottom: 20px;
                font-size: 1.3rem;
                display: flex;
                align-items: center;
                gap: 10px;
                margin-top: 0;
            }

            .vc-input-section { display: flex; flex-direction: column; gap: 20px; }

            .vc-audio-upload {
                border: 2px dashed #cbd5e1;
                border-radius: 10px;
                padding: 20px;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s;
                position: relative;
                background: white;
            }
            .vc-audio-upload:hover { border-color: #4f46e5; background: #f1f5f9; }
            .vc-audio-upload i.main-icon { font-size: 2.5rem; color: #94a3b8; margin-bottom: 10px; }

            /* Controls */
            .vc-controls { display: flex; flex-direction: column; gap: 15px; }
            .vc-slider-container { background: white; padding: 15px; border-radius: 10px; border: 1px solid #e2e8f0; }
            .vc-slider-label { display: flex; justify-content: space-between; margin-bottom: 10px; color: #475569; font-size: 0.9rem; font-weight: bold; }
            .vc-slider { width: 100%; height: 6px; -webkit-appearance: none; background: #e2e8f0; border-radius: 3px; outline: none; }
            .vc-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: #4f46e5; border-radius: 50%; cursor: pointer; }

            /* Buttons */
            .vc-button {
                background: linear-gradient(90deg, #4f46e5, #7c3aed);
                color: white;
                border: none;
                padding: 15px;
                border-radius: 10px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                width: 100%;
                margin-bottom: 10px;
            }
            .vc-button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3); }
            .vc-button:disabled { background: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }
            .vc-button.secondary { background: #64748b; margin-top: 5px; }

            /* Logs */
            .vc-log-container {
                background: #0f172a;
                color: #e2e8f0;
                border-radius: 10px;
                padding: 15px;
                font-family: 'Monaco', 'Courier New', monospace;
                max-height: 200px;
                overflow-y: auto;
                font-size: 0.85rem;
                text-align: left;
            }
            .vc-log-line { margin-bottom: 5px; padding: 5px; border-radius: 3px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1); }
            .vc-status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 8px; }
            .status-green { background: #10b981; }
            .status-yellow { background: #f59e0b; }
            .status-red { background: #ef4444; }

            /* Output */
            .vc-output-audio { background: white; border-radius: 10px; padding: 20px; border: 2px solid #4f46e5; text-align: center; }

            /* Device Selector */
            .vc-device-selector { display: flex; gap: 10px; margin-bottom: 20px; }
            .vc-device-btn {
                flex: 1; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; background: white;
                cursor: pointer; text-align: center; transition: all 0.3s; display: flex; align-items: center;
                justify-content: center; gap: 5px; font-weight: bold; color: #64748b; font-size: 0.9rem;
            }
            .vc-device-btn.active { border-color: #4f46e5; background: #eef2ff; color: #4f46e5; box-shadow: 0 0 10px rgba(79, 70, 229, 0.1); }
            .vc-device-btn:hover { border-color: #c7d2fe; }

            /* File Info & Actions */
            .vc-file-info { margin-top: 15px; font-size: 0.85rem; color: #334155; font-weight: 500; display: none; background: white; padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0; }
            .vc-file-info.show { display: block; animation: vcFadeIn 0.3s ease; }
            
            .vc-file-actions { display: flex; gap: 10px; margin-top: 8px; justify-content: center; }
            .vc-action-btn { padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em; border: none; color: white; display: flex; align-items: center; gap: 5px; }
            .btn-play { background: #3b82f6; }
            .btn-remove { background: #ef4444; }

            /* Modal */
            .vc-modal-overlay {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: none; justify-content: center; align-items: center;
                z-index: 9999; backdrop-filter: blur(5px);
            }
            .vc-modal-box {
                background: white; padding: 25px; border-radius: 15px;
                width: 90%; max-width: 400px; text-align: center;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                animation: vcSlideUp 0.3s ease;
            }
            .vc-modal-title { font-size: 1.1rem; color: #1e293b; margin-bottom: 15px; font-weight: bold; }
            .vc-btn-close-modal {
                margin-top: 15px; background: #e2e8f0; color: #475569;
                padding: 8px 16px; border-radius: 8px; border: none;
                cursor: pointer; font-weight: bold;
            }

            @keyframes vcFadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
            @keyframes vcSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        </style>

        <div id="vc_wrapper">
            
            <div id="vc_audioModal" class="vc-modal-overlay">
                <div class="vc-modal-box">
                    <div class="vc-modal-title"><i class="fas fa-volume-up"></i> Preview Audio</div>
                    <audio id="vc_modalAudioPlayer" controls style="width: 100%; border-radius: 30px;"></audio>
                    <button class="vc-btn-close-modal" onclick="vc_closeModal()">Close</button>
                </div>
            </div>

            <div id="vc_main_container">
                <div class="vc-header">
                    <h1><i class="fas fa-wave-square"></i> Voice-to-Voice Converter</h1>
                    <p>Professional AI Voice Cloning Interface</p>
                    <p>This Model Supports All Languages</p>
                    <p>Convert the timbre of an input audio to match a reference speaker's voice</p>

                </div>
                
                <div class="vc-content">
                    <div class="vc-input-section">
                        <div class="vc-card">
                            <h2><i class="fas fa-microphone"></i> Source Audio </h2>
                            <div class="vc-audio-upload">
                                <div onclick="document.getElementById('vc_sourceUpload').click()">
                                    <i class="fas fa-file-audio main-icon"></i>
                                    <p>Click to Upload Source Audio</p>
                                </div>
                                
                                <div class="vc-file-info" id="vc_sourceInfoBox">
                                    <div id="vc_sourceDetails"></div>
                                    <div class="vc-file-actions">
                                        <button class="vc-action-btn btn-play" onclick="vc_openModal('source')">
                                            <i class="fas fa-play"></i> Listen
                                        </button>
                                        <button class="vc-action-btn btn-remove" onclick="vc_removeFile('source')">
                                            <i class="fas fa-times"></i> Remove
                                        </button>
                                    </div>
                                </div>
                                <input type="file" id="vc_sourceUpload" accept="audio/*" style="display: none;">
                            </div>
                        </div>
                        
                        <div class="vc-card">
                            <h2><i class="fas fa-user"></i> Original Reference Voice (Speaker) (Max. 40s)</h2>
                            <div class="vc-audio-upload">
                                <div onclick="document.getElementById('vc_targetUpload').click()">
                                    <i class="fas fa-user-circle main-icon"></i>
                                    <p>Click to Upload Your Voice</p>
                                </div>

                                <div class="vc-file-info" id="vc_targetInfoBox">
                                    <div id="vc_targetDetails"></div>
                                    <div class="vc-file-actions">
                                        <button class="vc-action-btn btn-play" onclick="vc_openModal('target')">
                                            <i class="fas fa-play"></i> Listen
                                        </button>
                                        <button class="vc-action-btn btn-remove" onclick="vc_removeFile('target')">
                                            <i class="fas fa-times"></i> Remove
                                        </button>
                                    </div>
                                </div>
                                <input type="file" id="vc_targetUpload" accept="audio/*" style="display: none;">
                            </div>
                        </div>
                        
                        <div class="vc-card">
                            <h2><i class="fas fa-sliders-h"></i> Settings</h2>
                            
                            <div class="vc-device-selector">
                                <div class="vc-device-btn active" id="vc_btn-gpu" onclick="vc_setDevice('cuda')">
                                    <i class="fas fa-microchip"></i> GPU (Fast)
                                </div>
                                <div class="vc-device-btn" id="vc_btn-cpu" onclick="vc_setDevice('cpu')">
                                    <i class="fas fa-server"></i> CPU (Slow)
                                </div>
                            </div>
                            
                            <div class="vc-controls">
                                <div class="vc-slider-container">
                                    <div class="vc-slider-label">
                                        <span>CFG Rate (Similarity)</span>
                                        <span id="vc_cfgValue">0.5</span>
                                    </div>
                                    <input type="range" min="0" max="30" step="0.1" value="0.5" 
                                           class="vc-slider" id="vc_cfgSlider" oninput="document.getElementById('vc_cfgValue').innerText = this.value">
                                </div>
                                
                                <div class="vc-slider-container">
                                    <div class="vc-slider-label">
                                        <span>Sigma Min (Clarity)</span>
                                        <span id="vc_sigmaValue">0.000001</span>
                                    </div>
                                    <input type="range" min="0.0000001" max="0.00001" step="0.0000001" value="0.000001" 
                                           class="vc-slider" id="vc_sigmaSlider" oninput="document.getElementById('vc_sigmaValue').innerText = this.value">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="vc-input-section">
                        <div class="vc-card">
                            <h2><i class="fas fa-play-circle"></i> Controls</h2>
                            <button class="vc-button" id="vc_processBtn" onclick="vc_startRealProcessing()">
                                <i class="fas fa-rocket"></i> Start Conversion
                            </button>
                            <button class="vc-button secondary" onclick="vc_resetSystem()">
                                <i class="fas fa-broom"></i> Reset System
                            </button>
                        </div>
                        
                        <div class="vc-card">
                            <h2><i class="fas fa-terminal"></i> Processing Log</h2>
                            <div class="vc-log-container" id="vc_logOutput">
                                <div class="vc-log-line">
                                    <span class="vc-status-indicator status-green"></span> System Ready. Waiting for input...
                                </div>
                            </div>
                        </div>
                        
                        <div class="vc-card">
                            <h2><i class="fas fa-music"></i> Output Result</h2>
                            <div class="vc-output-audio" id="vc_outputContainer">
                                <div id="vc_placeholderOutput">
                                    <i class="fas fa-headphones fa-3x" style="color: #cbd5e1; margin-bottom: 15px;"></i>
                                    <p style="color: #64748b;">Converted audio will appear here</p>
                                </div>
                                
                                <div id="vc_realOutput" style="display: none;">
                                    <audio id="vc_audioPlayer" controls style="width: 100%; margin-bottom: 15px;"></audio>
                                    <a id="vc_downloadLink" href="#" class="vc-button" style="text-decoration: none;">
                                        <i class="fas fa-download"></i> Download Result
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // NAMESPACED VARIABLES to avoid conflicts
            let vc_currentDevice = 'cuda'; 
            let vc_fileBlobs = { source: null, target: null }; 

            function vc_setDevice(device) {
                vc_currentDevice = device;
                document.getElementById('vc_btn-gpu').className = device === 'cuda' ? 'vc-device-btn active' : 'vc-device-btn';
                document.getElementById('vc_btn-cpu').className = device === 'cpu' ? 'vc-device-btn active' : 'vc-device-btn';
                vc_addLog(`Device switched to: ${device.toUpperCase()}`, 'yellow');
            }

            function vc_addLog(msg, color='green') {
                const box = document.getElementById('vc_logOutput');
                const colorClass = color === 'red' ? 'status-red' : (color === 'yellow' ? 'status-yellow' : 'status-green');
                const line = `<div class="vc-log-line"><span class="vc-status-indicator ${colorClass}"></span> ${msg}</div>`;
                box.innerHTML += line;
                box.scrollTop = box.scrollHeight;
            }

            // --- FILE HANDLING LOGIC ---
            function vc_handleFileSelect(type) {
                const inputId = 'vc_' + type + 'Upload';      
                const infoBoxId = 'vc_' + type + 'InfoBox';   
                const detailsId = 'vc_' + type + 'Details';   

                document.getElementById(inputId).addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const objectUrl = URL.createObjectURL(file);
                        vc_fileBlobs[type] = objectUrl;

                        const audio = new Audio(objectUrl);
                        audio.onloadedmetadata = function() {
                            const duration = audio.duration;
                            const minutes = Math.floor(duration / 60);
                            const seconds = Math.floor(duration % 60);
                            const durationStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                            const sizeMB = (file.size / (1024*1024)).toFixed(2);
                            
                            const box = document.getElementById(infoBoxId);
                            box.classList.add('show');
                            
                            document.getElementById(detailsId).innerHTML = `
                                <strong>${file.name}</strong><br>
                                <span style="font-size:0.85em; color:#64748b;">Size: ${sizeMB} MB | Time: ${durationStr}</span>
                            `;
                            vc_addLog(`Loaded: ${file.name}`, 'green');
                        };
                    }
                });
            }

            // Init listeners
            vc_handleFileSelect('source');
            vc_handleFileSelect('target');

            // --- MODAL FUNCTIONS ---
            function vc_openModal(type) {
                const url = vc_fileBlobs[type];
                if(url) {
                    const modal = document.getElementById('vc_audioModal');
                    const player = document.getElementById('vc_modalAudioPlayer');
                    player.src = url;
                    modal.style.display = 'flex';
                    player.play();
                } else {
                    alert("No audio loaded!");
                }
            }

            function vc_closeModal() {
                const modal = document.getElementById('vc_audioModal');
                const player = document.getElementById('vc_modalAudioPlayer');
                player.pause();
                player.src = "";
                modal.style.display = 'none';
            }

            // --- REMOVE FILE ---
            function vc_removeFile(type) {
                document.getElementById('vc_' + type + 'Upload').value = "";
                document.getElementById('vc_' + type + 'InfoBox').classList.remove('show');
                vc_fileBlobs[type] = null;
                vc_addLog(`${type === 'source' ? 'Target' : 'Original'} audio removed.`, 'yellow');
            }

            // Reset System
            function vc_resetSystem() {
                vc_removeFile('source');
                vc_removeFile('target');
                document.getElementById('vc_logOutput').innerHTML = '<div class="vc-log-line"><span class="vc-status-indicator status-green"></span> System Reset. Waiting...</div>';
                document.getElementById('vc_realOutput').style.display = 'none';
                document.getElementById('vc_placeholderOutput').style.display = 'block';
            }

            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('vc_audioModal');
                if (event.target == modal) {
                    vc_closeModal();
                }
            }

            // --- MAIN PROCESSING ---
            async function vc_startRealProcessing() {
                const sourceFile = document.getElementById('vc_sourceUpload').files[0];
                const targetFile = document.getElementById('vc_targetUpload').files[0];
                const btn = document.getElementById('vc_processBtn');

                if (!sourceFile || !targetFile) {
                    vc_addLog('Error: Please upload both files.', 'red');
                    return;
                }

                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                document.getElementById('vc_realOutput').style.display = 'none';
                document.getElementById('vc_placeholderOutput').style.display = 'block';

                vc_addLog('Uploading files and starting AI conversion...', 'yellow');

                const formData = new FormData();
                formData.append('source_audio', sourceFile);
                formData.append('target_audio', targetFile);
                formData.append('device', vc_currentDevice);
                formData.append('cfg_rate', document.getElementById('vc_cfgSlider').value);
                formData.append('sigma_min', document.getElementById('vc_sigmaSlider').value);

                try {
                    // Keeping the original Fetch endpoint exactly as requested
                    const response = await fetch('/process_vc', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        const errText = await response.text();
                        throw new Error(errText);
                    }

                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const player = document.getElementById('vc_audioPlayer');
                    const dLink = document.getElementById('vc_downloadLink');
                    
                    player.src = url;
                    dLink.href = url;
                    dLink.download = `converted_${Date.now()}.wav`;

                    document.getElementById('vc_placeholderOutput').style.display = 'none';
                    document.getElementById('vc_realOutput').style.display = 'block';
                    
                    vc_addLog('Success! Audio converted successfully.', 'green');

                } catch (err) {
                    console.error(err);
                    let cleanError = err.message;
                    if(cleanError.includes("No model file")) {
                        cleanError = "Processing Failed: No model file found in 'models' folder.";
                    }
                    vc_addLog(cleanError, 'red');
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-rocket"></i> Start Conversion';
                }
            }
        </script>
    </div>
</div>



<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    END Voice-to-Voice Converter
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUDIO & VIDEO EDITOR - COMPLETE OFFLINE TOOL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="tool-section" id="audioCleanerSection">
        <div class="section-header" onclick="toggleSection('audioCleanerContent', 'audioCleanerArrow')">
            <h2 id="audioCleanerTitle">ğŸµ Audio Cleaner & Enhancer</h2>
            <div class="collapse-arrow" id="audioCleanerArrow">â–¼</div>
        </div>
        
        <div class="section-content" id="audioCleanerContent">
            <div class="upload-zone" id="audioUploadZone">
                <input type="file" id="audioFileInput" accept="audio/*" onchange="handleAudioUpload(event)">
                <span class="upload-icon">ğŸ§</span>
                <p class="upload-text" id="audioUploadText">Click or drag audio file here</p>
                <p class="upload-hint" id="audioUploadHint">Supports: MP3, WAV, OGG, FLAC, M4A - No size limit!</p>
            </div>
            
            <div class="file-info hidden" id="audioFileInfo">
                <span class="file-info-icon">ğŸµ</span>
                <div class="file-info-details">
                    <div class="file-info-name" id="audioFileName"></div>
                    <div class="file-info-size" id="audioFileSize"></div>
                </div>
                <button class="file-remove-btn" onclick="removeAudioFile()">âœ•</button>
            </div>
            
            <div class="waveform-container hidden" id="inputWaveformContainer">
                <span class="waveform-label input-label" id="inputWaveformLabel">ğŸ“¥ Input (Before)</span>
                <canvas id="inputWaveformCanvas" class="waveform-canvas"></canvas>
                <div class="waveform-timer" id="inputTimer">00:00 / 00:00</div>
            </div>
            
            <div class="audio-player-wrapper hidden" id="inputAudioPlayer">
                <audio id="inputAudio" controls></audio>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                
                <div class="control-group">
                    <div class="control-label">
                        <span id="noiseReductionLabel">ğŸ”‡ Noise Reduction</span>
                        <span class="control-value" id="noiseReductionValue">50%</span>
                    </div>
                    <input type="range" class="control-slider" id="noiseReductionSlider" 
                           min="0" max="100" step="1" value="50" 
                           oninput="updateSliderValue('noiseReduction', this.value)">
                    <div class="preset-buttons mt-3">
                        <button class="preset-btn" onclick="setNoisePreset(0)" id="noisePreset0">Off</button>
                        <button class="preset-btn active" onclick="setNoisePreset(50)" id="noisePreset50">Medium</button>
                        <button class="preset-btn" onclick="setNoisePreset(100)" id="noisePreset100">Max</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span id="silenceThresholdLabel">âœ‚ï¸ Silence Removal (Sensitivity)</span>
                        <span class="control-value" id="silenceThresholdValue">-30 dB</span>
                    </div>
                    <input type="range" class="control-slider" id="silenceThresholdSlider" 
                           min="-80" max="0" step="1" value="-30" 
                           oninput="updateSliderValue('silenceThreshold', this.value)">
                    <div class="toggle-container mt-3">
                        <label class="toggle-switch">
                            <input type="checkbox" id="trimSilenceToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label" id="trimSilenceLabel">Auto-Cut Silent Parts</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span id="speedLabel">âš¡ Speed</span>
                        <span class="control-value" id="speedValue">1.0x</span>
                    </div>
                    <input type="range" class="control-slider" id="speedSlider" 
                           min="0.5" max="2.5" step="0.1" value="1" 
                           oninput="updateSliderValue('speed', this.value)">
                    <div class="preset-buttons mt-3">
                        <button class="preset-btn" onclick="setSpeedPreset(0.75)" id="speedPreset075">0.75x</button>
                        <button class="preset-btn active" onclick="setSpeedPreset(1)" id="speedPreset1">Normal</button>
                        <button class="preset-btn" onclick="setSpeedPreset(1.5)" id="speedPreset15">1.50x</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-label" style="cursor: pointer;" onclick="document.getElementById('pitchPresetsGrid').classList.toggle('hidden'); document.getElementById('pitchArrowIcon').innerText = document.getElementById('pitchPresetsGrid').classList.contains('hidden') ? 'â–¼' : 'â–²';">
                        <span id="pitchLabel">
                            ğŸ¤ Voice Tone (Pitch) 
                            <span id="pitchArrowIcon" style="margin-left: 8px; font-size: 0.8em;">â–²</span>
                        </span>
                        <span class="control-value" id="pitchValue">0 st</span>
                    </div>
                    
                    <input type="range" class="control-slider" id="pitchSlider" 
                           min="-12" max="12" step="1" value="0" 
                           oninput="updateSliderValue('pitch', this.value)">
                    
                    <div id="pitchPresetsGrid" class="grid grid-cols-5 gap-2 mt-3 transition-all duration-300">
                        <button class="preset-btn text-xs" onclick="setPitchPreset(-12)">Monster</button>
                        <button class="preset-btn text-xs" onclick="setPitchPreset(-8)">V.Deep</button>
                        <button class="preset-btn text-xs" onclick="setPitchPreset(-5)">Deep</button>
                        <button class="preset-btn text-xs" onclick="setPitchPreset(-3)">Heavy</button>
                        <button class="preset-btn text-xs" onclick="setPitchPreset(-1)">Low</button>
                        
                        <button class="preset-btn active text-xs" onclick="setPitchPreset(0)">Normal</button>
                        <button class="preset-btn text-xs" onclick="setPitchPreset(2)">Crisp</button>
                        <button class="preset-btn text-xs" onclick="setPitchPreset(5)">High</button>
                        <button class="preset-btn text-xs" onclick="setPitchPreset(8)">Kid</button>
                        <button class="preset-btn text-xs" onclick="setPitchPreset(12)">Alien</button>
                    </div>
                </div>
            </div>
            
            <div class="progress-container hidden" id="audioProgressContainer">
                <div class="progress-bar" id="audioProgressBar"></div>
            </div>
            <p class="progress-text hidden" id="audioProgressText">Processing Audio...</p>
            
            <div class="buttons-row">
                <button class="process-btn" id="processAudioBtn" onclick="processAudio()" disabled>
                    <span>ğŸš€</span>
                    <span id="processAudioBtnText">Start Processing</span>
                </button>
            </div>
            
            <div class="waveform-container hidden" id="outputWaveformContainer">
                <span class="waveform-label output-label" id="outputWaveformLabel">ğŸ“¤ Output (Result)</span>
                <canvas id="outputWaveformCanvas" class="waveform-canvas"></canvas>
                <div class="waveform-timer" id="outputTimer">00:00 / 00:00</div>
            </div>
            
            <div class="audio-player-wrapper hidden" id="outputAudioPlayer">
                <audio id="outputAudio" controls></audio>
            </div>
            
            <div class="buttons-row hidden" id="audioDownloadContainer">
                <button class="download-btn" id="downloadAudioBtn" onclick="downloadProcessedAudio()">
                    <span>ğŸ’¾</span>
                    <span id="downloadAudioBtnText">Save New Audio</span>
                </button>
            </div>
        </div>
    </div>



<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SECTION :  Audio Master Studio (Converter & Recorder)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->




<div class="tool-section" id="audioMasterSection" style="margin-top: 20px;">
    <div class="section-header" onclick="toggleSection('audioMasterContent', 'audioMasterArrow')">
        <h2 id="amsMainTitle">ğŸ›ï¸ Audio Master Studio (Converter & Recorder)</h2>
        <div class="collapse-arrow" id="audioMasterArrow">â–¼</div>
    </div>

    <div class="section-content hidden" id="audioMasterContent">
        
        <style>
            /* Scoped Styles for Audio Master Studio (ams) */
            #amsWrapper {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background-color: #dfe6e9;
                color: #2d3436;
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                border: 2px solid #6c5ce7;
            }

            #amsWrapper h2 { color: #6c5ce7; margin-top: 0; }
            #amsWrapper h3 { margin: 10px 0 5px 0; color: #6c5ce7; }

            /* Grid Menu */
            .ams-menu-grid { display: grid; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); }

            .ams-menu-btn {
                background: #ffffff;
                border: 2px solid #6c5ce7;
                padding: 15px;
                border-radius: 10px;
                cursor: pointer;
                transition: 0.3s;
                display: flex;
                flex-direction: column;
                align-items: center;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .ams-menu-btn:hover { transform: translateY(-3px); background-color: #f0f0ff; }
            .ams-menu-btn span { font-size: 24px; display:block; margin-bottom:5px; }

            /* Sections */
            .ams-app-section {
                display: none;
                background: #ffffff;
                padding: 15px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                margin-top: 15px;
            }

            /* Buttons & Inputs */
            .ams-back-btn {
                background: #fab1a0; color: #d63031; border: none;
                padding: 8px 15px; border-radius: 20px; font-weight: bold;
                cursor: pointer; margin-bottom: 15px; width: 100%;
            }

            .ams-upload-area {
                border: 2px dashed #ccc; padding: 20px; margin-bottom: 15px;
                border-radius: 10px; cursor: pointer; background: #f9f9f9;
            }
            .ams-upload-area:hover { border-color: #6c5ce7; background: #eee; }
            
            .ams-file-display {
                display: none; align-items: center; justify-content: space-between;
                background: #eee; padding: 8px; border-radius: 8px; margin-bottom: 15px;
            }

            .ams-action-btn {
                width: 100%; padding: 12px; background: #6c5ce7; color: white;
                border: none; border-radius: 8px; font-size: 16px; font-weight: bold;
                cursor: pointer; margin-top: 10px;
            }

            .ams-download-btn {
                width: 100%; padding: 10px; background: #00b894; color: white;
                border: none; border-radius: 8px; font-size: 14px; font-weight: bold;
                cursor: pointer; margin-top: 10px; display: block;
            }

            /* Recorder Controls */
            .ams-rec-controls { display: flex; gap: 5px; margin-top: 10px; }
            .ams-rec-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 12px; }
            .ams-btn-start { background: #00b894; }
            .ams-btn-pause { background: #fdcb6e; color: black; }
            .ams-btn-stop { background: #d63031; }

            .ams-canvas { width: 100%; height: 60px; background: #2d3436; border-radius: 5px; margin-bottom: 5px; }
            .ams-status { font-weight: bold; margin-top: 10px; color: #636e72; font-size: 12px; }
            
            #amsWrapper select { width: 100%; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
            #amsWrapper audio { width: 100%; margin-top: 10px; height: 30px; }
            #amsWrapper video { width: 100%; border-radius: 10px; margin-bottom: 10px; display: none; background: #000; max-height: 200px; }
        </style>

        <div id="amsWrapper">
            <div id="amsMainMenu" class="ams-menu-grid">
                <div class="ams-menu-btn" onclick="ams_openSection('amsVideoSec')">
                    <span>ğŸ¥â”ğŸµ</span>
                    <h3>Video to Audio</h3>
                </div>
                
                <div class="ams-menu-btn" onclick="ams_openSection('amsAudioSec')">
                    <span>ğŸµâ”ğŸµ</span>
                    <h3>Audio Convert</h3>
                </div>

                <div class="ams-menu-btn" onclick="ams_openSection('amsRecSec')">
                    <span>ğŸ™ï¸</span>
                    <h3>Recorder</h3>
                </div>
            </div>

            <div id="amsVideoSec" class="ams-app-section">
                <button class="ams-back-btn" onclick="ams_goBack()">ğŸ”™ Back to Menu</button>
                <h3>Video to Audio Converter</h3>
                
                <div class="ams-upload-area" onclick="document.getElementById('amsVidInput').click()" id="amsVidUploadBox">
                    <p style="margin:0;">ğŸ“‚ Click to Upload Video</p>
                    <input type="file" id="amsVidInput" accept="video/*" style="display:none;" onchange="ams_handleFile(this, 'video')">
                </div>

                <div id="amsVidFileDisplay" class="ams-file-display">
                    <span id="amsVidName" style="font-size:12px; overflow:hidden; text-overflow:ellipsis;"></span>
                    <button onclick="ams_clearInput('video')" style="background:#d63031; color:white; border:none; border-radius:50%; width:20px; cursor:pointer;">X</button>
                </div>
                
                <video id="amsVidPreview" controls></video>

                <label>Select Format:</label>
                <select id="amsVidFormat">
                    <option value="mp3">MP3</option>
                    <option value="aac">AAC</option>
                    <option value="wav">WAV</option>
                </select>

                <button class="ams-action-btn" onclick="ams_processMedia('amsVidInput', 'amsVidFormat', 'amsVidOut', 'amsVidCanvas')">âš¡ Convert</button>

                <div id="amsVidOut" style="display:none; margin-top:15px; border-top:1px solid #ccc; padding-top:10px;">
                    <canvas id="amsVidCanvas" class="ams-canvas"></canvas>
                    <audio id="amsVidAudio" controls></audio>
                    <button class="ams-download-btn" onclick="ams_downloadResult('amsVidFormat')">â¬‡ï¸ Download</button>
                </div>
            </div>

            <div id="amsAudioSec" class="ams-app-section">
                <button class="ams-back-btn" onclick="ams_goBack()">ğŸ”™ Back to Menu</button>
                <h3>Audio Format Converter</h3>

                <div class="ams-upload-area" onclick="document.getElementById('amsAudInput').click()" id="amsAudUploadBox">
                    <p style="margin:0;">ğŸ“‚ Click to Upload Audio</p>
                    <input type="file" id="amsAudInput" accept="audio/*" style="display:none;" onchange="ams_handleFile(this, 'audio')">
                </div>

                <div id="amsAudFileDisplay" class="ams-file-display">
                    <span id="amsAudName" style="font-size:12px; overflow:hidden; text-overflow:ellipsis;"></span>
                    <button onclick="ams_clearInput('audio')" style="background:#d63031; color:white; border:none; border-radius:50%; width:20px; cursor:pointer;">X</button>
                </div>

                <label>Select Format:</label>
                <select id="amsAudFormat">
                    <option value="mp3">MP3</option>
                    <option value="aac">AAC</option>
                    <option value="wav">WAV</option>
                </select>

                <button class="ams-action-btn" onclick="ams_processMedia('amsAudInput', 'amsAudFormat', 'amsAudOut', 'amsAudCanvas')">âš¡ Convert</button>

                <div id="amsAudOut" style="display:none; margin-top:15px; border-top:1px solid #ccc; padding-top:10px;">
                    <canvas id="amsAudCanvas" class="ams-canvas"></canvas>
                    <audio id="amsAudAudio" controls></audio>
                    <button class="ams-download-btn" onclick="ams_downloadResult('amsAudFormat')">â¬‡ï¸ Download</button>
                </div>
            </div>

            <div id="amsRecSec" class="ams-app-section">
                <button class="ams-back-btn" onclick="ams_goBack()">ğŸ”™ Back to Menu</button>
                <h3>My Recorder</h3>

                <canvas id="amsLiveCanvas" class="ams-canvas"></canvas>

                <div class="ams-rec-controls">
                    <button id="amsBtnRec" class="ams-rec-btn ams-btn-start" onclick="ams_startRec()">ğŸ”´ Rec</button>
                    <button id="amsBtnPause" class="ams-rec-btn ams-btn-pause" onclick="ams_pauseRec()" disabled>â¸ Pause</button>
                    <button id="amsBtnStop" class="ams-rec-btn ams-btn-stop" onclick="ams_stopRec()" disabled>â¹ Stop</button>
                </div>
                
                <p id="amsRecTime" style="font-size:20px; font-weight:bold; margin:10px 0;">00:00</p>

                <div id="amsRecOut" style="display:none; margin-top:15px; border-top:1px solid #ccc; padding-top:10px;">
                    <audio id="amsRecAudio" controls></audio>
                    <button class="ams-download-btn" onclick="ams_downloadRecording()">â¬‡ï¸ Download Recording</button>
                </div>
            </div>

            <p id="amsStatus" class="ams-status"></p>
        </div>

        <script>
            // Namespaced logic for AMS (Audio Master Studio)
            let ams_currentBlob = null;
            let ams_audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            // --- Navigation ---
            function ams_openSection(id) {
                document.getElementById('amsMainMenu').style.display = 'none';
                document.querySelectorAll('.ams-app-section').forEach(el => el.style.display = 'none');
                document.getElementById(id).style.display = 'block';
                document.getElementById('amsStatus').innerText = "";
            }

            function ams_goBack() {
                ams_clearInput('video');
                ams_clearInput('audio');
                ams_stopRec();
                document.querySelectorAll('.ams-app-section').forEach(el => el.style.display = 'none');
                document.getElementById('amsMainMenu').style.display = 'grid';
                document.getElementById('amsStatus').innerText = "";
            }

            // --- File Handling ---
            function ams_handleFile(input, type) {
                const file = input.files[0];
                if(!file) return;

                document.getElementById('amsStatus').innerText = "";
                if(type === 'video') {
                    document.getElementById('amsVidOut').style.display = 'none';
                    document.getElementById('amsVidName').innerText = file.name;
                    document.getElementById('amsVidFileDisplay').style.display = 'flex';
                    document.getElementById('amsVidUploadBox').style.display = 'none';
                    
                    const vidEl = document.getElementById('amsVidPreview');
                    vidEl.src = URL.createObjectURL(file);
                    vidEl.style.display = 'block';
                } 
                else if (type === 'audio') {
                    document.getElementById('amsAudOut').style.display = 'none';
                    document.getElementById('amsAudName').innerText = file.name;
                    document.getElementById('amsAudFileDisplay').style.display = 'flex';
                    document.getElementById('amsAudUploadBox').style.display = 'none';
                }
            }

            function ams_clearInput(type) {
                document.getElementById('amsStatus').innerText = "";
                ams_currentBlob = null;

                if(type === 'video') {
                    document.getElementById('amsVidInput').value = "";
                    document.getElementById('amsVidFileDisplay').style.display = 'none';
                    document.getElementById('amsVidUploadBox').style.display = 'block';
                    document.getElementById('amsVidPreview').style.display = 'none';
                    document.getElementById('amsVidPreview').src = "";
                    document.getElementById('amsVidOut').style.display = 'none';
                }
                else if (type === 'audio') {
                    document.getElementById('amsAudInput').value = "";
                    document.getElementById('amsAudFileDisplay').style.display = 'none';
                    document.getElementById('amsAudUploadBox').style.display = 'block';
                    document.getElementById('amsAudOut').style.display = 'none';
                }
            }

            // --- Conversion ---
            async function ams_processMedia(inputId, formatId, outDivId, canvasId) {
                const input = document.getElementById(inputId);
                const status = document.getElementById('amsStatus');
                
                if(!input.files[0]) { alert("Please upload a file first!"); return; }

                status.innerText = "Processing... Please wait...";
                status.style.color = "blue";

                try {
                    const file = input.files[0];
                    const arrayBuffer = await file.arrayBuffer();
                    const audioBuffer = await ams_audioCtx.decodeAudioData(arrayBuffer);

                    ams_currentBlob = ams_encodeWAV(audioBuffer);

                    const url = URL.createObjectURL(ams_currentBlob);
                    const audioEl = document.querySelector(`#${outDivId} audio`);
                    audioEl.src = url;
                    
                    document.getElementById(outDivId).style.display = 'block';
                    ams_drawWaveform(audioBuffer, canvasId);

                    status.innerText = "Done! Ready to Download.";
                    status.style.color = "green";

                } catch (e) {
                    console.error(e);
                    status.innerText = "Error: Format not supported.";
                    status.style.color = "red";
                }
            }

            function ams_downloadResult(formatId) {
                if(!ams_currentBlob) return;
                const format = document.getElementById(formatId).value;
                let ext = format === 'mp3' ? "mp3" : (format === 'aac' ? "aac" : "wav");

                let fileName = prompt("Enter file name:", "converted_audio");
                if(fileName) {
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(ams_currentBlob);
                    a.download = fileName + "." + ext;
                    a.click();
                }
            }

            // --- Recorder ---
            let ams_mediaRecorder;
            let ams_chunks = [];
            let ams_recInterval;
            let ams_stream;
            let ams_analyser;
            let ams_dataArray;
            let ams_animId;
            let ams_recBlob = null;

            async function ams_startRec() {
                ams_stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                ams_mediaRecorder = new MediaRecorder(ams_stream);
                
                const source = ams_audioCtx.createMediaStreamSource(ams_stream);
                ams_analyser = ams_audioCtx.createAnalyser();
                source.connect(ams_analyser);
                ams_analyser.fftSize = 2048;
                ams_dataArray = new Uint8Array(ams_analyser.frequencyBinCount);
                ams_visualizeLive();

                ams_mediaRecorder.ondataavailable = e => ams_chunks.push(e.data);
                ams_mediaRecorder.onstop = () => {
                    ams_recBlob = new Blob(ams_chunks, { type: 'audio/webm' });
                    document.getElementById('amsRecAudio').src = URL.createObjectURL(ams_recBlob);
                    document.getElementById('amsRecOut').style.display = 'block';
                    ams_chunks = [];
                };

                ams_mediaRecorder.start();
                document.getElementById('amsBtnRec').disabled = true;
                document.getElementById('amsBtnPause').disabled = false;
                document.getElementById('amsBtnStop').disabled = false;
                document.getElementById('amsRecOut').style.display = 'none';
                
                ams_recInterval = setInterval(ams_updateTimer, 1000);
            }

            function ams_pauseRec() {
                if(ams_mediaRecorder.state === "recording") {
                    ams_mediaRecorder.pause();
                    clearInterval(ams_recInterval);
                    document.getElementById('amsBtnPause').innerText = "â–¶ Resume";
                    document.getElementById('amsBtnPause').style.background = "#00b894";
                } else if(ams_mediaRecorder.state === "paused") {
                    ams_mediaRecorder.resume();
                    ams_recInterval = setInterval(ams_updateTimer, 1000);
                    document.getElementById('amsBtnPause').innerText = "â¸ Pause";
                    document.getElementById('amsBtnPause').style.background = "#fdcb6e";
                }
            }

            function ams_stopRec() {
                if(ams_mediaRecorder && ams_mediaRecorder.state !== 'inactive') {
                    ams_mediaRecorder.stop();
                    ams_stream.getTracks().forEach(track => track.stop());
                }
                clearInterval(ams_recInterval);
                cancelAnimationFrame(ams_animId);
                
                document.getElementById('amsBtnRec').disabled = false;
                document.getElementById('amsBtnPause').disabled = true;
                document.getElementById('amsBtnStop').disabled = true;
                document.getElementById('amsBtnPause').innerText = "â¸ Pause";
                document.getElementById('amsRecTime').innerText = "00:00";
                
                const canvas = document.getElementById('amsLiveCanvas');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            function ams_downloadRecording() {
                if(!ams_recBlob) return;
                let fileName = prompt("Enter file name:", "my_recording");
                if(fileName) {
                    let a = document.createElement('a');
                    a.href = URL.createObjectURL(ams_recBlob);
                    a.download = fileName + ".wav";
                    a.click();
                }
            }

            function ams_updateTimer() {
                let txt = document.getElementById('amsRecTime').innerText;
                let parts = txt.split(':');
                let s = parseInt(parts[1]) + 1;
                let m = parseInt(parts[0]);
                if(s>59) { s=0; m++; }
                document.getElementById('amsRecTime').innerText = (m<10?"0"+m:m) + ":" + (s<10?"0"+s:s);
            }

            function ams_visualizeLive() {
                const canvas = document.getElementById('amsLiveCanvas');
                const ctx = canvas.getContext('2d');
                const width = canvas.width = canvas.offsetWidth;
                const height = canvas.height = canvas.offsetHeight;

                function draw() {
                    ams_animId = requestAnimationFrame(draw);
                    ams_analyser.getByteTimeDomainData(ams_dataArray);
                    ctx.fillStyle = '#2d3436';
                    ctx.fillRect(0, 0, width, height);
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = '#00b894';
                    ctx.beginPath();
                    let sliceWidth = width * 1.0 / ams_analyser.frequencyBinCount;
                    let x = 0;
                    for(let i = 0; i < ams_analyser.frequencyBinCount; i++) {
                        let v = ams_dataArray[i] / 128.0;
                        let y = v * height / 2;
                        if(i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                        x += sliceWidth;
                    }
                    ctx.lineTo(canvas.width, canvas.height/2);
                    ctx.stroke();
                }
                draw();
            }

            // --- Shared Utils ---
            function ams_drawWaveform(buffer, canvasId) {
                const canvas = document.getElementById(canvasId);
                const ctx = canvas.getContext('2d');
                const width = canvas.width = canvas.offsetWidth;
                const height = canvas.height = canvas.offsetHeight;
                const data = buffer.getChannelData(0);
                const step = Math.ceil(data.length / width);
                const amp = height / 2;

                ctx.fillStyle = '#2d3436';
                ctx.fillRect(0, 0, width, height);
                ctx.fillStyle = '#6c5ce7';
                for(let i=0; i < width; i++) {
                    let min = 1.0, max = -1.0;
                    for (let j=0; j<step; j++) {
                        const datum = data[(i*step)+j];
                        if (datum < min) min = datum;
                        if (datum > max) max = datum;
                    }
                    ctx.fillRect(i, (1+min)*amp, 1, Math.max(1, (max-min)*amp));
                }
            }

            function ams_encodeWAV(samples) {
                const buffer = samples.getChannelData(0);
                const sampleRate = samples.sampleRate;
                const arr = new ArrayBuffer(44 + buffer.length * 2);
                const view = new DataView(arr);
                const writeString = (o, s) => { for(let i=0;i<s.length;i++) view.setUint8(o+i, s.charCodeAt(i)); };
                writeString(0, 'RIFF'); view.setUint32(4, 36 + buffer.length*2, true); writeString(8, 'WAVEfmt ');
                view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
                view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate*2, true);
                view.setUint16(32, 2, true); view.setUint16(34, 16, true); writeString(36, 'data');
                view.setUint32(40, buffer.length*2, true);
                for (let i = 0; i < buffer.length; i++) {
                    let s = Math.max(-1, Math.min(1, buffer[i]));
                    view.setInt16(44 + i * 2, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
                }
                return new Blob([view], { type: 'audio/wav' });
            }
        </script>
    </div>
</div>



<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SECTION : END Audio Master Studio (Converter & Recorder)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SECTION 2: VIDEO TO AUDIO CONVERTER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tool-section" id="videoConverterSection">
        <div class="section-header" onclick="toggleSection('videoConverterContent', 'videoConverterArrow')">
            <h2 id="videoConverterTitle">ğŸ¬ Video to Audio Converter</h2>
            <div class="collapse-arrow" id="videoConverterArrow">â–¼</div>
        </div>
        
        <div class="section-content" id="videoConverterContent">
            <!-- Video Upload Zone -->
            <div class="upload-zone" id="videoUploadZone">
                <input type="file" id="videoFileInput" accept="video/*" onchange="handleVideoUpload(event)">
                <span class="upload-icon">ğŸ¬</span>
                <p class="upload-text" id="videoUploadText">Click or drag video file here</p>
                <p class="upload-hint" id="videoUploadHint">Supports: MP4, WebM, MKV, AVI, MOV - No size limit!</p>
            </div>
            
            <!-- File Info (Hidden initially) -->
            <div class="file-info hidden" id="videoFileInfo">
                <span class="file-info-icon">ğŸ¬</span>
                <div class="file-info-details">
                    <div class="file-info-name" id="videoFileName"></div>
                    <div class="file-info-size" id="videoFileSize"></div>
                </div>
                <button class="file-remove-btn" onclick="removeVideoFile()">âœ•</button>
            </div>
            
            <!-- Video Preview -->
            <div class="video-preview-container hidden" id="videoPreviewContainer">
                <video id="videoPreview" class="video-preview" controls></video>
            </div>
            
            <!-- Audio Format Selection -->
            <div class="control-group hidden" id="audioFormatGroup">
                <div class="control-label">
                    <span id="audioFormatLabel">ğŸ“ Output Audio Format</span>
                </div>
                <div class="preset-buttons">
                    <button class="preset-btn active" onclick="setAudioFormat('mp3')" id="formatMp3">MP3</button>
                    <button class="preset-btn" onclick="setAudioFormat('wav')" id="formatWav">WAV</button>
                    <button class="preset-btn" onclick="setAudioFormat('ogg')" id="formatOgg">OGG</button>
                    <button class="preset-btn" onclick="setAudioFormat('webm')" id="formatWebm">WebM</button>
                </div>
            </div>
            
            <!-- Audio Quality -->
            <div class="control-group hidden" id="audioQualityGroup">
                <div class="control-label">
                    <span id="audioQualityLabel">ğŸšï¸ Audio Quality</span>
                    <span class="control-value" id="audioQualityValue">192 kbps</span>
                </div>
                <input type="range" class="control-slider" id="audioQualitySlider" 
                       min="64" max="320" step="32" value="192" 
                       oninput="updateSliderValue('audioQuality', this.value)">
            </div>
            
            <!-- Convert Progress -->
            <div class="progress-container hidden" id="videoProgressContainer">
                <div class="progress-bar" id="videoProgressBar"></div>
            </div>
            <p class="progress-text hidden" id="videoProgressText">Converting...</p>
            
            <!-- Convert Button -->
            <div class="buttons-row">
                <button class="process-btn" id="convertVideoBtn" onclick="convertVideoToAudio()" disabled>
                    <span>ğŸ”„</span>
                    <span id="convertVideoBtnText">Convert to Audio</span>
                </button>
            </div>
            
            <!-- Extracted Audio Waveform -->
            <div class="waveform-container hidden" id="extractedWaveformContainer">
                <span class="waveform-label output-label" id="extractedWaveformLabel">ğŸµ Extracted Audio</span>
                <canvas id="extractedWaveformCanvas" class="waveform-canvas"></canvas>
                <div class="waveform-timer" id="extractedTimer">00:00 / 00:00</div>
            </div>
            
            <!-- Extracted Audio Player -->
            <div class="audio-player-wrapper hidden" id="extractedAudioPlayer">
                <audio id="extractedAudio" controls></audio>
            </div>
            
            <!-- Download Button -->
            <div class="buttons-row hidden" id="videoDownloadContainer">
                <button class="download-btn" id="downloadExtractedBtn" onclick="downloadExtractedAudio()">
                    <span>ğŸ’¾</span>
                    <span id="downloadExtractedBtnText">Download Audio</span>
                </button>
            </div>
        </div>
    </div>
    
</div>

            </div>
        </div>
    </div>
    
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUDIO & VIDEO EDITOR JAVASCRIPT - OFFLINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ØªÙ…Ø§Ù… ACCORDION/COLLAPSIBLE Ø³ÛŒÚ©Ø´Ù†Ø² Ú©Ùˆ Ø¨Ù†Ø¯ Ø±Ú©Ú¾ÛŒÚº
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', function() {
    
    // ØªÙ…Ø§Ù… section-content Ú©Ùˆ Ø¨Ù†Ø¯ Ú©Ø±Ùˆ
    var allSectionContents = document.querySelectorAll('.section-content');
    allSectionContents.forEach(function(content) {
        content.classList.add('hidden');
    });
    
    // ØªÙ…Ø§Ù… collapse-arrow Ú©Ùˆ collapsed Ú©Ø±Ùˆ
    var allArrows = document.querySelectorAll('.collapse-arrow');
    allArrows.forEach(function(arrow) {
        arrow.classList.add('collapsed');
    });
    
    console.log('âœ… All sections closed by default');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUDIO & VIDEO EDITOR - COMPLETE OFFLINE PROCESSING ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const editorTranslations = {
    en: {
        mainTitle: "Audio & Video Editor",
        subtitle: "Professional offline audio processing & video conversion",
        audioCleanerTitle: "ğŸµ Audio Cleaner & Enhancer",
        videoConverterTitle: "ğŸ¬ Video to Audio Converter",
        audioUploadText: "Click or drag audio file here",
        audioUploadHint: "Supports: MP3, WAV, OGG, FLAC, M4A - No size limit!",
        videoUploadText: "Click or drag video file here",
        videoUploadHint: "Supports: MP4, WebM, MKV, AVI, MOV - No size limit!",
        noiseReductionLabel: "ğŸ”‡ Noise Reduction",
        silenceThresholdLabel: "âœ‚ï¸ Silence Threshold",
        trimSilenceLabel: "Trim Silent Parts",
        speedLabel: "âš¡ Speed",
        pitchLabel: "ğŸ¤ Pitch (Voice Tone)",
        processAudioBtn: "Process Audio",
        processing: "Processing...",
        downloadAudioBtn: "Download Processed Audio",
        inputWaveformLabel: "ğŸ“¥ Input (Before)",
        outputWaveformLabel: "ğŸ“¤ Output (After)",
        audioFormatLabel: "ğŸ“ Output Audio Format",
        audioQualityLabel: "ğŸšï¸ Audio Quality",
        convertVideoBtn: "Convert to Audio",
        converting: "Converting...",
        downloadExtractedBtn: "Download Audio",
        extractedWaveformLabel: "ğŸµ Extracted Audio",
        langToggle: "Ø§Ø±Ø¯Ùˆ",
        noisePresets: { off: "Off", light: "Light", medium: "Medium", heavy: "Heavy", max: "Max" },
        speedPresets: { slow: "0.5x", normal: "1x", fast: "1.5x", faster: "2x" },
        pitchPresets: { deep: "ğŸ”Š Deep", low: "Low", normal: "Normal", high: "High", thin: "ğŸ”” Thin" },
        notifications: {
            audioLoaded: "Audio file loaded successfully!",
            videoLoaded: "Video file loaded successfully!",
            processingStart: "Processing audio...",
            processingDone: "Audio processing complete!",
            convertingStart: "Extracting audio from video...",
            convertingDone: "Audio extraction complete!",
            downloadReady: "Your file is ready for download!",
            error: "An error occurred. Please try again.",
            noFile: "Please upload a file first."
        }
    },
    ur: {
        mainTitle: "Ø¢ÚˆÛŒÙˆ Ø§ÙˆØ± ÙˆÛŒÚˆÛŒÙˆ Ø§ÛŒÚˆÛŒÙ¹Ø±",
        subtitle: "Ù¾Ø±ÙˆÙÛŒØ´Ù†Ù„ Ø¢Ù Ù„Ø§Ø¦Ù† Ø¢ÚˆÛŒÙˆ Ù¾Ø±ÙˆØ³ÛŒØ³Ù†Ú¯ Ø§ÙˆØ± ÙˆÛŒÚˆÛŒÙˆ Ú©Ù†ÙˆØ±Ú˜Ù†",
        audioCleanerTitle: "ğŸµ Ø¢ÚˆÛŒÙˆ Ú©Ù„ÛŒÙ†Ø± Ø§ÙˆØ± Ø§ÛŒÙ†ÛØ§Ù†Ø³Ø±",
        videoConverterTitle: "ğŸ¬ ÙˆÛŒÚˆÛŒÙˆ Ø³Û’ Ø¢ÚˆÛŒÙˆ Ú©Ù†ÙˆØ±Ù¹Ø±",
        audioUploadText: "Ø¢ÚˆÛŒÙˆ ÙØ§Ø¦Ù„ ÛŒÛØ§Úº ÚˆØ±Ø§Ù¾ Ú©Ø±ÛŒÚº ÛŒØ§ Ú©Ù„Ú© Ú©Ø±ÛŒÚº",
        audioUploadHint: "Ø³Ù¾ÙˆØ±Ù¹: MP3, WAV, OGG, FLAC, M4A - Ú©ÙˆØ¦ÛŒ Ø³Ø§Ø¦Ø² Ù„Ù…Ù¹ Ù†ÛÛŒÚº!",
        videoUploadText: "ÙˆÛŒÚˆÛŒÙˆ ÙØ§Ø¦Ù„ ÛŒÛØ§Úº ÚˆØ±Ø§Ù¾ Ú©Ø±ÛŒÚº ÛŒØ§ Ú©Ù„Ú© Ú©Ø±ÛŒÚº",
        videoUploadHint: "Ø³Ù¾ÙˆØ±Ù¹: MP4, WebM, MKV, AVI, MOV - Ú©ÙˆØ¦ÛŒ Ø³Ø§Ø¦Ø² Ù„Ù…Ù¹ Ù†ÛÛŒÚº!",
        noiseReductionLabel: "ğŸ”‡ Ø´ÙˆØ± Ú©Ù… Ú©Ø±ÛŒÚº",
        silenceThresholdLabel: "âœ‚ï¸ Ø®Ø§Ù…ÙˆØ´ÛŒ Ú©ÛŒ Ø­Ø¯",
        trimSilenceLabel: "Ø®Ø§Ù…ÙˆØ´ Ø­ØµÛ’ Ú©Ø§Ù¹ÛŒÚº",
        speedLabel: "âš¡ Ø±ÙØªØ§Ø±",
        pitchLabel: "ğŸ¤ Ø¢ÙˆØ§Ø² Ú©ÛŒ Ù¾Ú† (Ù¹ÙˆÙ†)",
        processAudioBtn: "Ø¢ÚˆÛŒÙˆ Ù¾Ø±ÙˆØ³ÛŒØ³ Ú©Ø±ÛŒÚº",
        processing: "Ù¾Ø±ÙˆØ³ÛŒØ³Ù†Ú¯ Ø¬Ø§Ø±ÛŒ ÛÛ’...",
        downloadAudioBtn: "Ù¾Ø±ÙˆØ³ÛŒØ³Úˆ Ø¢ÚˆÛŒÙˆ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº",
        inputWaveformLabel: "ğŸ“¥ Ø§Ù† Ù¾Ù¹ (Ù¾ÛÙ„Û’)",
        outputWaveformLabel: "ğŸ“¤ Ø¢Ø¤Ù¹ Ù¾Ù¹ (Ø¨Ø¹Ø¯ Ù…ÛŒÚº)",
        audioFormatLabel: "ğŸ“ Ø¢ÚˆÛŒÙˆ ÙØ§Ø±Ù…ÛŒÙ¹",
        audioQualityLabel: "ğŸšï¸ Ø¢ÚˆÛŒÙˆ Ú©ÙˆØ§Ù„Ù¹ÛŒ",
        convertVideoBtn: "Ø¢ÚˆÛŒÙˆ Ù…ÛŒÚº ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº",
        converting: "ØªØ¨Ø¯ÛŒÙ„ ÛÙˆ Ø±ÛØ§ ÛÛ’...",
        downloadExtractedBtn: "Ø¢ÚˆÛŒÙˆ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº",
        extractedWaveformLabel: "ğŸµ Ù†Ú©Ø§Ù„Ø§ Ú¯ÛŒØ§ Ø¢ÚˆÛŒÙˆ",
        langToggle: "English",
        noisePresets: { off: "Ø¨Ù†Ø¯", light: "ÛÙ„Ú©Ø§", medium: "Ø¯Ø±Ù…ÛŒØ§Ù†Û", heavy: "Ø²ÛŒØ§Ø¯Û", max: "Ù…Ú©Ù…Ù„" },
        speedPresets: { slow: "0.5x", normal: "1x", fast: "1.5x", faster: "2x" },
        pitchPresets: { deep: "ğŸ”Š Ø¨Ú¾Ø§Ø±ÛŒ", low: "Ú¯ÛØ±ÛŒ", normal: "Ù†Ø§Ø±Ù…Ù„", high: "Ø§ÙˆÙ†Ú†ÛŒ", thin: "ğŸ”” Ø¨Ø§Ø±ÛŒÚ©" },
        notifications: {
            audioLoaded: "Ø¢ÚˆÛŒÙˆ ÙØ§Ø¦Ù„ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù„ÙˆÚˆ ÛÙˆ Ú¯Ø¦ÛŒ!",
            videoLoaded: "ÙˆÛŒÚˆÛŒÙˆ ÙØ§Ø¦Ù„ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù„ÙˆÚˆ ÛÙˆ Ú¯Ø¦ÛŒ!",
            processingStart: "Ø¢ÚˆÛŒÙˆ Ù¾Ø±ÙˆØ³ÛŒØ³Ù†Ú¯ Ø´Ø±ÙˆØ¹...",
            processingDone: "Ø¢ÚˆÛŒÙˆ Ù¾Ø±ÙˆØ³ÛŒØ³Ù†Ú¯ Ù…Ú©Ù…Ù„!",
            convertingStart: "ÙˆÛŒÚˆÛŒÙˆ Ø³Û’ Ø¢ÚˆÛŒÙˆ Ù†Ú©Ø§Ù„Ø§ Ø¬Ø§ Ø±ÛØ§ ÛÛ’...",
            convertingDone: "Ø¢ÚˆÛŒÙˆ Ù†Ú©Ø§Ù„Ù†Ø§ Ù…Ú©Ù…Ù„!",
            downloadReady: "Ø¢Ù¾ Ú©ÛŒ ÙØ§Ø¦Ù„ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Û’ Ù„ÛŒÛ’ ØªÛŒØ§Ø± ÛÛ’!",
            error: "Ø§ÛŒÚ© Ø®Ø±Ø§Ø¨ÛŒ Ù¾ÛŒØ´ Ø¢Ø¦ÛŒÛ” Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”",
            noFile: "Ù¾ÛÙ„Û’ ÙØ§Ø¦Ù„ Ø§Ù¾Ù„ÙˆÚˆ Ú©Ø±ÛŒÚºÛ”"
        }
    }
};

let editorCurrentLang = 'en';
let audioContext = null;
let originalAudioBuffer = null;
let processedAudioBuffer = null;
let extractedAudioBlob = null;
let selectedAudioFormat = 'mp3';
let inputAudioFile = null;
let inputVideoFile = null;

function initAudioContext() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    return audioContext;
}

function toggleEditorLanguage() {
    editorCurrentLang = editorCurrentLang === 'en' ? 'ur' : 'en';
    const t = editorTranslations[editorCurrentLang];
    const container = document.getElementById('audioVideoEditorSection');
    
    if (editorCurrentLang === 'ur') {
        container.setAttribute('dir', 'rtl');
    } else {
        container.setAttribute('dir', 'ltr');
    }
    
    document.getElementById('langToggleBtn').textContent = t.langToggle;
    document.getElementById('editorMainTitle').textContent = t.mainTitle;
    document.getElementById('editorSubtitle').textContent = t.subtitle;
    document.getElementById('audioCleanerTitle').textContent = t.audioCleanerTitle;
    document.getElementById('videoConverterTitle').textContent = t.videoConverterTitle;
    document.getElementById('audioUploadText').textContent = t.audioUploadText;
    document.getElementById('audioUploadHint').textContent = t.audioUploadHint;
    document.getElementById('videoUploadText').textContent = t.videoUploadText;
    document.getElementById('videoUploadHint').textContent = t.videoUploadHint;
    document.getElementById('noiseReductionLabel').textContent = t.noiseReductionLabel;
    document.getElementById('silenceThresholdLabel').textContent = t.silenceThresholdLabel;
    document.getElementById('trimSilenceLabel').textContent = t.trimSilenceLabel;
    document.getElementById('speedLabel').textContent = t.speedLabel;
    document.getElementById('pitchLabel').textContent = t.pitchLabel;
    document.getElementById('processAudioBtnText').textContent = t.processAudioBtn;
    document.getElementById('downloadAudioBtnText').textContent = t.downloadAudioBtn;
    document.getElementById('inputWaveformLabel').textContent = t.inputWaveformLabel;
    document.getElementById('outputWaveformLabel').textContent = t.outputWaveformLabel;
    document.getElementById('audioFormatLabel').textContent = t.audioFormatLabel;
    document.getElementById('audioQualityLabel').textContent = t.audioQualityLabel;
    document.getElementById('convertVideoBtnText').textContent = t.convertVideoBtn;
    document.getElementById('downloadExtractedBtnText').textContent = t.downloadExtractedBtn;
    document.getElementById('extractedWaveformLabel').textContent = t.extractedWaveformLabel;
    
    document.getElementById('noisePreset0').textContent = t.noisePresets.off;
    document.getElementById('noisePreset25').textContent = t.noisePresets.light;
    document.getElementById('noisePreset50').textContent = t.noisePresets.medium;
    document.getElementById('noisePreset75').textContent = t.noisePresets.heavy;
    document.getElementById('noisePreset100').textContent = t.noisePresets.max;
    
    document.getElementById('pitchPresetDeep').textContent = t.pitchPresets.deep;
    document.getElementById('pitchPresetLow').textContent = t.pitchPresets.low;
    document.getElementById('pitchPresetNormal').textContent = t.pitchPresets.normal;
    document.getElementById('pitchPresetHigh').textContent = t.pitchPresets.high;
    document.getElementById('pitchPresetThin').textContent = t.pitchPresets.thin;
    
    if(typeof showNotification === 'function') {
        showNotification(editorCurrentLang === 'ur' ? 'Ø²Ø¨Ø§Ù† Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº ØªØ¨Ø¯ÛŒÙ„ ÛÙˆ Ú¯Ø¦ÛŒ' : 'Language changed to English', 'success');
    }
}

function toggleSection(contentId, arrowId) {
    const content = document.getElementById(contentId);
    const arrow = document.getElementById(arrowId);
    
    if (content.classList.contains('hidden')) {
        content.classList.remove('hidden');
        arrow.classList.remove('collapsed');
    } else {
        content.classList.add('hidden');
        arrow.classList.add('collapsed');
    }
}

function updateSliderValue(type, value) {
    switch(type) {
        case 'noiseReduction':
            document.getElementById('noiseReductionValue').textContent = value + '%';
            updateNoisePresetButtons(parseInt(value));
            break;
        case 'silenceThreshold':
            document.getElementById('silenceThresholdValue').textContent = value + ' dB';
            break;
        case 'speed':
            document.getElementById('speedValue').textContent = parseFloat(value).toFixed(2) + 'x';
            updateSpeedPresetButtons(parseFloat(value));
            break;
        case 'pitch':
            document.getElementById('pitchValue').textContent = value + ' st';
            updatePitchPresetButtons(parseFloat(value));
            break;
        case 'audioQuality':
            document.getElementById('audioQualityValue').textContent = value + ' kbps';
            break;
    }
}

function setNoisePreset(value) {
    document.getElementById('noiseReductionSlider').value = value;
    updateSliderValue('noiseReduction', value);
}

function updateNoisePresetButtons(value) {
    const presets = [0, 25, 50, 75, 100];
    presets.forEach(p => {
        const btn = document.getElementById('noisePreset' + p);
        if (btn) btn.classList.toggle('active', value === p);
    });
}

function setSpeedPreset(value) {
    document.getElementById('speedSlider').value = value;
    updateSliderValue('speed', value);
}

function updateSpeedPresetButtons(value) {
    const presets = { '0.5': 'speedPreset05', '0.75': 'speedPreset075', '1': 'speedPreset1', '1.5': 'speedPreset15', '2': 'speedPreset2' };
    Object.keys(presets).forEach(p => {
        const btn = document.getElementById(presets[p]);
        if (btn) btn.classList.toggle('active', Math.abs(value - parseFloat(p)) < 0.01);
    });
}

function setPitchPreset(value) {
    document.getElementById('pitchSlider').value = value;
    updateSliderValue('pitch', value);
}

function updatePitchPresetButtons(value) {
    const presets = { '-6': 'pitchPresetDeep', '-3': 'pitchPresetLow', '0': 'pitchPresetNormal', '3': 'pitchPresetHigh', '6': 'pitchPresetThin' };
    Object.keys(presets).forEach(p => {
        const btn = document.getElementById(presets[p]);
        if (btn) btn.classList.toggle('active', Math.abs(value - parseFloat(p)) < 0.01);
    });
}

function setAudioFormat(format) {
    selectedAudioFormat = format;
    ['mp3', 'wav', 'ogg', 'webm'].forEach(f => {
        const btn = document.getElementById('format' + f.charAt(0).toUpperCase() + f.slice(1));
        if (btn) btn.classList.toggle('active', f === format);
    });
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
}

async function handleAudioUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    inputAudioFile = file;
    const t = editorTranslations[editorCurrentLang];
    
    document.getElementById('audioFileInfo').classList.remove('hidden');
    document.getElementById('audioFileName').textContent = file.name;
    document.getElementById('audioFileSize').textContent = formatFileSize(file.size);
    document.getElementById('audioUploadZone').style.display = 'none';
    
    try {
        initAudioContext();
        const arrayBuffer = await file.arrayBuffer();
        originalAudioBuffer = await audioContext.decodeAudioData(arrayBuffer);
        
        document.getElementById('inputWaveformContainer').classList.remove('hidden');
        drawWaveform(originalAudioBuffer, 'inputWaveformCanvas', '#ef4444');
        
        const duration = originalAudioBuffer.duration;
        document.getElementById('inputTimer').textContent = '00:00 / ' + formatTime(duration);
        
        document.getElementById('inputAudioPlayer').classList.remove('hidden');
        const audioEl = document.getElementById('inputAudio');
        audioEl.src = URL.createObjectURL(file);
        
        audioEl.ontimeupdate = function() {
            document.getElementById('inputTimer').textContent = formatTime(audioEl.currentTime) + ' / ' + formatTime(audioEl.duration || duration);
        };
        
        document.getElementById('processAudioBtn').disabled = false;
        
        if(typeof showNotification === 'function') {
            showNotification(t.notifications.audioLoaded, 'success');
        }
    } catch (error) {
        console.error('Audio load error:', error);
        if(typeof showNotification === 'function') {
            showNotification(t.notifications.error, 'error');
        }
    }
}

function removeAudioFile() {
    inputAudioFile = null;
    originalAudioBuffer = null;
    processedAudioBuffer = null;
    
    document.getElementById('audioFileInput').value = '';
    document.getElementById('audioFileInfo').classList.add('hidden');
    document.getElementById('audioUploadZone').style.display = '';
    document.getElementById('inputWaveformContainer').classList.add('hidden');
    document.getElementById('inputAudioPlayer').classList.add('hidden');
    document.getElementById('outputWaveformContainer').classList.add('hidden');
    document.getElementById('outputAudioPlayer').classList.add('hidden');
    document.getElementById('audioDownloadContainer').classList.add('hidden');
    document.getElementById('processAudioBtn').disabled = true;
}

function drawWaveform(audioBuffer, canvasId, color) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    const dpr = window.devicePixelRatio || 1;
    
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);
    
    const width = rect.width;
    const height = rect.height;
    
    const rawData = audioBuffer.getChannelData(0);
    const samples = Math.min(rawData.length, width * 2);
    const blockSize = Math.floor(rawData.length / samples);
    const filteredData = [];
    
    for (let i = 0; i < samples; i++) {
        let sum = 0;
        for (let j = 0; j < blockSize; j++) {
            sum += Math.abs(rawData[(i * blockSize) + j]);
        }
        filteredData.push(sum / blockSize);
    }
    
    const maxVal = Math.max.apply(null, filteredData);
    const normalizedData = filteredData.map(function(n) { return n / maxVal; });
    
    ctx.clearRect(0, 0, width, height);
    
    ctx.fillStyle = 'rgba(0,0,0,0.3)';
    ctx.fillRect(0, 0, width, height);
    
    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, height / 2);
    ctx.lineTo(width, height / 2);
    ctx.stroke();
    
    const barWidth = width / samples;
    ctx.fillStyle = color;
    
    for (let i = 0; i < samples; i++) {
        const x = i * barWidth;
        const barHeight = normalizedData[i] * height * 0.8;
        const y = (height - barHeight) / 2;
        ctx.fillRect(x, y, Math.max(barWidth - 1, 1), barHeight);
    }
}

async function processAudio() {
    if (!originalAudioBuffer) {
        if(typeof showNotification === 'function') {
            showNotification(editorTranslations[editorCurrentLang].notifications.noFile, 'error');
        }
        return;
    }
    
    const t = editorTranslations[editorCurrentLang];
    const btn = document.getElementById('processAudioBtn');
    const btnText = document.getElementById('processAudioBtnText');
    const progressContainer = document.getElementById('audioProgressContainer');
    const progressBar = document.getElementById('audioProgressBar');
    const progressText = document.getElementById('audioProgressText');
    
    const noiseReduction = parseInt(document.getElementById('noiseReductionSlider').value);
    const silenceThreshold = parseInt(document.getElementById('silenceThresholdSlider').value);
    const trimSilence = document.getElementById('trimSilenceToggle').checked;
    const speed = parseFloat(document.getElementById('speedSlider').value);
    const pitch = parseFloat(document.getElementById('pitchSlider').value);
    
    btn.disabled = true;
    btn.classList.add('processing');
    btnText.textContent = t.processing;
    progressContainer.classList.remove('hidden');
    progressText.classList.remove('hidden');
    
    if(typeof showNotification === 'function') {
        showNotification(t.notifications.processingStart, 'info');
    }
    
    try {
        let progress = 0;
        const progressInterval = setInterval(function() {
            progress += Math.random() * 15;
            if (progress > 90) progress = 90;
            progressBar.style.width = progress + '%';
            progressText.textContent = t.processing + ' ' + Math.floor(progress) + '%';
        }, 200);
        
        processedAudioBuffer = await applyAudioEffects(originalAudioBuffer, noiseReduction, silenceThreshold, trimSilence, speed, pitch);
        
        clearInterval(progressInterval);
        progressBar.style.width = '100%';
        progressText.textContent = t.processing + ' 100%';
        
        document.getElementById('outputWaveformContainer').classList.remove('hidden');
        drawWaveform(processedAudioBuffer, 'outputWaveformCanvas', '#22c55e');
        document.getElementById('outputTimer').textContent = '00:00 / ' + formatTime(processedAudioBuffer.duration);
        
        const wavBlob = audioBufferToWav(processedAudioBuffer);
        const audioUrl = URL.createObjectURL(wavBlob);
        
        document.getElementById('outputAudioPlayer').classList.remove('hidden');
        const outputAudio = document.getElementById('outputAudio');
        outputAudio.src = audioUrl;
        
        outputAudio.ontimeupdate = function() {
            document.getElementById('outputTimer').textContent = formatTime(outputAudio.currentTime) + ' / ' + formatTime(processedAudioBuffer.duration);
        };
        
        document.getElementById('audioDownloadContainer').classList.remove('hidden');
        
        if(typeof showNotification === 'function') {
            showNotification(t.notifications.processingDone, 'success');
        }
    } catch (error) {
        console.error('Processing error:', error);
        if(typeof showNotification === 'function') {
            showNotification(t.notifications.error, 'error');
        }
    } finally {
        btn.disabled = false;
        btn.classList.remove('processing');
        btnText.textContent = t.processAudioBtn;
        
        setTimeout(function() {
            progressContainer.classList.add('hidden');
            progressText.classList.add('hidden');
        }, 1000);
    }
}

async function applyAudioEffects(audioBuffer, noiseReduction, silenceThreshold, trimSilence, speed, pitch) {
    const sampleRate = audioBuffer.sampleRate;
    const numChannels = audioBuffer.numberOfChannels;
    const newLength = Math.floor(audioBuffer.length / speed);
    
    const offlineCtx = new OfflineAudioContext(numChannels, newLength, sampleRate);
    
    const source = offlineCtx.createBufferSource();
    source.buffer = audioBuffer;
    source.playbackRate.value = speed;
    source.detune.value = pitch * 100;
    
    let currentNode = source;
    
    if (noiseReduction > 0) {
        const highpass = offlineCtx.createBiquadFilter();
        highpass.type = 'highpass';
        highpass.frequency.value = 80 + (noiseReduction * 2);
        highpass.Q.value = 0.7;
        currentNode.connect(highpass);
        currentNode = highpass;
        
        const lowpass = offlineCtx.createBiquadFilter();
        lowpass.type = 'lowpass';
        lowpass.frequency.value = 16000 - (noiseReduction * 80);
        lowpass.Q.value = 0.7;
        currentNode.connect(lowpass);
        currentNode = lowpass;
        
        if (noiseReduction > 25) {
            const notch = offlineCtx.createBiquadFilter();
            notch.type = 'notch';
            notch.frequency.value = 60;
            notch.Q.value = 30;
            currentNode.connect(notch);
            currentNode = notch;
        }
        
        if (noiseReduction > 50) {
            const compressor = offlineCtx.createDynamicsCompressor();
            compressor.threshold.value = -24;
            compressor.knee.value = 30;
            compressor.ratio.value = 4;
            compressor.attack.value = 0.003;
            compressor.release.value = 0.25;
            currentNode.connect(compressor);
            currentNode = compressor;
        }
    }
    
    currentNode.connect(offlineCtx.destination);
    source.start(0);
    let renderedBuffer = await offlineCtx.startRendering();
    
    if (trimSilence) {
        renderedBuffer = trimSilenceFromBuffer(renderedBuffer, silenceThreshold);
    }
    
    return renderedBuffer;
}

                                    <!-- Optimized Trim Function for MobileÂ -->
<!--.............................................................................................-->

// âš¡ Optimized Trim Function for Mobile (100x Faster)
function trimSilenceFromBuffer(audioBuffer, thresholdDb) {
    const threshold = Math.pow(10, thresholdDb / 20);
    const channelData = audioBuffer.getChannelData(0);
    const sampleRate = audioBuffer.sampleRate;
    const numChannels = audioBuffer.numberOfChannels;
    
    // ğŸš€ Optimization: Check every 100th sample instead of every single one
    const step = 100; 

    let start = 0;
    // Fast forward scan
    for (let i = 0; i < channelData.length; i += step) {
        if (Math.abs(channelData[i]) > threshold) {
            start = Math.max(0, i - (sampleRate * 0.05));
            break;
        }
    }
    
    let end = channelData.length;
    // Fast backward scan
    for (let i = channelData.length - 1; i >= 0; i -= step) {
        if (Math.abs(channelData[i]) > threshold) {
            end = Math.min(channelData.length, i + (sampleRate * 0.1));
            break;
        }
    }
    
    const newLength = end - start;
    
    if (newLength <= 0 || newLength >= channelData.length) {
        return audioBuffer;
    }
    
    const newCtx = new (window.AudioContext || window.webkitAudioContext)();
    const newBuffer = newCtx.createBuffer(numChannels, newLength, sampleRate);
    
    for (let channel = 0; channel < numChannels; channel++) {
        const oldData = audioBuffer.getChannelData(channel);
        const newData = newBuffer.getChannelData(channel);
        
        if (oldData.subarray) {
             newData.set(oldData.subarray(start, end));
        } else {
            for (let i = 0; i < newLength; i++) {
                newData[i] = oldData[start + i];
            }
        }
    }
    
    return newBuffer;
}

                                    <!-- END Optimized Trim Function for MobileÂ -->
<!--.............................................................................................-->

function audioBufferToWav(audioBuffer) {
    const numChannels = audioBuffer.numberOfChannels;
    const sampleRate = audioBuffer.sampleRate;
    const format = 1;
    const bitDepth = 16;
    
    const bytesPerSample = bitDepth / 8;
    const blockAlign = numChannels * bytesPerSample;
    
    const samples = audioBuffer.length;
    const dataSize = samples * blockAlign;
    const buffer = new ArrayBuffer(44 + dataSize);
    const view = new DataView(buffer);
    
    writeString(view, 0, 'RIFF');
    view.setUint32(4, 36 + dataSize, true);
    writeString(view, 8, 'WAVE');
    writeString(view, 12, 'fmt ');
    view.setUint32(16, 16, true);
    view.setUint16(20, format, true);
    view.setUint16(22, numChannels, true);
    view.setUint32(24, sampleRate, true);
    view.setUint32(28, sampleRate * blockAlign, true);
    view.setUint16(32, blockAlign, true);
    view.setUint16(34, bitDepth, true);
    writeString(view, 36, 'data');
    view.setUint32(40, dataSize, true);
    
    const offset = 44;
    const channelData = [];
    for (let i = 0; i < numChannels; i++) {
        channelData.push(audioBuffer.getChannelData(i));
    }
    
    let index = 0;
    for (let i = 0; i < samples; i++) {
        for (let channel = 0; channel < numChannels; channel++) {
            let sample = channelData[channel][i];
            sample = Math.max(-1, Math.min(1, sample));
            sample = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
            view.setInt16(offset + index, sample, true);
            index += 2;
        }
    }
    
    return new Blob([buffer], { type: 'audio/wav' });
}

function writeString(view, offset, string) {
    for (let i = 0; i < string.length; i++) {
        view.setUint8(offset + i, string.charCodeAt(i));
    }
}

function downloadProcessedAudio() {
    if (!processedAudioBuffer) return;
    
    const t = editorTranslations[editorCurrentLang];
    const wavBlob = audioBufferToWav(processedAudioBuffer);
    const originalName = inputAudioFile ? inputAudioFile.name.replace(/\.[^/.]+$/, '') : 'processed_audio';
    const fileName = originalName + '_edited.wav';
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(wavBlob);
    link.download = fileName;
    link.click();
    
    if(typeof showNotification === 'function') {
        showNotification(t.notifications.downloadReady, 'success');
    }
}

function handleVideoUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    inputVideoFile = file;
    const t = editorTranslations[editorCurrentLang];
    
    document.getElementById('videoFileInfo').classList.remove('hidden');
    document.getElementById('videoFileName').textContent = file.name;
    document.getElementById('videoFileSize').textContent = formatFileSize(file.size);
    document.getElementById('videoUploadZone').style.display = 'none';
    
    document.getElementById('videoPreviewContainer').classList.remove('hidden');
    const videoEl = document.getElementById('videoPreview');
    videoEl.src = URL.createObjectURL(file);
    
    document.getElementById('audioFormatGroup').classList.remove('hidden');
    document.getElementById('audioQualityGroup').classList.remove('hidden');
    document.getElementById('convertVideoBtn').disabled = false;
    
    if(typeof showNotification === 'function') {
        showNotification(t.notifications.videoLoaded, 'success');
    }
}

function removeVideoFile() {
    inputVideoFile = null;
    extractedAudioBlob = null;
    
    document.getElementById('videoFileInput').value = '';
    document.getElementById('videoFileInfo').classList.add('hidden');
    document.getElementById('videoUploadZone').style.display = '';
    document.getElementById('videoPreviewContainer').classList.add('hidden');
    document.getElementById('audioFormatGroup').classList.add('hidden');
    document.getElementById('audioQualityGroup').classList.add('hidden');
    document.getElementById('extractedWaveformContainer').classList.add('hidden');
    document.getElementById('extractedAudioPlayer').classList.add('hidden');
    document.getElementById('videoDownloadContainer').classList.add('hidden');
    document.getElementById('convertVideoBtn').disabled = true;
}

async function convertVideoToAudio() {
    if (!inputVideoFile) {
        if(typeof showNotification === 'function') {
            showNotification(editorTranslations[editorCurrentLang].notifications.noFile, 'error');
        }
        return;
    }
    
    const t = editorTranslations[editorCurrentLang];
    const btn = document.getElementById('convertVideoBtn');
    const btnText = document.getElementById('convertVideoBtnText');
    const progressContainer = document.getElementById('videoProgressContainer');
    const progressBar = document.getElementById('videoProgressBar');
    const progressText = document.getElementById('videoProgressText');
    
    btn.disabled = true;
    btn.classList.add('processing');
    btnText.textContent = t.converting;
    progressContainer.classList.remove('hidden');
    progressText.classList.remove('hidden');
    
    if(typeof showNotification === 'function') {
        showNotification(t.notifications.convertingStart, 'info');
    }
    
    try {
        const videoEl = document.getElementById('videoPreview');
        
        const stream = videoEl.captureStream ? videoEl.captureStream() : videoEl.mozCaptureStream();
        const audioTracks = stream.getAudioTracks();
        
        if (audioTracks.length === 0) {
            throw new Error('No audio track found');
        }
        
        const audioStream = new MediaStream(audioTracks);
        const mediaRecorder = new MediaRecorder(audioStream);
        const chunks = [];
        
        mediaRecorder.ondataavailable = function(e) {
            if (e.data.size > 0) chunks.push(e.data);
        };
        
        mediaRecorder.onstop = async function() {
            extractedAudioBlob = new Blob(chunks, { type: 'audio/webm' });
            
            try {
                const newCtx = new (window.AudioContext || window.webkitAudioContext)();
                const arrayBuffer = await extractedAudioBlob.arrayBuffer();
                const audioBuffer = await newCtx.decodeAudioData(arrayBuffer);
                
                document.getElementById('extractedWaveformContainer').classList.remove('hidden');
                drawWaveform(audioBuffer, 'extractedWaveformCanvas', '#22c55e');
                document.getElementById('extractedTimer').textContent = '00:00 / ' + formatTime(audioBuffer.duration);
            } catch(e) {
                console.log('Waveform error:', e);
            }
            
            document.getElementById('extractedAudioPlayer').classList.remove('hidden');
            document.getElementById('extractedAudio').src = URL.createObjectURL(extractedAudioBlob);
            document.getElementById('videoDownloadContainer').classList.remove('hidden');
            
            progressBar.style.width = '100%';
            
            btn.disabled = false;
            btn.classList.remove('processing');
            btnText.textContent = t.convertVideoBtn;
            
            if(typeof showNotification === 'function') {
                showNotification(t.notifications.convertingDone, 'success');
            }
            
            setTimeout(function() {
                progressContainer.classList.add('hidden');
                progressText.classList.add('hidden');
            }, 1000);
        };
        
        mediaRecorder.start();
        videoEl.currentTime = 0;
        videoEl.muted = true;
        await videoEl.play();
        
        const progressInterval = setInterval(function() {
            const progress = (videoEl.currentTime / videoEl.duration) * 100;
            progressBar.style.width = progress + '%';
            progressText.textContent = t.converting + ' ' + Math.floor(progress) + '%';
        }, 100);
        
        videoEl.onended = function() {
            clearInterval(progressInterval);
            mediaRecorder.stop();
            videoEl.muted = false;
        };
        
    } catch (error) {
        console.error('Conversion error:', error);
        if(typeof showNotification === 'function') {
            showNotification(t.notifications.error, 'error');
        }
        btn.disabled = false;
        btn.classList.remove('processing');
        btnText.textContent = t.convertVideoBtn;
    }
}

function downloadExtractedAudio() {
    if (!extractedAudioBlob) return;
    
    const t = editorTranslations[editorCurrentLang];
    const originalName = inputVideoFile ? inputVideoFile.name.replace(/\.[^/.]+$/, '') : 'extracted_audio';
    const fileName = originalName + '_audio.webm';
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(extractedAudioBlob);
    link.download = fileName;
    link.click();
    
    if(typeof showNotification === 'function') {
        showNotification(t.notifications.downloadReady, 'success');
    }
}

// Initialize on load
updateSliderValue('noiseReduction', 50);
updateSliderValue('silenceThreshold', -40);
updateSliderValue('speed', 1);
updateSliderValue('pitch', 0);
updateSliderValue('audioQuality', 192);

console.log('ğŸµ Audio & Video Editor loaded! (Offline Mode)');
</script>

</div>

<!-- LANGUAGE SWITCH SCRIPT ÛŒØ§ Ú©ÙˆØ¦ÛŒ Ø¨Ú¾ÛŒ last script -->
</script>

<!-- ================= END ABOUT SECTION ================= -->










<!-- Mobile optimization notice -->

<div class="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
<div class="mb-2">
    <a href="https://nzg73.blogspot.com" 
       target="_blank" 
       rel="noopener noreferrer"
       class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 underline text-sm">
        <span class="font-medium">WebsiteğŸ‘‰NZG73</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg>
    </a>
</div>

<div class="mb-2">
    <a href="https://www.youtube.com/@NZG73" 
       target="_blank" 
       rel="noopener noreferrer"
       class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 underline text-sm">
        <span class="font-medium">YouTubeğŸ‘‰NZG73</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg>
    </a>
</div>

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


<!-- Alpine.js Required -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<div x-data="{ open: false }" class="w-full">

    <!-- Accordion Header -->
    <button 
        @click="open = !open"
        class="w-full text-left px-3 py-2 bg-yellow-800 text-yellow-200 font-semibold rounded-md">
        Read Details ğŸ“–
       <span class="float-right" x-text="open ? 'ğŸ”¼ğŸ¥°ğŸ˜â–²' : 'ğŸ”½ğŸ¥ºğŸ‘‰ğŸ»â–¼'"></span>
    </button>


    <!-- Accordion Content -->
    <div x-show="open" x-collapse class="mt-2">

        <ul class="text-xs text-yellow-700 dark:text-yellow-300 space-y-1 p-2 bg-yellow-50 dark:bg-yellow-900 rounded-md">

            <li><b>â€¢ Audio & Video Editor</b></li>
            <li><b>â€¢ Professional offline audio processing & video conversion</b></li>

            <li><b>â€¢ ğŸµ Audio Cleaner & Enhancer</b></li>
            <li><b>â€¢ ğŸ¬ Video to Audio Converter</b></li>

            <li><b>â€¢ Click or drag audio file here</b></li>
            <li><b>â€¢ Supports: MP3, WAV, OGG, FLAC, M4A - No size limit!</b></li>

            <li><b>â€¢ Click or drag video file here</b></li>
            <li><b>â€¢ Supports: MP4, WebM, MKV, AVI, MOV - No size limit!</b></li>

            <li><b>â€¢ ğŸ”‡ Noise Reduction</b></li>
            <li><b>â€¢ âœ‚ï¸ Silence Threshold</b></li>
            <li><b>â€¢ Trim Silent Parts</b></li>

            <li><b>â€¢ âš¡ Speed</b></li>
            <li><b>â€¢ ğŸ¤ Pitch (Voice Tone)</b></li>

            <li><b>â€¢ Process Audio</b></li>
            <li><b>â€¢ Processing...</b></li>
            <li><b>â€¢ Download Processed Audio</b></li>

            <li><b>â€¢ ğŸ“¥ Input (Before)</b></li>
            <li><b>â€¢ ğŸ“¤ Output (After)</b></li>

            <li><b>â€¢ ğŸ“ Output Audio Format</b></li>
            <li><b>â€¢ ğŸšï¸ Audio Quality</b></li>

            <li><b>â€¢ Convert to Audio</b></li>
            <li><b>â€¢ Converting...</b></li>
            <li><b>â€¢ Download Audio</b></li>

            <li><b>â€¢ ğŸµ Extracted Audio</b></li>

            <li><b>â€¢ âš ï¸ For better results on Chrome Android: Go to Settings > Apps > Chrome > Battery > Set Unrestricted</b></li>

            <li><b>â€¢ âš ï¸ Chrome Android Ù¾Ø± Ø¨ÛØªØ± Ù†ØªØ§Ø¦Ø¬ Ú©Û’ Ù„ÛŒÛ’:  Settings > Apps > Chrome > Battery > Unrestricted Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº </b></li>



               
        </ul>

    </div>
</div>
<!-- END Alpine.js Required -->

        </ul>
</div>

<!-- NZG 73 Logo Footer -->
<div style="text-align: center; margin: 20px 0;">
    <pre style="background:#000; color:#0f0; padding:20px; font-family:monospace; display:inline-block; border-radius:10px;">
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                      â•‘
â•‘  â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â•‘
â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘ â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•”â•â•â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘ â•šâ•â•â•â•â–ˆâ–ˆâ•—    â•‘
â•‘  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â•‘
â•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•  â•šâ•â•â•â•â–ˆâ–ˆâ•—    â•‘
â•‘  â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â•‘
â•‘  â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•     â•šâ•â•   â•šâ•â•â•â•â•â•     â•‘
â•‘                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    </pre>
</div>


                                    <!-- ğŸ”’ Zoom LockÂ -->
<!--.............................................................................................-->




<div id="zoom-lock-container" style="position: fixed; bottom: 20px; left: 20px; z-index: 99999;">
    <button id="zoomLockBtn" onclick="toggleZoomLock()" 
            style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); 
                   background: rgba(0,0,0,0.6); color: white; font-size: 24px; cursor: pointer; 
                   box-shadow: 0 4px 15px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
                   transition: all 0.3s ease; -webkit-tap-highlight-color: transparent;">
        ğŸ”“
    </button>
</div>

<script>
    let isScreenLocked = false;
    let originalViewport = ""; // Ù¾Ø±Ø§Ù†ÛŒ Ø³ÛŒÙ¹Ù†Ú¯ ÛŒØ§Ø¯ Ø±Ú©Ú¾Ù†Û’ Ú©Û’ Ù„ÛŒÛ’

    document.addEventListener('DOMContentLoaded', function() {
        // Ø§ØµÙ„ ÙˆÛŒÙˆ Ù¾ÙˆØ±Ù¹ Ú©Ùˆ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒÚº
        const viewport = document.querySelector("meta[name=viewport]");
        if (viewport) originalViewport = viewport.getAttribute("content");

        // Ù…ÛŒÙ…ÙˆØ±ÛŒ Ú†ÛŒÚ© Ú©Ø±ÛŒÚº
        const savedState = localStorage.getItem('zoomLockState');
        if (savedState === 'true') {
            isScreenLocked = true;
            updateLockButtonUI(true);
            applyHardLock();
        }
    });

    function toggleZoomLock() {
        isScreenLocked = !isScreenLocked;
        localStorage.setItem('zoomLockState', isScreenLocked);

        if (isScreenLocked) {
            updateLockButtonUI(true);
            applyHardLock();
            if(typeof showNotification === 'function') showNotification('ğŸ”’ Locked (Hard Security)', 'info');
        } else {
            updateLockButtonUI(false);
            removeHardLock();
            if(typeof showNotification === 'function') showNotification('ğŸ”“ Unlocked', 'success');
        }
    }

    function updateLockButtonUI(locked) {
        const btn = document.getElementById('zoomLockBtn');
        if (locked) {
            btn.innerHTML = 'ğŸ”’';
            btn.style.background = 'rgba(220, 38, 38, 0.9)'; 
            btn.style.transform = 'scale(1.1)';
        } else {
            btn.innerHTML = 'ğŸ”“';
            btn.style.background = 'rgba(0, 0, 0, 0.6)'; 
            btn.style.transform = 'scale(1)';
        }
    }

    // â›” ÛŒÛ ÙÙ†Ú©Ø´Ù† Ø³Ø®ØªÛŒ Ú©Ø±Û’ Ú¯Ø§
    function applyHardLock() {
        // 1. Ù…ÛŒÙ¹Ø§ Ù¹ÛŒÚ¯ Ù¾Ø± Ø­Ù…Ù„Û (Ø³Ø¨ Ø³Û’ Ø§ÛÙ…)
        let viewport = document.querySelector("meta[name=viewport]");
        if (!viewport) {
            viewport = document.createElement('meta');
            viewport.name = "viewport";
            document.head.appendChild(viewport);
        }
        // ÛŒÛ Ù„Ø§Ø¦Ù† Ø¨Ø±Ø§Ø¤Ø²Ø± Ú©Ùˆ Ø¨ØªØ§ØªÛŒ ÛÛ’: "ØµØ§Ø±Ù Ú©Ùˆ Ø²ÙˆÙ… Ú©Ø±Ù†Û’ Ú©ÛŒ Ø§Ø¬Ø§Ø²Øª Ù…Øª Ø¯Ùˆ"
        viewport.setAttribute("content", "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no");

        // 2. CSS Ú©ÛŒ Ù¾Ø§Ø¨Ù†Ø¯ÛŒ
        document.body.style.touchAction = "pan-y"; // ØµØ±Ù Ø§Ø³Ú©Ø±ÙˆÙ„Ù†Ú¯ (Scrolling) Ú©ÛŒ Ø§Ø¬Ø§Ø²Øª

        // 3. Ø§ÛŒÙˆÙ†Ù¹ Ù„Ø³Ù†Ø±Ø² (ÚˆØ¨Ù„ Ù¹ÛŒÙ¾ Ø§ÙˆØ± Ù¾Ù†Ú† Ø±ÙˆÚ©Ù†Û’ Ú©Û’ Ù„ÛŒÛ’)
        document.addEventListener('touchmove', preventPinch, { passive: false });
        document.addEventListener('touchstart', preventPinchStart, { passive: false });
        document.addEventListener('dblclick', preventDoubleTap);
        document.addEventListener('gesturestart', preventGesture);
    }

    // ğŸ”“ ÛŒÛ ÙÙ†Ú©Ø´Ù† Ø³Ø®ØªÛŒ Ø®ØªÙ… Ú©Ø±Û’ Ú¯Ø§
    function removeHardLock() {
        // ÙˆÛŒÙˆ Ù¾ÙˆØ±Ù¹ ÙˆØ§Ù¾Ø³ Ù†Ø§Ø±Ù…Ù„ Ú©Ø±ÛŒÚº
        let viewport = document.querySelector("meta[name=viewport]");
        if (viewport) {
            viewport.setAttribute("content", originalViewport || "width=device-width, initial-scale=1.0");
        }

        document.body.style.touchAction = "auto";
        document.removeEventListener('touchmove', preventPinch);
        document.removeEventListener('touchstart', preventPinchStart);
        document.removeEventListener('dblclick', preventDoubleTap);
        document.removeEventListener('gesturestart', preventGesture);
    }

    // --- Ø±ÙˆÚ© Ù¹ÙˆÚ© Ú©Ø±Ù†Û’ ÙˆØ§Ù„Û’ ÙÙ†Ú©Ø´Ù†Ø² ---

    // Ø¬Ø¨ Ø§Ù†Ú¯Ù„ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ† Ù¾Ø± Ù„Ú¯Û’ØŒ Ø§Ú¯Ø± 1 Ø³Û’ Ø²ÛŒØ§Ø¯Û Ø§Ù†Ú¯Ù„ÛŒØ§Úº ÛÛŒÚº ØªÙˆ Ø±ÙˆÚ© Ø¯Ùˆ
    const preventPinchStart = function(e) {
        if (e.touches.length > 1) {
            e.preventDefault();
        }
    };

    // Ø¬Ø¨ Ø§Ù†Ú¯Ù„ÛŒ ÛÙ„Û’ØŒ Ø²ÙˆÙ…Ù†Ú¯ Ú©Ùˆ Ø±ÙˆÚ©Ùˆ
    const preventPinch = function(e) {
        if (e.touches.length > 1) {
            e.preventDefault();
        }
    };

    // ÚˆØ¨Ù„ Ù¹ÛŒÙ¾ Ø±ÙˆÚ©Ùˆ
    const preventDoubleTap = function(e) {
        e.preventDefault();
    };

    // Ø³ÙØ§Ø±ÛŒ/Ø¢Ø¦ÛŒ ÙÙˆÙ† Ú©Ø§ Ø²ÙˆÙ… Ø±ÙˆÚ©Ùˆ
    const preventGesture = function(e) {
        e.preventDefault();
    };
</script>




                                    <!-- END ğŸ”’ Zoom LockÂ -->
<!--.............................................................................................-->

<script>
    // 1. GHOST VIDEO (To keep internet alive in background)
    const silentVideo64 = "data:video/mp4;base64,AAAAHGZ0eXBNNGEgAAAAAAAAbWwAAAAAAABibW9vdgAAAGxtdmhkAAAAAAA+NkAABjZAAABAACACAAAACwAAAAAABgEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHB0cmFrAAAAXHRraGQAAAAAITZAAAY2QAAAAQAAAAAAQAAAAAAQAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGBtZGlhAAAAIG1kaGQAAAAAITZAAAY2QAAQAAAABAAAAAAAFVUAAAAAGWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABtaW5mAAAAFHZtaGQAAAAAAQAAAAAAQAAAAAAKJGRpbmYAAAAQZHJlZgAAAAAAAAABAAAGFHN0YmwAAABXc3RzZAAAAAAAAAABAAAAV2F2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAQAAEAAIAAAZEAAAAAAAAAAAAAA2YXZjQwEZAAb/4QA2AAAAMgAAAAEBAAAAAAMEAAAABAAAAAEAAAEgAAAAASEAAAAAAgQAAAAAAwQAAAAEAAAAAQAAAAEAAABhYml0cgAAAAA4c3R0cwAAAAAAAAABAAAAAQAAAAQAAAA0c3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN6AAAAaAAAAAEAAAAAAAAAAAAAABRzdGNvAAAAAAAAAAEAAAAM";
    const bgVideo = document.createElement('video');
    bgVideo.src = silentVideo64;
    bgVideo.loop = true;
    bgVideo.muted = true;
    bgVideo.playsInline = true;

    // 2. SUCCESS SOUND (Ting!)
    const successSound = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");

    // 3. MAIN FUNCTION
    let isGenerating = false;

    async function generateTTSAudioWithCustomName() {
        if (isGenerating) return;
        isGenerating = true;

        const gBtn = document.getElementById('generate-btn');
        const originalText = gBtn.innerHTML;
        gBtn.innerHTML = '<span class="animate-spin inline-block mr-2">âš¡</span> Working... (Go to YouTube)';
        gBtn.disabled = true;

        // Start background engine
        try { await bgVideo.play(); } catch(e){}

        try {
            const requestData = {
                text: document.getElementById('text').value.trim(),
                voice_mode: document.querySelector('input[name="voice_mode"]:checked').value,
                temperature: parseFloat(document.getElementById('temperature').value),
                exaggeration: parseFloat(document.getElementById('exaggeration').value),
                cfg_weight: parseFloat(document.getElementById('cfg-weight').value),
                seed: parseInt(document.getElementById('seed').value),
                speed_factor: parseFloat(document.getElementById('speed-factor').value),
                language: document.getElementById('language').value,
                output_format: document.getElementById('output-format').value,
                split_text: document.getElementById('split-text-toggle').checked,
                chunk_size: parseInt(document.getElementById('chunk-size-slider').value) || 120,
                audio_name: document.getElementById('audio-name').value.trim() || ''
            };

            // Validations
            if (requestData.voice_mode === 'predefined' && document.getElementById('predefined-voice-select').value === 'none') throw new Error('Select a voice');
            if (requestData.voice_mode === 'clone' && document.getElementById('clone-reference-select').value === 'none') throw new Error('Select reference file');
            if (!requestData.text) throw new Error('Enter text');

            // Notify user
            showNotification('Started! Go use other apps, it will download automatically.', 'info');

            // FETCH REQUEST
            const response = await fetch('/tts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) {
                if(response.status === 499) throw new Error("Cancelled by user");
                throw new Error(`Error: ${response.status}`);
            }

            const blob = await response.blob();
            if (blob.size === 0) throw new Error('Empty audio');

            // âš¡ FORCE DOWNLOAD (NO WAITING)
            const url = window.URL.createObjectURL(blob);
            let finalName = requestData.audio_name 
                ? `${requestData.audio_name}.${requestData.output_format}`
                : `tts_${Date.now()}.${requestData.output_format}`;

            const a = document.createElement('a');
            a.href = url;
            a.download = finalName;
            a.style.display = 'none';
            document.body.appendChild(a);
            
            // ğŸ”¥ The Main Trigger
            a.click(); 
            
            // Sound & Cleanup
            successSound.play().catch(e=>{}); // "Ting" sound
            showNotification(`âœ… Downloaded: ${finalName}`, 'success');
            
            setTimeout(() => { 
                document.body.removeChild(a); 
                window.URL.revokeObjectURL(url); 
            }, 5000);

        } catch (error) {
            console.error(error);
            showNotification(error.message, 'error');
        } finally {
            isGenerating = false;
            gBtn.innerHTML = originalText;
            gBtn.disabled = false;
            bgVideo.pause(); // Stop battery usage
        }
    }
</script>

<script>


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“± BACKGROUND TTS GENERATION SUPPORT SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ÛŒÛ Ú©ÙˆÚˆ Ù…ÙˆØ¨Ø§Ø¦Ù„ Ù¾Ø± Ø¨ÛŒÚ© Ú¯Ø±Ø§Ø¤Ù†Úˆ Ù…ÛŒÚº TTS Ø¬Ù†Ø±ÛŒØ´Ù† Ú©Ùˆ Ø¬Ø§Ø±ÛŒ Ø±Ú©Ú¾ØªØ§ ÛÛ’
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

(function initBackgroundTTSSupport() {
    'use strict';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VARIABLES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let wakeLock = null;
    let audioContext = null;
    let silentOscillator = null;
    let keepAliveInterval = null;
    let activeNotification = null;
    let isBackgroundGenerating = false;
    let progressCheckInterval = null;
    
    // Store original fetch function
    const originalFetch = window.fetch;
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // REQUEST NOTIFICATION PERMISSION ON LOAD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function requestNotificationPermission() {
        if ('Notification' in window) {
            if (Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('âœ… Notification permission granted');
                        showBrowserNotification('TTS App Ready', 'Background generation enabled!', 'tts-ready');
                    }
                });
            }
        }
    }
    
    // Request permission after user interaction
    document.addEventListener('click', function requestOnce() {
        requestNotificationPermission();
        document.removeEventListener('click', requestOnce);
    }, { once: true });
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WAKE LOCK API - PREVENTS DEVICE SLEEP
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function requestWakeLock() {
        if ('wakeLock' in navigator) {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log('ğŸ”’ Wake Lock acquired');
                
                wakeLock.addEventListener('release', () => {
                    console.log('ğŸ”“ Wake Lock released');
                });
                
                // Re-acquire wake lock when page becomes visible again
                document.addEventListener('visibilitychange', async () => {
                    if (wakeLock !== null && document.visibilityState === 'visible' && isBackgroundGenerating) {
                        wakeLock = await navigator.wakeLock.request('screen');
                        console.log('ğŸ”’ Wake Lock re-acquired');
                    }
                });
                
                return true;
            } catch (err) {
                console.warn('âš ï¸ Wake Lock failed:', err.message);
                return false;
            }
        }
        return false;
    }
    
    function releaseWakeLock() {
        if (wakeLock !== null) {
            wakeLock.release();
            wakeLock = null;
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUDIO KEEP-ALIVE - PREVENTS BROWSER THROTTLING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function startAudioKeepAlive() {
        try {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            // Create silent oscillator
            silentOscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            // Nearly inaudible - just enough to keep browser active
            gainNode.gain.value = 0.0001;
            silentOscillator.frequency.value = 20; // Sub-bass, nearly inaudible
            
            silentOscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            silentOscillator.start();
            
            // Periodic resume to prevent suspension
            keepAliveInterval = setInterval(() => {
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume().catch(() => {});
                }
            }, 5000);
            
            console.log('ğŸ”Š Audio keep-alive started');
            return true;
        } catch (err) {
            console.warn('âš ï¸ Audio keep-alive failed:', err);
            return false;
        }
    }
    
    function stopAudioKeepAlive() {
        if (silentOscillator) {
            try {
                silentOscillator.stop();
                silentOscillator.disconnect();
            } catch (e) {}
            silentOscillator = null;
        }
        
        if (keepAliveInterval) {
            clearInterval(keepAliveInterval);
            keepAliveInterval = null;
        }
        
        console.log('ğŸ”‡ Audio keep-alive stopped');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // BROWSER NOTIFICATIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function showBrowserNotification(title, body, tag = 'tts-notification', requireInteraction = false) {
        if ('Notification' in window && Notification.permission === 'granted') {
            // Close previous notification with same tag
            if (activeNotification && activeNotification.tag === tag) {
                activeNotification.close();
            }
            
            try {
                activeNotification = new Notification(title, {
                    body: body,
                    tag: tag,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸµ</text></svg>',
                    badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸµ</text></svg>',
                    requireInteraction: requireInteraction,
                    silent: false,
                    vibrate: [100]
                });
                
                activeNotification.onclick = () => {
                    window.focus();
                    activeNotification.close();
                };
                
                return activeNotification;
            } catch (err) {
                console.warn('âš ï¸ Notification error:', err);
            }
        }
        return null;
    }
    
    function showProgressNotification(audioName, phase = 'generating') {
        const messages = {
            'generating': `ğŸ”„ Generating: ${audioName}...`,
            'processing': `â³ Processing audio...`,
            'downloading': `ğŸ“¥ Downloading: ${audioName}...`,
            'complete': `âœ… Complete: ${audioName}`,
            'error': `âŒ Failed: ${audioName}`
        };
        
        const titles = {
            'generating': 'ğŸµ TTS Generating',
            'processing': 'âš™ï¸ Processing',
            'downloading': 'ğŸ“¥ Downloading',
            'complete': 'âœ… TTS Complete',
            'error': 'âŒ TTS Error'
        };
        
        showBrowserNotification(
            titles[phase] || 'TTS Status',
            messages[phase] || `Processing ${audioName}...`,
            'tts-progress',
            phase === 'generating' || phase === 'processing'
        );
    }
    
    function closeProgressNotification() {
        if (activeNotification) {
            activeNotification.close();
            activeNotification = null;
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // BACKGROUND GENERATION MANAGER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function startBackgroundMode(audioName) {
        isBackgroundGenerating = true;
        
        // Start all keep-alive mechanisms
        await requestWakeLock();
        startAudioKeepAlive();
        
        // Show initial notification
        showProgressNotification(audioName, 'generating');
        
        // Start progress simulation
        let progress = 0;
        progressCheckInterval = setInterval(() => {
            if (isBackgroundGenerating) {
                progress = Math.min(progress + Math.random() * 10, 90);
                showBrowserNotification(
                    'ğŸµ TTS Generating',
                    `ğŸ“Š Progress: ~${Math.round(progress)}% - ${audioName}`,
                    'tts-progress',
                    true
                );
            }
        }, 3000);
        
        console.log('ğŸš€ Background mode started for:', audioName);
    }
    
    function stopBackgroundMode(audioName, success = true) {
        isBackgroundGenerating = false;
        
        // Stop progress updates
        if (progressCheckInterval) {
            clearInterval(progressCheckInterval);
            progressCheckInterval = null;
        }
        
        // Show completion notification
        if (success) {
            showProgressNotification(audioName, 'complete');
            
            // Auto-close after 5 seconds
            setTimeout(closeProgressNotification, 5000);
        } else {
            showProgressNotification(audioName, 'error');
        }
        
        // Release resources after a delay
        setTimeout(() => {
            if (!isBackgroundGenerating) {
                releaseWakeLock();
                stopAudioKeepAlive();
                console.log('ğŸ Background mode ended');
            }
        }, 2000);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INTERCEPT TTS GENERATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Store reference to original generation function
    const originalGenerateFunction = window.generateTTSAudioWithCustomName;
    
    // Create enhanced version
    window.generateTTSAudioWithCustomName = async function() {
        const textInput = document.getElementById('text');
        const audioNameInput = document.getElementById('audio-name') || document.getElementById('audioName');
        
        const audioName = audioNameInput ? audioNameInput.value.trim() : 'TTS_Audio';
        const text = textInput ? textInput.value.trim() : '';
        
        if (!text) {
            if (typeof showNotification === 'function') {
                showNotification('Please enter text to generate', 'error');
            }
            return;
        }
        
        // Start background mode
        await startBackgroundMode(audioName);
        
        try {
            // Call original function or handle TTS
            if (typeof originalGenerateFunction === 'function') {
                await originalGenerateFunction.apply(this, arguments);
            }
            stopBackgroundMode(audioName, true);
        } catch (error) {
            console.error('TTS Generation error:', error);
            stopBackgroundMode(audioName, false);
            throw error;
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ENHANCED FETCH WITH KEEP-ALIVE FOR TTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    window.fetch = function(url, options = {}) {
        // Check if this is a TTS request
        if (url === '/tts' || (typeof url === 'string' && url.includes('/tts'))) {
            console.log('ğŸ“¡ TTS fetch intercepted, applying keep-alive...');
            
            // Add keep-alive headers
            options.keepalive = true;
            
            // Ensure proper timeout handling
            const controller = new AbortController();
            const timeoutId = setTimeout(() => {
                console.warn('â° TTS request timeout warning (5 minutes)');
            }, 300000); // 5 minute warning
            
            if (!options.signal) {
                options.signal = controller.signal;
            }
            
            return originalFetch(url, options)
                .then(response => {
                    clearTimeout(timeoutId);
                    return response;
                })
                .catch(error => {
                    clearTimeout(timeoutId);
                    throw error;
                });
        }
        
        return originalFetch(url, options);
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PAGE VISIBILITY HANDLER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    document.addEventListener('visibilitychange', async () => {
        if (document.visibilityState === 'hidden' && isBackgroundGenerating) {
            console.log('ğŸ“± Page hidden - background mode active');
            
            // Refresh keep-alive
            if (audioContext && audioContext.state === 'suspended') {
                try {
                    await audioContext.resume();
                } catch (e) {}
            }
            
            // Show persistent notification
            showBrowserNotification(
                'ğŸµ TTS Running in Background',
                'Audio generation is continuing...',
                'tts-background',
                true
            );
        } else if (document.visibilityState === 'visible' && isBackgroundGenerating) {
            console.log('ğŸ“± Page visible - still generating');
            
            showBrowserNotification(
                'ğŸµ TTS Still Generating',
                'Welcome back! Generation in progress...',
                'tts-background',
                false
            );
        }
    });
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HANDLE PAGE FREEZE/RESUME (for aggressive browsers)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    document.addEventListener('freeze', () => {
        console.log('ğŸ¥¶ Page freezing...');
        if (isBackgroundGenerating) {
            showBrowserNotification(
                'âš ï¸ TTS May Be Paused',
                'Browser is limiting background activity',
                'tts-warning',
                true
            );
        }
    });
    
    document.addEventListener('resume', () => {
        console.log('ğŸ”„ Page resuming...');
        if (isBackgroundGenerating) {
            // Re-initialize keep-alive
            startAudioKeepAlive();
        }
    });
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SERVICE WORKER REGISTRATION (for better background support)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function registerMinimalServiceWorker() {
        if ('serviceWorker' in navigator) {
            try {
                // Create minimal service worker inline
                const swCode = `
                    self.addEventListener('install', (e) => self.skipWaiting());
                    self.addEventListener('activate', (e) => e.waitUntil(clients.claim()));
                    self.addEventListener('fetch', (e) => {
                        if (e.request.url.includes('/tts')) {
                            e.respondWith(
                                fetch(e.request.clone())
                                    .then(response => response)
                                    .catch(error => {
                                        console.error('SW fetch error:', error);
                                        throw error;
                                    })
                            );
                        }
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                // Note: Blob URLs for service workers have limited support
                // This is a fallback attempt
                try {
                    const registration = await navigator.serviceWorker.register(swUrl, { scope: '/' });
                    console.log('âœ… Service Worker registered');
                } catch (swError) {
                    console.log('â„¹ï¸ Inline SW not supported, using keep-alive fallback');
                }
            } catch (err) {
                console.log('â„¹ï¸ Service Worker not available:', err.message);
            }
        }
    }
    
    // Try to register service worker
    registerMinimalServiceWorker();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INITIALIZATION COMPLETE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('ğŸ“± Background TTS Support System Initialized');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('Features enabled:');
    console.log('  â€¢ Wake Lock API:', 'wakeLock' in navigator ? 'âœ…' : 'âŒ');
    console.log('  â€¢ Notifications:', 'Notification' in window ? 'âœ…' : 'âŒ');
    console.log('  â€¢ Audio Keep-Alive: âœ…');
    console.log('  â€¢ Visibility Handler: âœ…');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// END OF BACKGROUND TTS SUPPORT SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•





</body>
</html>

